Modustri.controller("LongRangeCtrl",["$log","$scope","$routeParams","$location","$http","CustomerServices","MachineServices","InsServices","UserServices","AuthServices","Utilities","$filter",function(t,e,a,n,r,o,i,c,s,h,l,u){"use strict";function p(){for(var t=[],a=0;a<=d();a++){var n=moment(new Date(e.fromChartDate)).add(a,"days").format("MM/DD/YYYY");t.push([new Date(n).getTime(),0])}return t}function m(){for(var t=[],a=0;a<=d();a++){var n=moment(new Date(e.fromChartDate)).add(a,"days").format("MM/DD/YYYY");t.push([new Date(n).getTime(),0,0])}return t}function f(t){var e=[];return $.each(t,function(t,a){-1===$.inArray(a,e)&&e.push(a)}),e}function d(){var t=864e5,a=(new Date(e.toChartDate)-new Date(e.fromChartDate))/t;return a+1}function g(t){var e=[],a=[];return angular.forEach(t,function(t){null!==t.inspection_obj.machine&&void 0!==t.inspection_obj.machine&&-1==e.indexOf(t.inspection_obj.machine.model)&&e.push(t.inspection_obj.machine.model)}),$.each(e,function(t,e){-1===$.inArray(e,a)&&a.push(e)}),a}function D(t){var e=[];return void 0===t||"Hi"===t||"Lo"===t||"NA%"===t||null===t||""===t||"NA"===t?-1:(e=t.split("%"),parseInt(e[0]))}h.checkUserCreds(),e.UserSettings=h.getUserSettings(),e.Chart={date:"",timestamp:"",filter:"",from:0,to:99999999999,customer_name:"",customer_id:"",inspectors_list:[],inspections:{}},e.Chart.inspections={},e.fromChartDate=moment().subtract(120,"days").format("MM/DD/YYYY"),e.toChartDate=moment().format("MM/DD/YYYY"),e.fromUnix=moment(new Date(e.fromChartDate)).unix(),e.toUnix=moment(new Date(e.toChartDate)).unix();var v=$("#stock-chart");e.UpdateChart=function(){var t=[];c.getByDealerIdStartEnd(h.getDealerID(),e.fromUnix,e.toUnix).then(function(e){var a=e.data.results;t=p(),angular.forEach(a,function(e){for(var a=moment.unix(e.timestamp).format("MM/DD/YYYY"),n=0;n<t.length;n++){var r=t[n];r[0]!==new Date(a).getTime()||(r[1]=r[1]+1)}}),v.highcharts("StockChart",{rangeSelector:{selected:1,inputEnabled:$("#stock-chart").width()>480},title:{text:"Total Inspections vs. Days"},series:[{name:"Inspection(s)",data:t,tooltip:{valueDecimals:2}}],exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/JPEG"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}}})})},e.UpdateChart();var x=$("#detail-stock-chart"),C=[];s.getUsersByDealer(function(t){angular.forEach(t.results,function(t){C.push(t.username)})}),e.UpdateDetailChart=function(){function t(){$("#detail-stock-chart").highcharts("StockChart",{chart:{},title:{text:"Inspector Breakdowns vs. Days"},rangeSelector:{inputEnabled:$("#detail-stock-chart").width()>480,selected:3},yAxis:{labels:{formatter:function(){return this.value}},plotLines:[{value:0,width:2,color:"silver"}],exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/JPEG"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b>',valueDecimals:2},series:a})}var a=[],n=[],r=0,o=Highcharts.getOptions().colors;c.getByDealerIdStartEnd(h.getDealerID(),e.fromUnix,e.toUnix).then(function(e){var n=e.data.results;$.each(C,function(e,o){var i=p();angular.forEach(n,function(t){if(void 0!==t.inspection_obj.user){var e=t.inspection_obj.user.username;if(o===e)for(var a=moment.unix(t.timestamp).format("MM/DD/YYYY"),n=0;n<i.length;n++){var r=i[n];r[0]!==new Date(a).getTime()||(r[1]=r[1]+1)}}}),a[e]={name:o,data:i},r++,r==C.length&&t()})})},e.UpdateDetailChart();var Y=$("#machine-stock-chart");e.UpdateMachineChart=function(){var t=[],a=[],n=0,r=Highcharts.getOptions().colors;c.getByDealerIdStartEnd(h.getDealerID(),e.fromUnix,e.toUnix).then(function(t){var a=m();e.chartMachines=g(t.data.results);var n=t.data.results;n=void 0===e.machineChartSearchFilter||null===e.machineChartSearchFilter?u("filter")(n,{}):u("filter")(n,{inspection_obj:{machine:{model:e.machineChartSearchFilter}}});var r=0,o=[];angular.forEach(n,function(t){var e=moment.unix(t.timestamp).format("MM/DD/YYYY"),n=[];angular.forEach(t.inspection_obj.results,function(t){if(!(void 0===t[0]||void 0===t[0].left&&void 0===t[0].right||void 0===t[0].left.percentage&&void 0===t[0].right.percentage))for(var e=0;e<t.length;e++)n.push(D(t[e].left.percentage)),n.push(D(t[e].right.percentage))});var i=n.sort(function(t,e){return t-e});r!==e?(i.length>1&&i[0]!==i[i.length-1]&&angular.forEach(a,function(t){t[0]==new Date(e).getTime()&&(t[1]=i[0],t[2]=i[i.length-1])}),r=e,o=n):angular.forEach(o,function(t){n.push(t)})}),Y.highcharts("StockChart",{chart:{type:"arearange"},rangeSelector:{inputEnabled:$("#machine-stock-chart").width()>480,selected:1},title:{text:"Machine wear MAX-MIN variation "},tooltip:{valueSuffix:""},series:[{name:"%",data:a}],exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/JPEG"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}}})})},e.UpdateMachineChart()}]);
//# sourceMappingURL=./longranges-min.js.map
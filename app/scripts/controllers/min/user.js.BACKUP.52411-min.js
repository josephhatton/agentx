Modustri.controller("UserCtrl",["$scope","UserServices","AuthServices","$filter","DealerServices","CustomerServices",function(e,r,t,s,n,u){"use strict";function l(){r.getUserList().then(function(r){e.users=r.data.results})}var i="uiusers";e.users={},e.ids={},e.dealers={},t.checkUserCreds(),e.UserSettings=t.getUserSettings(),n.getDealerList(function(r){e.dealers=r.results,e.userlevels=[{value:0,text:"Modustri Administrator"},{value:1,text:"Modustri Manager"},{value:2,text:"Dealer Administrator"},{value:3,text:"Dealer Manager"},{value:4,text:"Dealer User"},{value:5,text:"Customer Manager"}],0===t.getUserLevel()&&(e.isAdmin=1),e.uiShow=function(e){return t.uiToggle(t.getUserLevel(),i,e)},e.showUserLevel=function(r){var t=[];return null!==r&&(t=s("filter")(e.userlevels,{value:r})),t.length?t[0].text:"Not set"},e.showDealer=function(r){var t=[];return null!==r&&(t=s("filter")(e.dealers,{id:r})),t.length?t[0].name:"Not set"},e.editableName=function(e,r){void 0===r||null===r?$("#username").prop("readonly",""):$("#username").prop("readonly","readonly")},l(),e.getCustomers=function(e){var r=[];return e.length>=3?u.getByName(e).then(function(e){return angular.forEach(e.data.results,function(e){r.push(e.name)}),r}):void 0}}),e.addUser=function(){e.inserted={username:"",id:null,email:null,dealer_id:t.getDealerID(),customer_id:null,userlevel:null},e.users.unshift(e.inserted)},e.saveUser=function(e,t){console.dir(e),null!==t?r.updateUser(t,e.username,e.email,e.userlevel,e.dealer_id,e.customer_id,function(e){void 0!==e&&l()}):r.addUser(e.username,e.email,e.userlevel,e.dealer_id,e.customer_id,function(e){void 0!==e&&l()})},e.removeUser=function(e){e&&r.removeUser(e,function(){l()})},e.cancelUser=function(r){e.users.splice(r,1)},e.removeChecked=function(){angular.forEach(e.ids,function(e,t){r.removeUser(t,function(){l()})})}}]);
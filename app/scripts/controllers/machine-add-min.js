Modustri.controller("MachineAddCtrl",["$log","$scope","$routeParams","$location","MachineServices","CustomerServices","AuthServices","Utilities",function(e,a,t,i,n,r,s,c){"use strict";s.checkUserCreds(),a.UserSettings=s.getUserSettings(),a.Machine=n.getEmptyMachine(),a.image_upload="",a.Machine.main_image_id=!1,a.Machine.dealer_id=s.getDealerID(),n.queryManufacturers().then(function(e){a.ManufacturerList=e.data.results,n.queryModels(a.Machine.manufacturer_id).then(function(e){a.ModelList=e.data.results})}),a.updateMachineModels=function(e){n.queryModels(a.Machine.manufacturer_id).then(function(e){a.ModelList=e.data.results,console.log(JSON.stringify(e.data.results))})},a.$watch("Machine.model_id",function(e,t){if(e!==t){var i=_.where(a.ModelList,{id:e});a.Machine.model=i[0].model}}),a.$watch("image_upload",function(e,a){}),a.saveMachine=function(){var e={},t=!0;"undefined"==typeof a.Machine.manufacturer_id||""==a.Machine.manufacturer_id?(alert("Please select manufacturer"),t=!1):"undefined"==typeof a.Machine.serial||""==a.Machine.serial?(alert("Please input serial number"),t=!1):a.Machine.serial.length<3?(alert("Serial number should be more than 3 chars"),t=!1):"undefined"==typeof a.Machine.equipment_id||""==a.Machine.equipment_id?(alert("Please input unit number"),t=!1):"undefined"==typeof a.Machine.model||""==a.Machine.model?(alert("Please select model"),t=!1):("undefined"==typeof a.Machine.customer_name||""==a.Machine.customer_name.trim())&&(alert("Please input customer"),t=!1),0!=t&&r.getByName(a.Machine.customer_name).then(function(t){var r=!1;return angular.forEach(t.data.results,function(e){r||a.Machine.customer_name==e.name&&(a.Machine.customer_name=e.name,a.Machine.customer_id=e.id,r=!0)}),r?void n.getBySerial(a.Machine.serial).then(function(t){return 0!=t.data.results.length?void alert("The same serial number already exists"):void n.saveNew(a.Machine).then(function(t){t.data.errors.length>0?alert("There was a problem saving the machine: "+t.data.errors[0]):(a.$emit("machine_saved",t),a.image_upload&&(console.log("uploading image"),e={machine_obj:t.data.results,machine_id:t.data.results.id,file:a.image_upload,customer_id:t.data.results.customer_id,description:"",user_id:s.getUserID()},n.savePhoto(e).then(function(e){console.log("saved image"),console.dir(e)})),alert("New machine saved."),a.$emit("obj_saved","New "),i.path("/machines/list/"))})}):void alert("Customer doesn't exist")})},a.deleteMachine=function(){alert("There is no machine to delete.")}}]);
//# sourceMappingURL=./machine-add-min.js.map
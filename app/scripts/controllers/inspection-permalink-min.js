Modustri.controller("InspectionPermalinkCtrl",["$scope","$q","$http","InsServices","Utilities","AppSettings","MachineServices","CustomerServices","AuthServices","UserServices","DealerServices","$routeParams",function(e,n,t,s,i,a,o,r,c,m,p,u){"use strict";e.UserSettings=c.getUserSettings();var l="uiinspections",d=c.getDealerID();p.getDealerImg(d).then(function(e){if("image_id"in e.data.results&&null!==e.data.results.obj&&null!==e.data.results.image_id){var n=a.BASE_URL+"img/"+e.data.results.image_id+"/";$("#logo").css("background-image","url("+n+")").css("width","250px"),$(".logo-wrapper").css("width","250px")}}),e.uiShow=function(e){return c.uiToggle(c.getUserLevel(),l,e)},e.state=null,e.is_latest_ins=!1,e.Components={},e.Measureable_parts=[],e.Tools=[],e.Summaries=[],e.Prev_ins={},e.condition_class=function(e,n){var t=e;return"left"===n&&(t+=" left-percentage"),"right"===n&&(t+=" right-percentage"),t};var g=function(){m.query().then(function(n){var t=n.results,s=_.where(t,{id:e.Ins.user_id});s[0]&&(e.Ins.inspection_obj.inspector=s[0].username),e.UserList=t})},h=function(){var n,t="";o.getComponentsByMachineModel(e.Ins.inspection_obj.machine.model_id,function(s){e.Components=[],n=s.results;for(var a=0;a<n.length;a++)n[a].hasOwnProperty("component_id")&&o.createComponentObj(e,n[a].component_id).then(function(n){t=i.snakeCase(n.type),"idlers"===t&&(e.Components.idlers_front||(e.Components.idlers_front=[]),e.Components.idlers_front.push(n),e.Components.idlers_rear||(e.Components.idlers_rear=[]),e.Components.idlers_rear.push(n)),"idlers"!==t&&(e.Components[t]||(e.Components[t]=[]),e.Components[t].push(n))})})};s.getForPermalink(u.hash).then(function(n){e.Ins=n.data.results,e.Measureable_parts=[];var t={};"results"in e.Ins.inspection_obj==!1&&(e.Ins.inspection_obj.results={}),s.getByMachineId(e.Ins.machine_id).then(function(n){e.Prev_ins=n.data.results,e.Prev_ins.length>0?(e.Prev_ins.sort(function(e,n){return parseInt(e.timestamp,10)<parseInt(n.timestamp,10)?1:parseInt(e.timestamp,10)>parseInt(n.timestamp,10)?-1:parseInt(e.timestamp,10)===parseInt(n.timestamp,10)?0:void 0}),e.Ins.timestamp===e.Prev_ins[0].timestamp&&(e.is_latest_ins=!0),e.Prev_ins=e.Prev_ins[1]):e.Prev_ins=!1,s.getFailureDates(e),s.buildSummariesTable(e)}),s.cleanUpNulls(e),e.Ins.datestring=i.getDatestring(e.Ins.timestamp),e.Ins.MaintenanceDate=i.getDatestring(e.Ins.inspection_obj.maintenance_date),e.Ins.dealer_id=c.getDealerID(),s.setMainPhoto(e),p.getDealerImg(d).then(function(n){e.Ins.dealer_img_url="image_id"in n.data.results&&null!==n.data.results.obj?a.BASE_URL+"img/"+n.data.results.image_id+"/":!1}),_.each(e.Ins.inspection_obj.results,function(e,n,t){e.hasOwnProperty("model_id")&&e.model_id||"undefined"!=typeof e[0]&&e[0].hasOwnProperty("left")&&(e.model_id=e[0].left.id||e[0].right.id),_.each(e,function(e,i,a){s.setCondition(t,n,i)})}),o.getInspectionPhotos(e.Ins.id).then(function(n){s.renderInspectionPhotos(e,n)}),h(),g(),t=e.Ins.inspection_obj.results,o.getComponentTypesMachineNames().then(function(n){e.Measureable_parts=n,angular.forEach(t,function(n,i){_.contains(e.Measureable_parts,i)&&angular.forEach(t[i],function(n,a){s.setMeasurementToolNames(e,t[i][a]),s.setComponentDescription(t[i][a])})})}),r.get(e.Ins.customer_id).then(function(n){var t=n.data.results;e.Ins.inspection_obj.customer.name=t.name,e.Ins.inspection_obj.customer.address=t.address,e.Ins.inspection_obj.customer.city=t.city,e.Ins.inspection_obj.customer.state=t.state,e.Ins.inspection_obj.customer.zip=t.zip,e.Ins.inspection_obj.customer.primary_contact_id=t.primary_contact_id}),o.get(e.Ins.inspection_obj.machine.id).then(function(n){(!e.Ins.inspection_obj.machine.hasOwnProperty("img")||e.Ins.inspection_obj.machine.main_image_id<1&&n.data.results.main_image_id>0)&&(e.Ins.inspection_obj.machine.main_image_id=n.data.results.main_image_id,e.Ins.inspection_obj.machine.img=a.BASE_URL+"imgtmb/"+e.Ins.inspection_obj.machine.main_image_id+"/",e.Ins.inspection_obj.machine.img_full=a.BASE_URL+"/img/"+e.Ins.inspection_obj.machine.main_image_id+"/")})})}]);
//# sourceMappingURL=./inspection-permalink-min.js.map
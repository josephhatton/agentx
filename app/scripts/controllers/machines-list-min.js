Modustri.controller("MachinesListCtrl",["$log","$scope","$routeParams","$location","MachineServices","CustomerServices","InsServices","AuthServices","Utilities","AppSettings",function(e,t,n,i,a,r,s,o,c,u){"use strict";function d(e){var t;return"undefined"!=typeof e&&null!==e&&"Hi"!==e&&"Lo"!==e&&"NA"!==e&&""!==e?parseFloat(e):void 0}o.checkUserCreds(),t.UserSettings=o.getUserSettings();var l=n.page?n.page:1,g,f,m;t.uiToggle=function(){return o.uiToggle()},t.deleteMachine=function(e,n){confirm("Are you sure you want to delete this machine?")&&a.del(e).then(function(e){t.Machines.splice(n.$index,1),t.$emit("obj_deleted","Machine")})},"undefined"!=typeof n.customerID&&(m=n.customerID),a.query(l,m).then(function(e){t.pages=e.data.pages,t.Machines=e.data.results,_.each(t.Machines,function(e,n,i){a.queryManufacturers().then(function(i){var a=i.data.results,r=_.where(a,{id:e.manufacturer_id});t.Machines[n].manufacturer_name=r[0].company}),""!=e.main_image_id&&"0"!==e.main_image_id&&0!==e.main_image_id&&"(null)"!=e.main_image_id&&(t.Machines[n].img=u.BASE_URL+"imgtmb/"+e.main_image_id+"/",t.Machines[n].img_full=u.BASE_URL+"img/"+e.main_image_id+"/",f=setTimeout(function(){g=document.createElement("img"),g.src=t.Machines[n].img_full},0)),r.get(e.customer_id).then(function(t){e.CustomerData=t.data.results}),e.latest_inspection=0===e.last_inspected?"n/a":c.getDatestring(e.last_inspected),s.getNewestInspectionByMachineId(e.id).then(function(t){if(t.data.results[0]){t.data.results[0].inspection_obj.user&&(e.last_inspectorid=t.data.results[0].inspection_obj.user.id,e.last_inspector=t.data.results[0].inspection_obj.user.username);var n=[];angular.forEach(t.data.results[0].inspection_obj.results,function(e,t){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var i=0;i<e.length;i++)n.push(d(e[i].left.percentage)),n.push(d(e[i].right.percentage))});var i=n.sort(function(e,t){return t-e});"undefined"==typeof i[0]?(e.rating="N/A",e.color="red"):(e.rating=i[0].toString()+"%",i[0]>69?e.color="red":i[0]>30&&i[0]<70?e.color="orange":i[0]<31&&(e.color="green"))}else e.rating="N/A",e.color="red"})})})}]);
//# sourceMappingURL=./machines-list-min.js.map
Modustri.config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!1),e.when("/",{controller:"LoginCtrl",templateUrl:"views/login.html"}).when("/eula",{templateUrl:"eula.html"}).when("/tos",{templateUrl:"tos.html"}).when("/help",{templateUrl:"help.html"}).when("/dashboard",{controller:"DashboardCtrl",templateUrl:"views/dashboard.html"}).when("/machines/list",{controller:"MachinesListCtrl",templateUrl:"views/machines-list.html"}).when("/machines/list/:page",{controller:"MachinesListCtrl",templateUrl:"views/machines-list.html"}).when("/machines/list-by-customer/:customerID",{controller:"MachinesListCtrl",templateUrl:"views/machines-list.html"}).when("/machines/list-by-customer/:customerID/:page",{controller:"MachinesListCtrl",templateUrl:"views/machines-list.html"}).when("/machines/add",{controller:"MachineAddCtrl",templateUrl:"views/machine-edit.html"}).when("/machines/:machineID",{controller:"MachineCtrl",templateUrl:"views/machine.html"}).when("/machines/:machineID/edit",{controller:"MachineCtrl",templateUrl:"views/machine-edit.html"}).when("/inspections/list",{controller:"InspectionsListCtrl",templateUrl:"views/inspections-list.html"}).when("/inspections/list/:page",{controller:"InspectionsListCtrl",templateUrl:"views/inspections-list.html"}).when("/inspections/add",{controller:"InspectionCtrl",templateUrl:"views/inspection-add.html"}).when("/inspections/add/:machineID",{controller:"InspectionCtrl",templateUrl:"views/inspection-add.html"}).when("/inspections/:inspectionID",{controller:"InspectionCtrl",templateUrl:"views/inspection.html"}).when("/inspections/:inspectionID/edit",{controller:"InspectionCtrl",templateUrl:"views/inspection-edit.html"}).when("/perm/inspections/:hash",{controller:"InspectionPermalinkCtrl",templateUrl:"views/inspection-permalink.html"}).when("/customers/list",{controller:"CustomersListCtrl",templateUrl:"views/customers-list.html"}).when("/customers/list/:index/:page",{controller:"CustomersListCtrl",templateUrl:"views/customers-list.html"}).when("/customers/list/:page",{controller:"CustomersListCtrl",templateUrl:"views/customers-list.html"}).when("/customers/add",{controller:"CustomerAddCtrl",templateUrl:"views/customer-edit.html"}).when("/customers/:customerID",{controller:"CustomerCtrl",templateUrl:"views/customer.html"}).when("/customers/:customerID/edit",{controller:"CustomerCtrl",templateUrl:"views/customer-edit.html"}).when("/settings",{controller:"SettingsCtrl",templateUrl:"views/settings.html"}).when("/users/list",{controller:"UserCtrl",templateUrl:"views/users-list.html"}).when("/password",{controller:"PasswordCtrl",templateUrl:"views/password-change.html"}).when("/password/set/:inviteID",{controller:"PasswordSetResetCtrl",templateUrl:"views/password-set.html"}).when("/password/reset/:resetID",{controller:"PasswordSetResetCtrl",templateUrl:"views/password-reset.html"}).when("/password/reset-request",{controller:"PasswordSetResetCtrl",templateUrl:"views/password-reset-request.html"}).when("/update/:type/:status",{controller:"UpdateCtrl",templateUrl:"views/update.html"}).when("/reports",{controller:"ReportCtrl",templateUrl:"views/reports/reports.html"}).when("/drilldowns",{controller:"DrilldownCtrl",templateUrl:"views/reports/drilldowns.html"}).when("/longranges",{controller:"LongRangeCtrl",templateUrl:"views/reports/longranges.html"}).when("/scoreboard",{controller:"ScoreboardCtrl",templateUrl:"views/scoreboard.html"}).otherwise({redirectTo:"/"})}]);var ModustriServices=angular.module("ModustriServices",[]);ModustriServices.config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"],e.defaults.transformRequest=function(e){var t=function(e){var n="",r,a,i,s,o,c,l;for(r in e)if(a=e[r],a instanceof Array)for(l=0;l<a.length;++l)o=a[l],i=r+"["+l+"]",c={},c[i]=o,n+=t(c)+"&";else if(a instanceof Object)for(s in a)o=a[s],i=r+"["+s+"]",c={},c[i]=o,n+=t(c)+"&";else void 0!==a&&null!==a&&(n+=encodeURIComponent(r)+"="+encodeURIComponent(a)+"&");return n.length?n.substr(0,n.length-1):n};return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}}]),ModustriServices.factory("AppSettings",function(){var e="default",t=window.location.host.toLowerCase();switch(t){case"demo.modustri.com":e="demo.modustri.com:5000/v1/";break;case"volvo.modustri.com":e="vapi.modustri.com/v1/";break;case"berco.modustri.com":e="bapi.modustri.com/v1/";break;case"dev.modustri.com":e="devapi.modustri.com/v1/";break;case"devportal.modustri.com":e="api.modustri.com/v2/";break;case"local.modustri.com":case"jrmbp.local:5757":case"jesses-macbook-pro.local:5757":e="api.modustri.com/v2/";break;default:e="api.modustri.com/v2/"}var n={BASE_URL:"http://"+e,ITEMS_PER_PAGE:30,SUPPORT_EMAIL:"cs@modustri.com",SUPPORT_PHONE:"844-226-5800"};return n}),ModustriServices.factory("Utilities",["$http",function(e){var t={};return t.getDatestring=function(e){return moment.unix(e).utc().format("MM/DD/YYYY")},t.getTimestamp=function(e){var t=moment.utc().format("hh:mm:ss");return moment.utc(e+" "+t,"MM/DD/YYYY hh:mm:ss").unix()},t.snakeCase=function(e){var t=e.toLowerCase();return t=t.replace(/\s/g,"_"),t.match(/s$/)||(t+="s"),t},t.mmToIn=function(e){var t=mathjs();return t.round(.0393701*parseFloat(e),2)},t.inToMm=function(e){var t=mathjs();return t.round(.0393701*parseFloat(e),2)},t.showLoading=function(){0===angular.element(".ajax-loading-mask").length&&angular.element("body").append('<div class="ajax-loading-mask"></div>'),angular.element(".ajax-loading-mask").show()},t.hideLoading=function(){angular.element(".ajax-loading-mask").hide()},t.validateForm=function(e){if(void 0!==e&&e.$invalid){if(e.$setDirty(!0),e.$error.required.length>0)for(var t=0;t<e.$error.required.length;t++)e.$error.required[t].$dirty=!0;return alert("Oops! Change a few things up and try submitting again."),!1}return!0},t}]),ModustriServices.factory("CustomerServices",["$log","$http","$q","AuthServices","AppSettings",function(e,t,n,r,a){"use strict";var i={};return i.get=function(n,i){return void 0===i&&(i=!1),t.get(a.BASE_URL+"customer/"+r.getUserHash()+"/"+r.getUserID()+"/"+n+"/",{cache:i}).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getAll=function(){return t.get(a.BASE_URL+"customers/"+r.getUserHash()+"/"+r.getUserID()+"/",{cache:!0}).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getByName=function(n){var i={name:n,dealer_id:r.getDealerID()};return t.post(a.BASE_URL+"customers/"+r.getUserHash()+"/"+r.getUserID()+"/",i).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getDealerCustomers=function(){var n={};return r.getUserLevel()>=2&&(n={dealer_id:r.getDealerID()}),t.post(a.BASE_URL+"customers/"+r.getUserHash()+"/"+r.getUserID()+"/",n).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getNumberOfCustomers=function(){var n={type:"dealercustomers"};return r.getUserLevel()>=2&&(n.id=r.getDealerID()),t.post(a.BASE_URL+"stats/"+r.getUserHash()+"/"+r.getUserID()+"/",n).success(function(e,t,n){return e.results}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getByFirstLetters=function(n,i,s){void 0===s&&(s=52);var o={name:n,page:i,perpage:s};return r.getUserLevel()>=2&&(o={name:n,page:i,perpage:s,dealer_id:r.getDealerID()}),t.post(a.BASE_URL+"customers/"+r.getUserHash()+"/"+r.getUserID()+"/",o).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.addAction=function(n,i,s,o,c,l){var u={model:n,serial:i,type:s,note:o,value:c,converted:l};return t.post(a.BASE_URL+"customers/"+r.getUserHash()+"/"+r.getUserID()+"/",u).success(function(){}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.save=function(n){return t.post(a.BASE_URL+"customer/"+r.getUserHash()+"/"+r.getUserID()+"/"+n.id+"/",n).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.saveNew=function(n){return t.post(a.BASE_URL+"customer/"+r.getUserHash()+"/"+r.getUserID()+"/",n).success(function(e,n,i){return t.post(a.BASE_URL+"dealercustomer/"+r.getUserHash()+"/"+r.getUserID()+"/",{customer_id:e.results.id,dealer_id:r.getDealerID()}),e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getEmptyCustomer=function(){return{name:"",city:"",address:"",country:"",email:"",phone:"",zip:"",state:"",primary_contact_id:""}},i.savePhoto=function(e){var t=n.defer(),s=new FormData,o=e.customer_obj;delete o.archived,s.append("customer_obj",e.customer_obj),s.append("file",e.file),s.append("customer_id",e.customer_obj.id),s.append("description","Customer image"),s.append("user_id",e.user_id);var c=new XMLHttpRequest;return c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var e=JSON.parse(c.response);o.image_id=e.results.id,i.save(o).then(function(e){}),t.resolve(!0)}else 4===c.readyState&&200!==c.status&&(t.resolve(!1),console.warn("problem uploading customer image"))},c.open("post",a.BASE_URL+"image/"+r.getUserHash()+"/"+r.getUserID()+"/"),c.send(s),t.promise},i.del=function(n){return t.delete(a.BASE_URL+"customer/"+r.getUserHash()+"/"+r.getUserID()+"/"+n+"/").success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},i.getCustomerTest=function(e){return t.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:e,sensor:!1}}).then(function(e){var t=[];return angular.forEach(e.data.results,function(e){t.push(e.formatted_address)}),t})},i}]),ModustriServices.factory("InsServices",["$log","$q","$http","AuthServices","MachineServices","Utilities","AppSettings",function(e,t,n,r,a,i,s){"use strict";var o={},c=function(t,n,r){e.error(t),e.error(n),e.error(r)};return o.query=function(e){var t=r.getUserCreds();return r.getDealerID()&&t.level>=2?n.post(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/",{dealer_id:r.getDealerID(),perpage:s.ITEMS_PER_PAGE,page:e}).success(function(e,t,n){return e}).error(c):n.post(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/",{perpage:s.ITEMS_PER_PAGE,page:e}).success(function(e,t,n){return e}).error(c)},o.get=function(e){return n.get(s.BASE_URL+"inspection/"+r.getUserHash()+"/"+r.getUserID()+"/"+e+"/").success(function(e,t,n){return e}).error(c)},o.getForPermalink=function(e){return n.get(s.BASE_URL+"direct/inspection/"+e+"/").success(function(e,t,n){return e}).error(c)},o.getByMachineId=function(e){return n.get(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/?machine_id="+e).success(function(e,t,n){return e}).error(c)},o.getByCustomerId=function(e){return n.get(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/?customer_id="+e).success(function(e,t,n){return e}).error(c)},o.getByDealerIdStartEnd=function(e,t,a){var i=r.getUserLevel(),o={};return o=2>i?{start:t,end:a}:{dealer_id:r.getDealerID(),start:t,end:a},n.post(s.BASE_URL+"portal/dashboard/inspections/"+r.getUserHash()+"/"+r.getUserID()+"/",o).success(function(e,t,n){return e}).error(c)},o.getNewestInspectionByCustomerId=function(e){return n.post(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/",{customer_id:e,page:1,perpage:1}).success(function(e,t,n){return e}).error(c)},o.getNewestInspectionByMachineId=function(e){return n.post(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/",{machine_id:e,page:1,perpage:2}).success(function(e,t,n){return e}).error(c)},o.getByUserId=function(e){return n.get(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/?user_id="+e).success(function(e,t,n){return e}).error(c)},o.getByUserIdCustomerId=function(e,t){return n.get(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/?user_id="+e+"&customer_id="+t).success(function(e,t,n){return e}).error(c)},o.getByDateRange=function(e,t,a){return n.post(s.BASE_URL+"inspections/"+r.getUserHash()+"/"+r.getUserID()+"/",{dealer_id:r.getDealerID(),perpage:s.ITEMS_PER_PAGE,page:e,start:t,end:a}).success(function(e,t,n){return e}).error(c)},o.setMeasurementToolNames=function(e,t){var n=function(){"undefined"!=typeof o.tool_names[t.left.tool-1]&&(t.left.tool_name=o.tool_names[t.left.tool-1].label),"undefined"!=typeof o.tool_names[t.right.tool-1]&&(t.right.tool_name=o.tool_names[t.right.tool-1].label)};"undefined"==typeof o.tool_names?o.getToolTypes().then(function(t){o.tool_names=t.data.results,e.Tools=t.data.results,n()}):n()},o.setPercentages=function(e,t,n,r,a){console.log("called?");var s=!1,c,l,u,d,p=r.Ins.inspection_obj.results,m=p[e][t].left.id,h=p[e][t];r.Components[e].forEach(function(t,n){r.Components[e][n].component_id===m&&(s=r.Components[e][n])}),o.setMeasurementToolNames(r,h),s&&(a?(c=i.mmToIn(h.left.measured),l=i.mmToIn(h.right.measured)):(c=h.left.measured,l=h.right.measured),u=r.Tools[parseInt(h.left.tool,10)-1],d=r.Tools[parseInt(h.right.tool,10)-1],h.left.percentage=u?s.getWearPercentages(c,n,u.keyname):"",h.right.percentage=d?s.getWearPercentages(l,n,d.keyname):"",o.setCondition(p,e,t))},o.setMainPhoto=function(e){var n,r;if(""!==e.Ins.inspection_obj.machine.main_image_id){var i=e.Ins.inspection_obj.machine.main_image_id;if(0===i||"0"===i||null===i||void 0===i){var o=t.defer();return o.resolve({error:"bad image id"}),o.promise}e.Ins.inspection_obj.machine.img=s.BASE_URL+"imgtmb/"+e.Ins.inspection_obj.machine.main_image_id+"/",e.Ins.inspection_obj.machine.img_full=s.BASE_URL+"img/"+e.Ins.inspection_obj.machine.main_image_id+"/",r=setTimeout(function(){n=document.createElement("img"),n.src=e.Ins.inspection_obj.machine.img_full},0)}else a.get(e.Ins.machine_id).then(function(i){""!==i.data.results.main_image_id&&a.getPhoto(i.data.results.main_image_id).then(function(a){var i=a.data.results.id;if(0===i||"0"===i||null===i||void 0===i){var o=t.defer();return o.resolve({error:"bad image id"}),o.promise}e.Ins.inspection_obj.machine.img=s.BASE_URL+"imgtmb/"+i+"/",e.Ins.inspection_obj.machine.img_full=s.BASE_URL+"img/"+i+"/",r=setTimeout(function(){n=document.createElement("img"),n.src=e.Ins.inspection_obj.machine.img_full},0)})})},o.cleanUpNulls=function(e){if("(null)"===e.Ins.inspection_obj.machine.equipment_id&&(e.Ins.inspection_obj.machine.equipment_id="N/A"),e.Ins.inspection_obj.machine.hasOwnProperty("hour_meter_reading")){var t=e.Ins.inspection_obj.machine.hour_meter_reading,n=e.Ins.inspection_obj.hour_meter_reading;n>t&&(e.Ins.inspection_obj.machine.hour_meter_reading=n)}else e.Ins.inspection_obj.machine.hour_meter_reading=e.Ins.inspection_obj.hour_meter_reading;if(e.Ins.inspection_obj.machine.hasOwnProperty("hour_meter_operational")){var r=e.Ins.inspection_obj.machine.hour_meter_operational,a=e.Ins.inspection_obj.hour_meter_operational;a>r&&(e.Ins.inspection_obj.machine.hour_meter_operational=a)}else e.Ins.inspection_obj.machine.hour_meter_operational=e.Ins.inspection_obj.hour_meter_operational;if(e.Ins.inspection_obj.machine.hasOwnProperty("odometer_reading")){var i=e.Ins.inspection_obj.machine.odometer_reading,s=e.Ins.inspection_obj.odometer_reading;s>i&&(e.Ins.inspection_obj.machine.odometer_reading=s)}else e.Ins.inspection_obj.machine.odometer_reading=e.Ins.inspection_obj.odometer_reading;if(e.Ins.inspection_obj.machine.hasOwnProperty("hours_per_week")){var o=e.Ins.inspection_obj.machine.hours_per_week,c=e.Ins.inspection_obj.hours_per_week;c>o&&(e.Ins.inspection_obj.machine.hours_per_week=c)}else e.Ins.inspection_obj.machine.hours_per_week=e.Ins.inspection_obj.hours_per_week},o.getInspectionCount=function(){return n.post(s.BASE_URL+"stats/"+r.getUserHash()+"/"+r.getUserID()+"/",{type:"dealerinspections",id:r.getDealerID()}).success(function(e,t,n){return e}).error(c)},o.getInspectionCountByRange=function(e,t){return n.post(s.BASE_URL+"stats/"+r.getUserHash()+"/"+r.getUserID()+"/",{type:"inspectionsbyuserlevel",id:r.getUserID(),start:e,end:t}).success(function(e,t,n){return e}).error(c)},o.FailCalc=function(e,t,n){var r=e.hours-t.hours,a=e.pct-t.pct,i=r/a,s=n-e.pct;if(0===r)return 0;var o=s*i;return o},o.buildSummariesTable=function(e){var t=[];t[1]="Ultrasonic",t[2]="Depth Gauge",t[3]="Tape Measure",t[4]="Caliper";var n=[],r=e.Ins.machine_id,i=e.Ins.id;e.Ins.inspection_obj.hasOwnProperty("maintenance_date")&&(e.Ins.inspection_obj.maintenance_datestring=new moment.unix(e.Ins.inspection_obj.maintenance_date).format("MM/DD/YYYY")),a.getProjections(r).then(function(t){if(e.Ins.inspection_obj.hasOwnProperty("remaining_life")||(e.Ins.inspection_obj.remaining_life=""),t.data.results.length>0)for(var r in t.data.results){var a=t.data.results[r];for(var s in a){var o=a[s];if(o.a_ins_id===i){var c=e.Ins.inspection_obj.results[s],l=""+o.am.lm,u=""+o.am.rm;if("string"!=typeof c)for(var d in c)"model_id"!==d&&(l==c[d].left.measured&&(c[d].left.hours_left=Math.round(o.l_h[70],0),c[d].left.hours_left_100=Math.round(o.l_h[100],0),c[d].left.hours_left_120=Math.round(o.l_h[120],0),c[d].left.comp=s,c[d].left.comp_type=s.replace("_"," "),c[d].left.dir="L",c[d].left.full_wear_date=new moment.unix(o.adate).add(o.l_date[100],"seconds").format("MMM DD, YYYY"),c[d].left.over_wear_date=new moment.unix(o.adate).add(o.l_date[120],"seconds").format("MMM DD, YYYY"),c[d].left.measured=o.am.lm,c[d].left.percentage=o.am.lpct+"%",n.push(c[d].left)),u==c[d].right.measured&&(c[d].right.hours_left=Math.round(o.r_h[70],0),c[d].right.hours_left_100=Math.round(o.r_h[100],0),c[d].right.hours_left_120=Math.round(o.r_h[120],0),c[d].right.comp=s,c[d].right.comp_type=s.replace("_"," "),c[d].right.dir="R",c[d].right.full_wear_date=new moment.unix(o.adate).add(o.r_date[100],"seconds").format("MMM DD, YYYY"),c[d].right.over_wear_date=new moment.unix(o.adate).add(o.r_date[120],"seconds").format("MMM DD, YYYY"),c[d].right.measured=o.am.rm,c[d].right.percentage=o.am.rpct+"%",n.push(c[d].right)))}}}n.sort(function(e,t){return-1*(parseInt(e.percentage,10)-parseInt(t.percentage,10))}),e.Summaries=n,e.$emit("summaries_table_built")})},o.getFailureDates=function(e){var t,n,r=1e3*e.Ins.timestamp,a=6048e5,i,s,o,c,l,u,d,p,m,h=parseInt(e.Ins.inspection_obj.hour_meter_reading,10),g="",f=parseInt(e.Ins.inspection_obj.hours_per_week,10);e.Ins.inspection_obj.machine.hasOwnProperty("remaining_life")||(e.Ins.inspection_obj.machine.remaining_life=""),"undefined"!=typeof e.Prev_ins&&e.Prev_ins!==!1&&(g=parseInt(e.Prev_ins.inspection_obj.hour_meter_reading,10),_.forEach(e.Ins.inspection_obj.results,function(v,b,y){_.forEach(v,function(_,v,b){_.hasOwnProperty("left")&&_.left.hasOwnProperty("percentage")&&h>0&&(u=h-g,u>0&&(""===_.left.percentage||isNaN(_.left.percentage)||0===parseInt(_.left.percentage,10)||(p=100*u/parseInt(_.left.percentage,10),m=120*u/parseInt(_.left.percentage,10),p=parseInt(p,10),m=parseInt(m,10),d=p,_.left.hours_left=d-u,(_.left.hours_left<e.Ins.inspection_obj.machine.remaining_life||""===e.Ins.inspection_obj.machine.remaining_life)&&(e.Ins.inspection_obj.machine.remaining_life=_.left.hours_left),_.left.hours_left_100=p-u,_.left.hours_left_120=m-u,e.Ins.timestamp>0&&f>0&&(t=parseInt(_.left.hours_left_100/f,10),t?(n=parseInt(t*a,10),i=r+n,s=new Date(i),o=s.getDate(),c=s.getMonth(),l=s.getFullYear(),c++,_.left.full_wear_date=c+"/"+o+"/"+l,t=parseInt(_.left.hours_left_120/f,10),n=parseInt(t*a,10),i=r+n,s=new Date(i),o=s.getDate(),c=s.getMonth(),l=s.getFullYear(),c++,_.left.over_wear_date=c+"/"+o+"/"+l):(_.left.full_wear_date=0,_.left.over_wear_date=0))),""===_.right.percentage||isNaN(_.right.percentage)||0===parseInt(_.right.percentage,10)||(p=100*u/parseInt(_.right.percentage,10),m=120*u/parseInt(_.right.percentage,10),p=parseInt(p,10),m=parseInt(m,10),d=p,_.right.hours_left=d-u,(_.right.hours_left<e.Ins.inspection_obj.machine.remaining_life||""===e.Ins.inspection_obj.machine.remaining_life)&&(e.Ins.inspection_obj.machine.remaining_life=_.right.hours_left),_.right.hours_left_100=p-u,_.right.hours_left_120=m-u,e.Ins.timestamp>0&&f>0&&(t=parseInt(_.right.hours_left_100/f,10),t?(n=parseInt(t*a,10),i=r+n,s=new Date(i),o=s.getDate(),c=s.getMonth(),l=s.getFullYear(),c++,_.right.full_wear_date=c+"/"+o+"/"+l,t=parseInt(_.right.hours_left_120/f,10),n=parseInt(t*a,10),i=r+n,s=new Date(i),o=s.getDate(),c=s.getMonth(),l=s.getFullYear(),c++,_.right.over_wear_date=c+"/"+o+"/"+l):(_.right.full_wear_date=0,_.right.over_wear_date=0)))))})}))},o.renderInspectionPhotos=function(e,t){var n,r,a=e.Ins.inspection_obj,i=[],o=[];t.data.hasOwnProperty("results")&&t.data.results.length>0&&(a.imgs=[],_.each(t.data.results,function(e,t,n){_.each(a.results,function(t,n,r){if("string"!=typeof t){var c=t.length;if(c>0)for(var l=0;c>l;l++)t[l].hasOwnProperty("left")&&t[l].left.hasOwnProperty("image_timestamp")&&e.timestamp===t[l].left.image_timestamp&&(a.results[n][l].left.image_url=s.BASE_URL+"imgtmb/"+e.id,a.results[n][l].left.image_full_url=s.BASE_URL+"img/"+e.id,i[l]=document.createElement("img"),i[l].src=s.BASE_URL+"img/"+e.id+"/"),t[l].hasOwnProperty("right")&&t[l].right.hasOwnProperty("image_timestamp")&&e.timestamp===t[l].right.image_timestamp&&(a.results[n][l].right.image_url=s.BASE_URL+"imgtmb/"+e.id,a.results[n][l].right.image_full_url=s.BASE_URL+"img/"+e.id,o[l]=document.createElement("img"),o[l].src=s.BASE_URL+"img/"+e.id+"/")}})}))},o.save=function(e,t){return n.post(s.BASE_URL+"inspection/"+r.getUserHash()+"/"+r.getUserID()+"/"+t+"/",e).success(function(e,t,n){return e}).error(c)},o.saveNew=function(e){return n.post(s.BASE_URL+"inspection/"+r.getUserHash()+"/"+r.getUserID()+"/",e).success(function(e,t,n){return e}).error(c)},o.del=function(e){return n.delete(s.BASE_URL+"inspection/"+r.getUserHash()+"/"+r.getUserID()+"/"+e+"/").success(function(e,t,n){return e}).error(c)},o.queryJobSites=function(){return n.get(s.BASE_URL+"jobsites/"+r.getUserHash()+"/"+r.getUserID()+"/").success(function(e,t,n){return e}).error(c)},o.getJobSite=function(e){return n.get(s.BASE_URL+"jobsite/"+r.getUserHash()+"/"+r.getUserID()+"/?id="+e+"/").success(function(e,t,n){return e}).error(c)},o.getToolTypes=function(){return n.get(s.BASE_URL+"measuretypes/"+r.getUserHash()+"/"+r.getUserID()+"/",{cache:!0}).success(function(e,t,n){return e}).error(c)},o.setComponentDescription=function(e){"id"in e.left&&a.getComponentData(e.left.id).then(function(t){e.description=t.data.results.description})},o.setCondition=function(e,t,n){var r="",a="";"undefined"!=typeof e[t][n].left&&"undefined"!=typeof e[t][n].left.percentage&&(r=parseInt(e[t][n].left.percentage,10),e[t][n].left.condition=r>25&&75>r?"fair":25>=r?"good":r>=75?"poor":"poor"),"undefined"!=typeof e[t][n].right&&"undefined"!=typeof e[t][n].right.percentage&&(a=parseInt(e[t][n].right.percentage,10),e[t][n].right.condition=a>25&&75>a?"fair":25>=a?"good":a>=75?"poor":"poor")},o.getEmptyInspection=function(){return{inspection_obj:{jobsite:{id:"",lon:"",lat:"",contact_id:"",address:"",customer_id:"",name:"",modified:"",archived:""},dealer:{id:"",phone:"",city:"",address:"",name:"",zip:"",primary_contact_id:"",state:"",archived:"",image_id:""},manufacturer:{id:"",us_dealers:"",company:""},machine:{id:"",customer_id:"",dealer_id:"",model:"",serial:"",equipment_id:"",manufacturer_id:"",hour_meter_operational:"",under_carriage_code:"",under_carriage_brand:"",hour_meter_reading:"",main_image_id:"",model_id:"",note:"",modified:"",archived:"",last_inspected:"",track_type_id:"",sales_rep:"",product_support_sales_rep:"",lat:"",lon:""},results:{track_links:[],track_sag:{left:"",right:""},dry_joints:{left:"",right:""},frame_extension:{left:"",right:""},shoe_width:{left:"",right:""},hour_meter_reading:"",bushing_allowable_wear:"greater",carrier_rollers:[],underfoot_conditions:{impact:"med",packing:"med",abrasive:"med",moisture:"med"},track_rollers:[],link_allowable_wear:"greater",sprockets:[],bushings:[],idlers_front:[],idlers_rear:[],track_shoes:[]},customer:{id:"",name:"",address:"",city:"",state:"",zip:"",country:"",phone:"",primary_contact_id:"",note:"",image_id:"",modified:"",archived:"",last_inspected:""},user:{id:"",username:"",password:"",customer_id:"",email:"",dealer_id:"",salt:"",modified:"",userlevel:"",archived:""},inspector:"",hours_per_week:"",maintenance_date:"",inspectionTypeGET:"",inspectionTypeGeneral:"",inspectionTypeUCI:""},job_site_id:"",dealer_id:"",user_id:"",timestamp:"",customer_id:"",machine_id:"",completed:0}},o.saveGeneralPhotos=function(e){var n=t.defer(),a=new FormData;a.append("file",e.file),a.append("description",e.description),a.append("user_id",e.user_id);var i=new XMLHttpRequest;return i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var e=i.response+"",t=JSON.parse(e);n.resolve(t.results)}else 4===i.readyState&&200!==i.status&&(n.resolve(!1),console.warn("problem uploading image"))},i.open("post",s.BASE_URL+"image/"+r.getUserHash()+"/"+r.getUserID()+"/"),i.send(a),n.promise},o}]),ModustriServices.factory("MachineServices",["$http","$q","AuthServices","Utilities","AppSettings",function(e,t,n,r,a){"use strict";var i={},s=function(e,t,n){console.error(e),console.error(t),console.error(n)};return i.query=function(t,r){if(t||(t=1),r)return e.post(a.BASE_URL+"machines/"+n.getUserHash()+"/"+n.getUserID()+"/?page="+t,{customer_id:r,perpage:a.ITEMS_PER_PAGE}).success(function(e,t,n){return e}).error(s);var i={dealer_id:n.getDealerID(),perpage:a.ITEMS_PER_PAGE};return n.getUserLevel()<2&&(i={perpage:a.ITEMS_PER_PAGE}),e.post(a.BASE_URL+"machines/"+n.getUserHash()+"/"+n.getUserID()+"/?page="+t,i).success(function(e,t,n){return e}).error(s)},i.get=function(t,r){return"undefined"==typeof r&&(r=!0),e.get(a.BASE_URL+"machine/"+n.getUserHash()+"/"+n.getUserID()+"/"+t+"/",{cache:r}).success(function(e,t,n){return e}).error(s)},i.getProjections=function(t){return e.get(a.BASE_URL+"machineratings/"+n.getUserHash()+"/"+n.getUserID()+"/"+t+"/",{cache:!0}).success(function(e,n,r){return e.machine_id=t,e}).error(s)},i.getByCustomerId=function(t,r,i){var o={customer_id:t};return void 0==i&&(i=a.ITEMS_PER_PAGE),void 0!==r&&(o.perpage=i,o.page=r),e.post(a.BASE_URL+"machines/"+n.getUserHash()+"/"+n.getUserID()+"/",o).success(function(e,t,n){return e}).error(s)},i.getByModelId=function(t,r){return e.post(a.BASE_URL+"machines/"+n.getUserHash()+"/"+n.getUserID()+"/",{model_id:t,dealer_id:r}).success(function(e,t,n){return e}).error(s)},i.getBySerial=function(t){return e.post(a.BASE_URL+"machines/"+n.getUserHash()+"/"+n.getUserID()+"/",{serial:t}).success(function(e,t,n){return e}).error(s)},i.save=function(t){return e.post(a.BASE_URL+"machine/"+n.getUserHash()+"/"+n.getUserID()+"/"+t.id+"/",t).success(function(e,t,n){return e}).error(s)},i.saveNew=function(t){return e.post(a.BASE_URL+"machine/"+n.getUserHash()+"/"+n.getUserID()+"/",t).success(function(e,t,n){return e}).error(s)},i.queryManufacturers=function(){return e.get(a.BASE_URL+"manufacturers/"+n.getUserHash()+"/"+n.getUserID()+"/",{cache:!0}).success(function(e,t,n){return e}).error(s)},i.getManufacturerById=function(t){return e.get(a.BASE_URL+"manufacturer/"+n.getUserHash()+"/"+n.getUserID()+"/"+t+"/",{cache:!0}).success(function(e,t,n){return e}).error(s)},i.queryModels=function(t,r){return t?e.post(a.BASE_URL+"models/"+n.getUserHash()+"/"+n.getUserID()+"/",{manufacturer_id:t}).success(function(e,t,n){return e}).error(s):e.get(a.BASE_URL+"models/"+n.getUserHash()+"/"+n.getUserID()+"/").success(function(e,t,n){return e}).error(s)},i.getEmptyMachine=function(){return{id:"",main_image_id:"",manufacturer_id:"",serial:"",dealer_id:"",hour_meter_operational:"",under_carriage_brand:"",equipment_id:"",hour_meter_reading:"",customer_id:"",model:"",under_carriage_code:"",sales_rep:"",product_support_sales_rep:"",image_upload:""}},i.queryPhotos=function(t){return e.get(a.BASE_URL+"images/?machine_id="+t).success(function(e,t,n){return e}).error(s)},i.getPhoto=function(t){return e.get(a.BASE_URL+"image/"+n.getUserHash()+"/"+n.getUserID()+"/"+t+"/").success(function(e,t,n){return e}).error(s)},i.savePhoto=function(e){var r=t.defer(),s=new FormData,o=e.machine_obj;delete o.archived,s.append("machine_obj",e.machine_obj),s.append("machine_id",e.machine_id),s.append("file",e.file),s.append("customer_id",e.customer_id),s.append("description","Machine image"),s.append("user_id",e.user_id);var c=new XMLHttpRequest;return c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var e=c.response+"",t=JSON.parse(e);o.main_image_id=t.results.id,i.save(o).then(function(e){console.log("Machine saved with new image.")}),r.resolve(!0)}else 4===c.readyState&&200!==c.status&&(r.resolve(!1),console.warn("problem uploading image"))},c.open("post",a.BASE_URL+"image/"+n.getUserHash()+"/"+n.getUserID()+"/"),c.send(s),r.promise},i.getPhotoThumb=function(t){return e.get(a.BASE_URL+"imagetmb/"+t+"/").success(function(e,t,n){return e}).error(s)},i.getInspectionPhotos=function(t){return e.get(a.BASE_URL+"images/?inspection_id="+t).success(function(e,t,n){return e}).error(s)},i.del=function(t){return e.delete(a.BASE_URL+"machine/"+n.getUserHash()+"/"+n.getUserID()+"/"+t+"/").success(function(e,t,n){return e}).error(s)},i.getComponentsByMachineModel=function(t,r){e.post(a.BASE_URL+"componentmodels/"+n.getUserHash()+"/"+n.getUserID()+"/",{model_id:t}).success(r).error(s)},i.getComponentData=function(t){return e.get(a.BASE_URL+"component/"+n.getUserHash()+"/"+n.getUserID()+"/"+t+"/").success(function(e,t,n){return e}).error(s)},i.getComponentTypes=function(){return e.get(a.BASE_URL+"componenttypes/"+n.getUserHash()+"/"+n.getUserID()+"/").success(function(e,t,n){var r=[];return angular.forEach(e.results,function(e,t){r.push(e.type)}),r.push("Idlers Rear"),r.push("Idlers Front"),r})},i.getComponentTypesMachineNames=function(){var r=t.defer();return e.get(a.BASE_URL+"componenttypes/"+n.getUserHash()+"/"+n.getUserID()+"/").then(function(e,t,n){var a=[],i;angular.forEach(e.data.results,function(e,t){i=e.type.toLowerCase(),i=i.replace(/\s/g,"_"),i.match(/s$/)||(i+="s"),a.push(i)}),a.push("idlers_front"),a.push("idlers_rear"),r.resolve(a)}),r.promise},i.getPartManufacturers=function(){return e.get(a.BASE_URL+"partmanufacturers/"+n.getUserHash()+"/"+n.getUserID()+"/",{cache:!0}).success(function(e,t,n){return e}).error(s)},i.createComponentObj=function(e,n){function r(){Object.defineProperties(this,{component_id:{configurable:!1,enumerable:!0,writeable:!0,get:function(){return this._component_id},set:function(e){this._component_id=e}},description:{configurable:!1,enumerable:!0,writeable:!0,get:function(){return this._description},set:function(e){this._description=e}},label:{configurable:!1,enumerable:!0,writeable:!0,get:function(){return this._label},set:function(e){this._label=e}},manufacturer_id:{configurable:!1,enumerable:!0,writeable:!0,get:function(){return this._manufacturer_id},set:function(e){this._manufacturer_id=e}},type:{configurable:!1,enumerable:!0,writeable:!0,get:function(){return this._type},set:function(e){this._type=e}},component_type_id:{configurable:!1,enumerable:!0,writeable:!0,get:function(){return this._component_type_id},set:function(e){this._component_type_id=e}},wear_maps:{configurable:!1,enumerable:!1,writeable:!0,get:function(){return this._wear_maps},set:function(e){this._wear_maps=e}}})}if(null===n){var a=t.defer();return console.error("bad component id: "+n),a.resolve(!1),a.promise}r.prototype.getWearPercentages=function(e,t,n){var r=null,a,s,o,c,l,u,d=[];i.getComponentTypes().then(function(e){d=e}),e=parseFloat(e);for(s in this.wear_maps.measures)if(this.wear_maps.measures[s].keyname===n)break;for(o in this.wear_maps.measures[s].values)if(l=this.wear_maps.measures[s].values[o],u=this.wear_maps.measures[s].values[parseInt(o,10)+1],l=parseFloat(l),u=void 0===u?null:parseFloat(u),null===u){if(null===r)switch(this.component_type_id){case 1:r="greater"==t.link_allowable_wear&&"Greater Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"greater"==t.link_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Greater Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:"lesser"==t.link_allowable_wear&&"Lesser Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"lesser"==t.link_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Lesser Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:this.wear_maps.percents[0].values[o];
break;case 2:r="greater"==t.bushing_allowable_wear&&"Greater Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"greater"==t.bushing_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Greater Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:"lesser"==t.bushing_allowable_wear&&"Lesser Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"lesser"==t.bushing_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Lesser Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:this.wear_maps.percents[0].values[o];break;case 3:r=("High Impact Wear Percent"===this.wear_maps.percents[0].label||"Low/Moderate Impact Wear Percent"===this.wear_maps.percents[0].label)&&"high"===t.impact?this.wear_maps.percents[1].values[o]:this.wear_maps.percents[0].values[o];break;default:r=this.wear_maps.percents[0].values[o]}}else if(l>=e&&e>u)switch(this.component_type_id){case 1:r="greater"==t.link_allowable_wear&&"Greater Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"greater"==t.link_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Greater Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:"lesser"==t.link_allowable_wear&&"Lesser Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"lesser"==t.link_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Lesser Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:this.wear_maps.percents[0].values[o];break;case 2:r="greater"==t.bushing_allowable_wear&&"Greater Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"greater"==t.bushing_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Greater Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:"lesser"==t.bushing_allowable_wear&&"Lesser Wear Percent"==this.wear_maps.percents[0].label?this.wear_maps.percents[0].values[o]:"lesser"==t.bushing_allowable_wear&&void 0!==typeof this.wear_maps.percents[1]&&"Lesser Wear Percent"==this.wear_maps.percents[1].label?this.wear_maps.percents[1].values[o]:this.wear_maps.percents[0].values[o];break;case 3:r=("High Impact Wear Percent"===this.wear_maps.percents[0].label||"Low/Moderate Impact Wear Percent"===this.wear_maps.percents[0].label)&&"high"===t.impact?this.wear_maps.percents[1].values[o]:this.wear_maps.percents[0].values[o];break;default:r=this.wear_maps.percents[0].values[o]}return r};var a=t.defer(),s=this.getComponentTypes,o=this.getComponentData;return t.all([o(n),s()]).then(function(e){var t=new r,n=e[1].data.results;t.component_id=e[0].data.results.id,t.manufacturer_id=e[0].data.results.part_manufacturer_id,t.component_name=e[0].data.results.name,t.component_type_id=e[0].data.results.component_type_id,t.description=e[0].data.results.description,t.wear_maps=e[0].data.results.wear_map,t.type=n[e[0].data.results.component_type_id-1].type,t.label=t.component_name+" - "+t.description,a.resolve(t)}),a.promise},i}]),Modustri.factory("UserServices",["$log","$http","$location","$q","AuthServices","AppSettings",function(e,t,n,r,a,i){"use strict";function s(e,t,r,a){var i=a.url,s=i.indexOf("?");if(-1!==s&&(i=i.substring(0,s)),403===t)n.path("/404");else{var o=404===t?"No service found at "+i+".":500===t?"Error in service at "+i+".":e;console.log(o)}}var o={};return o.getUserList=function(){var e=a.getUserLevel(),n=i.BASE_URL+"users/"+a.getUserHash()+"/"+a.getUserID()+"/?dealer_id="+a.getDealerID();return 2>e&&(n=i.BASE_URL+"users/"+a.getUserHash()+"/"+a.getUserID()+"/"),t.get(n).success(function(e){return e})},o.addUser=function(e,n,r,o,c,l){var u={username:e,email:n,userlevel:r,dealer_id:o,customer_id:c};t.post(i.BASE_URL+"user/"+a.getUserHash()+"/"+a.getUserID()+"/",u).success(l).error(s)},o.updateUser=function(e,n,r,o,c,l,u){var d={username:n,email:r,userlevel:o,dealer_id:c,customer_id:"0"};t.post(i.BASE_URL+"user/"+a.getUserHash()+"/"+a.getUserID()+"/"+e+"/",d).success(u).error(s)},o.removeUser=function(e,n){t.delete(i.BASE_URL+"user/"+a.getUserHash()+"/"+a.getUserID()+"/"+e+"/").success(n).error(s)},o.getContactById=function(e){if(0===e||null===e||"0"===e){var n=r.defer();return n.resolve({data:{results:!1}}),n.promise}return t.get(i.BASE_URL+"contact/"+a.getUserHash()+"/"+a.getUserID()+"/"+e+"/").success(function(e){return e}).error(s)},o.saveContact=function(e){var n=[],o=!1,c=r.defer();return void 0===e||""===e.trim()?(c.resolve({data:{results:{id:0}}}),c.promise):t.get(i.BASE_URL+"js/contacts/"+a.getUserHash()+"/"+a.getUserID()+"/?term="+e).then(function(n){return o=_.find(n.data,function(t){return t.value===e}),void 0!==o?(c.resolve(n),c.promise):t.post(i.BASE_URL+"contact/"+a.getUserHash()+"/"+a.getUserID()+"/",{email:e,first:" ",last:" "}).success(function(e){return e}).error(s)})},o.query=function(){return t.get(i.BASE_URL+"users/"+a.getUserHash()+"/"+a.getUserID()+"/").then(function(e){return e.data})},o.getUsersByDealer=function(e){var n=a.getUserLevel(),r={};n>=2&&(r={dealer_id:a.getDealerID()}),t.post(i.BASE_URL+"users/"+a.getUserHash()+"/"+a.getUserID()+"/",r).success(e).error(s)},o.saveSettings=function(){return t.post(i.BASE_URL+"users/"+a.getUserHash()+"/"+a.getUserID()+"/",{}).then(function(e){return e.data})},o}]),Modustri.factory("DealerServices",["$log","$http","AuthServices","AppSettings","$q",function(e,t,n,r,a){"use strict";function i(e,t,n,r){var a=r.url,i=a.indexOf("?");if(-1!==i&&(a=a.substring(0,i)),403===t)$location.path("/404");else{var s=404===t?"No service found at "+a+".":500===t?"Error in service at "+a+".":e;console.log(s)}}var s={};return s.getDealerList=function(e){t.get(r.BASE_URL+"dealers/"+n.getUserHash()+"/"+n.getUserID()+"/",{cache:!0}).success(e).error(i)},s.getDealerImg=function(e){return t.get(r.BASE_URL+"dealer/"+n.getUserHash()+"/"+n.getUserID()+"/"+e+"/").then(function(e){return e})},s.save=function(a){return t.post(r.BASE_URL+"dealer/"+n.getUserHash()+"/"+n.getUserID()+"/"+a.id+"/",a).success(function(e,t,n){return e}).error(function(t,n,r){e.error(t),e.error(n),e.error(r)})},s.saveDealerImg=function(e){var t=e.dealer_id,i=a.defer(),o=new FormData,c=e.dealer_obj;delete c.archived,o.append("dealer_obj",e.dealer_obj),o.append("file",e.file),o.append("dealer_id",e.dealer_obj.id),o.append("description","Dealer Image"),o.append("user_id",e.user_id);var l=new XMLHttpRequest;return l.onreadystatechange=function(){if(4===l.readyState&&200===l.status){var e=JSON.parse(l.response);c.image_id=e.results.id,s.save(c).then(function(e){}),i.resolve(!0)}else 4===l.readyState&&200!==l.status&&(i.resolve(!1),console.warn("problem uploading dealer image"))},l.open("post",r.BASE_URL+"image/"+n.getUserHash()+"/"+n.getUserID()+"/"),l.send(o),i.promise},s}]),Modustri.factory("PasswordServices",["$log","$http","AuthServices","AppSettings",function(e,t,n,r){"use strict";function a(e,t,n,r){var a=r.url,i=a.indexOf("?");if(-1!==i&&(a=a.substring(0,i)),403===t)$location.path("/404");else{var s=404===t?"No service found at "+a+".":500===t?"Error in service at "+a+".":e;console.log(s)}}console.log("password-srvc::PasswordServices");var i={};return i.changePassword=function(e,n,i){t.get(r.BASE_URL+"password/"+n+"/"+e+"/").success(i).error(a)},i.resetPassword=function(e,n){var i={email:e,cache:!1};t.post(r.BASE_URL+"password/reset/",i).success(n).error(a)},i.acceptInvite=function(e,n){return t.post(r.BASE_URL+"invite/accept/"+e+"/",n).success(function(e){return e}).error(a)},i}]),ModustriServices.factory("AuthServices",["$log","$http","$q","$location","AppSettings",function(e,t,n,r,a){function i(){var e={uilevel:0,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function s(){var e={uilevel:1,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function o(){var e={uilevel:2,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!0,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function c(){var e={uilevel:3,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function l(){var e={uilevel:4,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function u(){var e={uilevel:5,uiusers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!1,edit:!1,"delete":!1,view:!0},uidealers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!1,view:!0},uiimages:{all:!0,create:!0,edit:!1,"delete":!1,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!1,create:!1,edit:!1,"delete":!1,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}var d={};return d.validate=function(e,r){var i=n.defer();return e=e.toLowerCase(),t.post(a.BASE_URL+"validate/",{username:e,password:r}).then(function(t){if(0!==t.data.errors.length)console.error("bad login"),i.reject("Incorrect username or password.");else{d.authorized=!0;var n=t.data.results[0].id,a=t.data.results[0].dealer_id,s=t.data.results[0].salt,o=d.generateUserHash(e,r,s),c=t.data.results[0].userlevel;d.setUserCreds(e,r,s,o,n,a,c);var l={show_metric:!1};d.setUserSettings(l),i.resolve(d.authorized)}},function(){alert("Incorrect user name or password.")}),i.promise},d.queryUserSettings=function(e){var n;try{n=t.get(a.BASE_URL+"userprefs/"+d.getUserHash()+"/"+d.getUserID()+"/?user_id="+e)}catch(r){console.dir(r)}},d.generateUserHash=function(e,t,n){var r=new Date,a=r.getUTCHours().toString()+moment().utc().dayOfYear().toString()+(r.getUTCMonth()+1).toString()+r.getUTCFullYear().toString(),i=e+a+t+n,s=CryptoJS.SHA224(i);return s.toString(CryptoJS.enc.Hex)},d.checkUserCreds=function(){var e=d.getUserCreds(),t;"undefined"==typeof e.pass||"undefined"==typeof e.digest||"pass"in e==0||"digest"in e==0?r.path("/login/"):t=d.generateUserHash(e.user,e.pass,e.salt),d.saveUserHash(t)},d.setUserCreds=function(e,t,n,r,a,i,s){localStorage.setItem("pass",t),localStorage.setItem("salt",n),localStorage.setItem("digest",r),localStorage.setItem("user",e),localStorage.setItem("user_id",a),localStorage.setItem("dealer_id",i),localStorage.setItem("level",s)},d.getUserCreds=function(){return{user:localStorage.getItem("user"),pass:localStorage.getItem("pass"),salt:localStorage.getItem("salt"),digest:localStorage.getItem("digest"),user_id:localStorage.getItem("user_id"),dealer_id:localStorage.getItem("dealer_id"),level:localStorage.getItem("level")}},d.getUserID=function(){return localStorage.getItem("user_id")},d.getDealerID=function(){return localStorage.getItem("dealer_id")},d.getUserHash=function(){return localStorage.getItem("digest")},d.saveUserHash=function(e){localStorage.setItem("digest",e)},d.getUserSettings=function(){var e={show_metric:"false"===localStorage.getItem("show_metric")?!1:"true"};return e},d.setUserSettings=function(e){localStorage.setItem("show_metric",e.show_metric)},d.saveUserSettings=function(e){d.setUserSettings(e)},d.getMetricSetting=function(){return"false"===localStorage.getItem("show_metric")?!1:!0},d.setMetricSetting=function(e){console.log("saving settings to localStorage"),localStorage.setItem("show_metric",e)},d.getUserLevel=function(){return localStorage.getItem("level")},d.setUserLevel=function(e){return localStorage.setItem("level",e)},d.logout=function(){localStorage.clear(),$("#logo").css("background-image","url(../images/logo-beta.png)").css("width","140px"),$(".logo-wrapper").css("width","140px"),r.path(a.BASE_URL)},d.uiToggle=function(e,t,n){var r=[i(),s(),o(),c(),l(),u()],a=!1;return r.forEach(function(r){var i=r;if(i.uilevel==e){var s=i[t];a=s[n]}}),a},d}]),Modustri.factory("ScoreBoardServices",["$log","$http","$location","$q","AuthServices","AppSettings",function(e,t,n,r,a,i){"use strict";function s(e,t,r,a){var i=a.url,s=i.indexOf("?");if(-1!==s&&(i=i.substring(0,s)),403===t)n.path("/404");else{var o=404===t?"No service found at "+i+".":500===t?"Error in service at "+i+".":e;console.log(o)}}var o={};return o.getScoreBoardActions=function(e,n){return t.get(i.BASE_URL+e+"/"+a.getUserHash()+"/"+localStorage.getItem("user_id")+"/").success(n).error(s)},o.getAllScoreBoardData=function(e,n){return t.get(i.BASE_URL+e+"/"+a.getUserHash()+"/"+localStorage.getItem("user_id")+"/").success(n).error(s)},o.getScoreBoardByMachine=function(e,n,r){return t.get(i.BASE_URL+e+"/"+a.getUserHash()+"/"+localStorage.getItem("user_id")+"/?machine_id="+n+"/").success(r).error(s)},o.putScoreBoardByMachine=function(e,n,r){return t.put(i.BASE_URL+e+"/"+a.getUserHash()+"/"+localStorage.getItem("user_id")+"/?machine_id="+n+"/").success(r).error(s)},o.saveAction=function(e){return t.post(i.BASE_URL+"machineactiondate/"+a.getUserHash()+"/"+a.getUserID()+"/",e).success(function(e){return e}).error(s)},o.deleteAction=function(e){return t.delete(i.BASE_URL+"machineactiondate/"+a.getUserHash()+"/"+a.getUserID()+"/"+e+"/").success(function(e){return e}).error(s)},o.deleteScoreBoardByMachine=function(e,n,r){return t.delete(i.BASE_URL+e+"/"+a.getUserHash()+"/"+localStorage.getItem("user_id")+"/?machine_id="+n+"/").success(r).error(s)},o.queryAllScoreBoard=function(e,n){return t.get(i.BASE_URL+e+"/"+a.getUserHash()+"/"+localStorage.getItem("user_id")+"/").success(n).error(s)},o}]),ModustriServices.factory("TemplateServices",["$log","$q","$http","AuthServices","MachineServices","Utilities","AppSettings",function(e,t,n,r,a,i,s){"use strict";var o={},c=function(t,n,r){e.error(t),e.error(n),e.error(r)};return o.saveTemplate=function(e){return n.post(s.BASE_URL+"template/"+r.getUserHash()+"/"+r.getUserID()+"/"+e.id+"/",e).success(function(e,t,n){return e}).error(c)},o.getTemplates=function(){return n.get(s.BASE_URL+"templates/"+r.getUserHash()+"/"+r.getUserID()+"/").success(function(e,t,n){return e}).error(c)},o.getTemplateById=function(e){return n.get(s.BASE_URL+"template/"+r.getUserHash()+"/"+r.getUserID()+"/"+e+"/").success(function(e,t,n){return e}).error(c)},o.saveTemplateInspectionType=function(e){return n.post(s.BASE_URL+"templateinspectiontype/"+r.getUserHash()+"/"+r.getUserID()+"/"+e.id+"/",e).success(function(e,t,n){return e}).error(c)},o.getTemplateInspectionTypes=function(){return n.get(s.BASE_URL+"templateinspectiontypes/"+r.getUserHash()+"/"+r.getUserID()+"/").success(function(e,t,n){return e}).error(c)},o.removeTemplateInspectionTypesByTemplate=function(e){return n.get(s.BASE_URL+"removetemplateinspectiontypes/"+r.getUserHash()+"/"+r.getUserID()+"/?template_id="+e).success(function(e,t,n){return e}).error(c)},o.getTemplateInspectionTypesByTemplate=function(e){return n.get(s.BASE_URL+"templateinspectiontypes/"+r.getUserHash()+"/"+r.getUserID()+"/?template_id="+e).success(function(e,t,n){return e}).error(c)},o.getTemplateInspectionTypesByInspectionType=function(e){return n.get(s.BASE_URL+"templateinspectiontypes/"+r.getUserHash()+"/"+r.getUserID()+"/?inspection_type_id="+e).success(function(e,t,n){return e}).error(c)},o.saveInspectionType=function(e){return n.post(s.BASE_URL+"inspectiontype/"+r.getUserHash()+"/"+r.getUserID()+"/"+e.id+"/",e).success(function(e,t,n){return e}).error(c)},o.getInspectionTypes=function(){return n.get(s.BASE_URL+"inspectiontypes/"+r.getUserHash()+"/"+r.getUserID()+"/").success(function(e,t,n){return e}).error(c)},o.getInspectionTypesByTemplate=function(e){return n.get(s.BASE_URL+"inspectiontypes/"+r.getUserHash()+"/"+r.getUserID()+"/?template_id="+e).success(function(e,t,n){return e}).error(c)},o.getInspectionType=function(e){return n.get(s.BASE_URL+"inspectiontype/"+r.getUserHash()+"/"+r.getUserID()+"/"+e+"/").success(function(e,t,n){return e}).error(c)},o.saveTask=function(e){return n.post(s.BASE_URL+"task/"+r.getUserHash()+"/"+r.getUserID()+"/"+e.id+"/",e).success(function(e,t,n){return e}).error(c)},o.getTasks=function(){return n.get(s.BASE_URL+"tasks/"+r.getUserHash()+"/"+r.getUserID()+"/").success(function(e,t,n){return e}).error(c)},o.getTasksByInspectionType=function(e){return n.get(s.BASE_URL+"tasks/"+r.getUserHash()+"/"+r.getUserID()+"/?inspection_type_id="+e).success(function(e,t,n){return e}).error(c)},o.getTaskById=function(e){return n.get(s.BASE_URL+"task/"+r.getUserHash()+"/"+r.getUserID()+"/"+e+"/").success(function(e,t,n){return e}).error(c)},o.removeTasksByInspectionType=function(e){return n.get(s.BASE_URL+"removetasks/"+r.getUserHash()+"/"+r.getUserID()+"/?inspection_type_id="+e).success(function(e,t,n){return e}).error(c)},o}]),Modustri.controller("PasswordSetResetCtrl",["$log","$scope","$location","$routeParams","PasswordServices","Utilities",function(e,t,n,r,a,i){"use strict";t.password="",t.reset_pass_email="";var s={};n.$$path.match(/reset/)?t.handlePasswordReset=function(){"resetID"in r?a.acceptInvite(r.resetID,s).then(function(e){n.path(0===e.data.errors.length?"/update/password-reset/1":"/update/password-reset/0")}):n.path("/")}:n.$$path.match(/set/)?"inviteID"in r?t.handleInvite=function(){""!==t.password&&(s.password=t.password),a.acceptInvite(r.inviteID,s).then(function(e){n.path(0===e.data.errors.length?"/update/invite/1":"/update/invite/0")})}:n.path("/"):n.$$path.match(/reset-request/)?t.handleResetRequest=function(){}:n.path("/"),t.handlePasswordResetRequest=function(){return i.validateForm(t.password_reset_form)?void a.resetPassword(t.reset_pass_email,function(e){alert("An email has been sent. Please check your mail box.")}):!1}}]),Modustri.controller("UpdateCtrl",["$log","$scope","$location","$routeParams","$rootScope","PasswordServices","AppSettings",function(e,t,n,r,a,i,s){"use strict";function o(){u=window.setTimeout(function(){a.$apply(function(){n.path("/")})},5e3)}function c(){1==r.status?(t.msg="<h1>Success!</h1>",t.msg+="<p>Your invite has been <strong>confirmed</strong>.</p><p>You will now be forwarded to the login screen...</p>",o()):(t.msg="<h1>Uh oh.</h1>",t.msg+="<p>Your invite was not processed succesfully. Please contact Modustri Customer Support.</p>",t.msg+="<p><a href='mailto:"+s.SUPPORT_EMAIL+"'>"+s.SUPPORT_EMAIL+"</a></p>",t.msg+="<p>"+s.SUPPORT_PHONE+"</p>")}function l(){1==r.status?(t.msg="<h1>Success!</h1>",t.msg+="<p>Your password has been <strong>updated</strong>.</p><p>You will now be forwarded to the login screen...</p>",o()):(t.msg="<h1>Uh oh.</h1>",t.msg+="<p>Your password was not processed succesfully. Please contact Modustri Customer Support.</p>",t.msg+="<p><a href='mailto:"+s.SUPPORT_EMAIL+"'>"+s.SUPPORT_EMAIL+"</a></p>",t.msg+="<p>"+s.SUPPORT_PHONE+"</p>")}t.msg="";var u;switch(r.type){case"invite":c();break;case"password-reset":l()}}]);var ModustriDirectives=angular.module("ModustriDirectives",["ModustriServices"]);ModustriDirectives.directive("mdPagination",function(e,t,n){return{template:"",restrict:"A",controller:function(e){},scope:!1,link:function(t,n,r){t.$watch("pages",function(a,i){if(a!==i){var s,o,c,l,u=a,d=14,p=n[0].parentElement,m=e.url();if(l=m.match(/\d{1,}$/),null===l?l=1:(l=l[0],m=m.replace(/\/\d{1,}$/,"")),l=parseInt(l,10),d>=u)for(s=0;u>s;s++)o=document.createElement("a"),c=parseInt(s+1,10),$(o).attr("href","#"+m+"/"+c).text(c),c===l&&$(o).addClass("current-page"),n.append(o);else{var h=_.range(1,u),g=Math.ceil(d/2),f,v,b,y,w;for(y=l+g>h.length?h.length:l+g,y===h.length?b=y-d:0>=l-g?(b=1,y=b+d-1):b=l-g,s=b;y>=s;s++)o=document.createElement("a"),$(o).attr("href","#"+m+"/"+s).text(s),s===l&&$(o).addClass("current-page"),n.append(o);l>d&&(v=document.createElement("a"),v.setAttribute("href","#"+m+"/1"),v.setAttribute("class","paginatation-first"),w=document.createTextNode("‹‹"),v.appendChild(w),n.prepend(v)),l<h.length-d&&(f=document.createElement("a"),f.setAttribute("href","#"+m+"/"+h.length),f.setAttribute("class","pagination-last"),w=document.createTextNode("››"),f.appendChild(w),n.append(f))}switch(r.mdPagination){case"inspections":var I="Page "+l+" of "+t.pages,D=document.createTextNode(I),U=document.createElement("div");U.className="pagination-range",U.appendChild(D),p.appendChild(U)}}})}}}),ModustriDirectives.directive("mdMeasurement",function(e,t){return{require:"ngModel",template:"",restrict:"A",priority:5e3,scope:!1,controller:function(e){},link:function(e,t,n,r){}}}),ModustriDirectives.directive("mdAutocompleteSearch",function(e,t,n,r,a,i){return{template:"",restrict:"A",controller:function(e){},scope:!1,link:function(s,o,c){var l;if("customers"===c.mdAutocompleteSearch&&(l=i.BASE_URL+"js/customers/"+a.getUserHash()+"/"+a.getUserID()+"/",$(o).autocomplete({minLength:3,delay:0,source:function(e,t){e.dealer_id=a.getDealerID(),$.ajax({type:"post",url:l,data:e,success:function(e){t(e)}})},select:function(e,r){n.getByName(r.item.value).then(function(e){t.path("/customers/"+e.data.results[0].id)})}})),"inspectors"===c.mdAutocompleteSearch&&(l=i.BASE_URL+"js/customers/"+a.getUserHash()+"/"+a.getUserID()+"/",$(o).autocomplete({minLength:3,delay:0,source:function(e,t){e.dealer_id=a.getDealerID(),$.ajax({type:"post",url:l,data:e,success:function(e){t(e)}})},select:function(e,t){n.getByName(t.item.value).then(function(e){switch($(o).attr("id")){case"total-ins-autocomplete":s.TotalIns.customer_id=e.data.results[0].id;break;case"dispatch-autocomplete":s.Dispatch.customer_id=e.data.results[0].id}})}})),"machines"===c.mdAutocompleteSearch&&(l=i.BASE_URL+"js/machines/"+a.getUserHash()+"/"+a.getUserID()+"/",$(o).autocomplete({minLength:3,delay:0,source:function(e,t){e.dealer_id=a.getDealerID(),$.ajax({type:"post",url:l,data:e,success:function(e){t(e)}})},select:function(n,r){var i=a.getDealerID(),s=!1;e.post(l,{dealer_id:i,term:r.item.value}).then(function(e){s=_.find(e.data,function(e){return e.id=r.item.id}),s&&t.path("/machines/"+s.id)})}})),"inspections"===c.mdAutocompleteSearch&&(l=i.BASE_URL+"js/inspections/"+a.getUserHash()+"/"+a.getUserID()+"/",$(o).autocomplete({minLength:3,delay:0,source:function(e,t){e.dealer_id=a.getDealerID(),$.ajax({type:"post",url:l,data:e,success:function(e){t(e)}})},select:function(e,t){}})),"inspection-machines"===c.mdAutocompleteSearch){l=i.BASE_URL+"js/machines/"+a.getUserHash()+"/"+a.getUserID()+"/";var u;"undefined"!=typeof s.Ins&&s.Ins.inspection_obj.machine.serial&&($(o).val(s.Ins.inspection_obj.machine.serial),r.getBySerial(s.Ins.inspection_obj.machine.serial).then(function(e){s.Ins.inspection_obj.machine=e.data.results[0],s.Ins.machine_id=e.data.results[0].id,n.get(e.data.results[0].customer_id).then(function(e){u=e.data,s.Ins.customer_id=u.results.id,s.Ins.inspection_obj.customer.name=u.results.name,s.Ins.inspection_obj.customer.email=u.results.email,s.Ins.inspection_obj.customer.phone=u.results.phone,s.Ins.inspection_obj.customer.city=u.results.city,s.Ins.inspection_obj.customer.zip=u.results.zip,s.Ins.inspection_obj.customer.primary_contact_id=u.results.primary_contact_id,s.Ins.inspection_obj.customer.state=u.results.state})})),$(o).autocomplete({minLength:3,delay:0,source:function(e,t){e.dealer_id=a.getDealerID(),$.ajax({type:"post",url:l,data:e,success:function(e){t(e)}})},select:function(e,t){r.getBySerial(t.item.value).then(function(e){s.Ins.inspection_obj.machine=e.data.results[0],s.Ins.machine_id=e.data.results[0].id,n.get(e.data.results[0].customer_id).then(function(e){u=e.data,s.Ins.customer_id=u.results.id,s.Ins.inspection_obj.customer.name=u.results.name,s.Ins.inspection_obj.customer.email=u.results.email,s.Ins.inspection_obj.customer.phone=u.results.phone,s.Ins.inspection_obj.customer.city=u.results.city,s.Ins.inspection_obj.customer.zip=u.results.zip,s.Ins.inspection_obj.customer.primary_contact_id=u.results.primary_contact_id,s.Ins.inspection_obj.customer.state=u.results.state})})}})}}}}),ModustriDirectives.directive("mdAutocompleteFormField",function(e,t,n,r,a){return{template:"",restrict:"A",controller:function(e){},scope:!1,link:function(e,t,i){var s;"customers"==i.mdAutocompleteFormField&&(s=a.BASE_URL+"js/customers/"+r.getUserHash()+"/"+r.getUserID()+"/",$(t).autocomplete({minLength:1,delay:0,source:function(e,t){e.dealer_id=r.getDealerID(),$.ajax({type:"post",url:s,data:e,success:function(e){t(e)}})},select:function(t,r){n.getByName(r.item.value).then(function(t){e.Machine.customer_id=t.data.results[0].id,e.Machine.customer_name=r.item.value,e.customer_changed=!0})}})),"customers_for_inspection"===i.mdAutocompleteFormField&&(s=a.BASE_URL+"js/customers/"+r.getUserHash()+"/"+r.getUserID()+"/",$(t).autocomplete({minLength:1,delay:0,source:function(e,t){e.dealer_id=r.getDealerID(),$.ajax({type:"post",url:s,data:e,success:function(e){t(e)}})},select:function(t,r){n.getByName(r.item.value).then(function(t){e.Ins.customer_id=t.data.results[0].id,e.Ins.inspection_obj.customer.id=t.data.results[0].id,e.Ins.inspection_obj.customer.name=r.item.value})}})),"machines"===i.mdAutocompleteFormField&&(s=a.BASE_URL+"machines/"+r.getUserHash()+"/"+r.getUserID()+"/",$(t).autocomplete({minLength:1,delay:0,source:function(e,t){$.ajax({type:"get",url:s,data:e,success:function(e){t(e)}})},select:function(e,t){}}))}}}),ModustriDirectives.directive("mdPermalink",function(e,t){return{template:"",restrict:"A",scope:!1,link:function(e,n,r){var a="ABCDEGHIJKLMNOPQRSTVWXYZabcdeghijklmnopqrstvwxyz",i=document.createElement("a"),s="",o,c;if("inspectionID"in t){for(c=parseInt(t.inspectionID,10);c>0;)o=parseInt(c%a.length,10),c=parseInt(c/a.length,10),s=a[o]+s;i.href="#/perm/inspections/"+t.inspectionID,$(n).addClass("share-permalink"),i.textContent="Permalink",$(i).on("click",function(e){window.open(i),e.preventDefault()}),$(n).append(i)}}}}),ModustriDirectives.directive("mdMap",function(){return{template:"",restrict:"A",scope:!1,link:function(e,t,n){e.$watch("Ins.inspection_obj.jobsite",function(e){if("undefined"!=typeof e)var t={center:new google.maps.LatLng(e.lat,e.lon),zoom:10,mapTypeId:google.maps.MapTypeId.HYBRID},n=new google.maps.Map(document.getElementById("map-canvas"),t),r=new google.maps.LatLng(e.lat,e.lon),a=new google.maps.Marker({position:r,map:n})})}}}),ModustriDirectives.directive("mdImageUpload",function(){return{template:"",restrict:"A",scope:!1,link:function(e,t,n){var r=[],a=new FileReader,s,o=t.parent(),c=document.createElement("div"),l=document.createElement("img"),u=o.find(".remove-image"),d=t.context.attributes.scopevar;c.setAttribute("id","upload-image-wrapper"),c.setAttribute("class","upload-image-wrapper"),$(o).prepend(c),$(t).text("Drop new image here."),t=t[0],a.onload=function(e){l.src=e.target.result,$(c).append(l)},a.onerror=function(e){throw new Error("Problem reading file.")},t.addEventListener("dragover",function(e){e.preventDefault()},!1),t.addEventListener("drop",function(n){n.preventDefault();var r,s=["image/png","image/jpeg","image/gif"],o=function(e){return void 0===s||""===s||s.indexOf(e)>-1?!0:(alert("Invalid file type.  File must be one of following types "+s),!1)};return o(n.dataTransfer.files[0].type)?(a.readAsDataURL(n.dataTransfer.files[0]),e.image_upload=n.dataTransfer.files[0],d&&(e.photouploaded||(e.photouploaded=[]),p=_.find(e.photouploaded,function(e){return e.index==d.value}),void 0==p?e.photouploaded.push({order:e.photouploaded.length,index:d.value,photo:n.dataTransfer.files[0],processed:!1}):e.photouploaded[p.order]={order:p.order,index:d.value,photo:n.dataTransfer.files[0],processed:!1}),$(t).addClass("hidden-img-upload"),l.setAttribute("class",""),void u[0].addEventListener("click",function(n){if(l.setAttribute("class","hidden-preview-img"),$(t).removeClass("hidden-img-upload"),d)for(p=_.find(e.photouploaded,function(e){return e.index==d.value}),void 0!=p&&e.photouploaded.splice(p.order,1),i=0;i<e.photouploaded.length;i++)e.photouploaded[i].order=i})):!1},!1)}}}),ModustriDirectives.directive("mdToggle",function(e){var t=function(t,n,r){var a=n.context.attributes["md-toggle"].nodeValue,i=n.context.attributes.id,s=n.context.attributes.bindtoinspectionobj,o;"show_metric"===a?a="UserSettings."+a:s&&"0"==s.value||(a="Ins.inspection_obj."+a),o='<div class="onoffswitch"><input type="checkbox" name="onoffswitch"ng-model="'+a+'"ng-checked="'+a+'"class="onoffswitch-checkbox" '+(i?'id="'+i.nodeValue+'">':'id="'+a+'">')+'<label class="onoffswitch-label" '+(i?'for="'+i.nodeValue+'">':'for="'+a+'">')+'<div class="onoffswitch-inner"></div><div class="onoffswitch-switch"></div></label></div>';var c=e(o)(t);n.replaceWith(c)};return{restrict:"A",link:t}}),ModustriDirectives.directive("fileChange",function(){var e=function(e,t,n){e.files=[];var r=[];t.bind("change",function(t){for(var n=t.target.files,a=0,i=n.length;i>a;a++)r.push(n[a]);e.files=r})};return{restrict:"A",scope:!1,link:e}}),ModustriDirectives.directive("innerHtmlBind",function(){return{restrict:"A",scope:{inner_html:"=innerHtml"},link:function(e,t,n){e.inner_html=t.html()}}}),ModustriDirectives.directive("sort",function(){return{transclude:!0,template:'<a href="" ng-click="onSortClick()"><span ng-transclude></span><span ng-show="reversed && predicate===by" class="reversed">&uarr;</span><span ng-show="!reversed && predicate===by" class="notreversed">&darr;</span></a>',scope:{predicate:"=",by:"=",reversed:"="},link:function(e,t,n){e.onSortClick=function(){e.predicate===e.by?e.reversed=!e.reversed:(e.by=e.predicate,e.reversed=!1)}}}});var DraggableModule=angular.module("lvl.directives.dragdrop",["lvl.services"]);DraggableModule.directive("lvlDraggable",["$rootScope","uuid",function(e,t){return{restrict:"A",link:function(n,r,a,i){console.log("linking draggable element"),angular.element(r).attr("draggable","true");var s=angular.element(r).attr("id");s||(s=t.new(),angular.element(r).attr("id",s)),r.bind("dragstart",function(t){t.dataTransfer.setData("text",s),e.$emit("LVL-DRAG-START")}),r.bind("dragend",function(t){e.$emit("LVL-DRAG-END")})}}}]),DraggableModule.directive("lvlDropTarget",["$rootScope","uuid",function(e,t){return{restrict:"A",scope:{onDrop:"&"},link:function(n,r,a,i){var s=angular.element(r).attr("id");
s||(s=t.new(),angular.element(r).attr("id",s)),r.bind("dragover",function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}),r.bind("dragenter",function(e){angular.element(e.target).addClass("lvl-over")}),r.bind("dragleave",function(e){angular.element(e.target).removeClass("lvl-over")}),r.bind("drop",function(e){e.preventDefault&&e.preventDefault(),e.stopPropogation&&e.stopPropogation();var t=e.dataTransfer.getData("text"),r=document.getElementById(s),a=document.getElementById(t);n.onDrop({dragEl:a,dropEl:r})}),e.$on("LVL-DRAG-START",function(){var e=document.getElementById(s);angular.element(e).addClass("lvl-target")}),e.$on("LVL-DRAG-END",function(){var e=document.getElementById(s);angular.element(e).removeClass("lvl-target"),angular.element(e).removeClass("lvl-over")})}}}]),ModustriDirectives.directive("showDropdownOnHover",function(){return{link:function(e,t,n){t.bind("mouseenter",function(){var e=160;if(t.css("position","relative"),t.find(".ss-dropdown").length>0)return!1;var r=0,a=0;for(el=t[0];el&&!isNaN(el.offsetLeft)&&!isNaN(el.offsetTop);)r+=el.offsetLeft-el.scrollLeft,a+=el.offsetTop-el.scrollTop,el="webkit"==$.browser?el.parentNode:el.offsetParent;var i=0,s=e/4;angular.element(window).innerWidth()-r<e&&(i=angular.element(window).outerWidth()-r-e-10,s-=i);var o="";o+='<div class="ss-dropdown" style="left:'+i+'px">',o+='<div class="ss-arrow" style="left:'+s+'px"></div>',o+='<div class="ss-dropdown-inner">',o+=angular.element("#"+n.showDropdownOnHover).html(),o+="</div>",o+="</div>",t.append(o)}),t.bind("mouseleave",function(){t.find(".ss-dropdown").remove()})}}}),ModustriDirectives.directive("ngFocus",[function(){var e="ng-focused";return{restrict:"A",require:"ngModel",link:function(t,n,r,a){a.$focused=!1,n.bind("focus",function(r){n.addClass(e),t.$apply(function(){a.$focused=!0})}).bind("blur",function(r){n.removeClass(e),t.$apply(function(){a.$focused=!1})})}}}]),ModustriDirectives.directive("dtPicker",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){t.datepicker()}}}]),Modustri.controller("NavigationCtrl",["$log","$scope","$location","AuthServices","DealerServices","AppSettings",function(e,t,n,r,a,i){"use strict";a.getDealerImg(r.getDealerID()).then(function(e){if("image_id"in e.data.results&&null!==e.data.results.image_id){var t=i.BASE_URL+"img/"+e.data.results.image_id+"/";$("#logo").css("background-image","url("+t+")").css("width","250px"),$(".logo-wrapper").css("width","250px")}}),t.uiShow=function(e,n){return t.username=localStorage.getItem("username"),r.uiToggle(r.getUserLevel(),e,n)},t.logout=function(){t.username=!1,r.logout()},t.toggleActiveMenuItem=function(e){$("#main-wrapper").attr("class","").addClass("page-"+e)},t.isActiveNav=function(e){var t=n.path(),r=t.match(/[^/].*[^/]/g),a=e.match(/[^/].*[^/]/g);return null!==r&&r.length>0&&(t="/"+r[0]),null!==a&&a.length>0&&(e="/"+a[0]),-1!==t.indexOf(e)?!0:!1}}]),Modustri.controller("FooterNavigationCtrl",["$scope",function(e){"use strict";e.copyrightYear=new Date}]),Modustri.controller("DashboardCtrl",["$log","$scope","$routeParams","$location","$modal","$http","CustomerServices","MachineServices","InsServices","UserServices","AuthServices","ScoreBoardServices","Utilities","AppSettings","DealerServices","$filter","$q",function(e,t,n,r,a,i,s,o,c,l,u,d,p,m,h,g,f){"use strict";function v(){if(moment(t.filterValue_FromDate)>moment(t.filterValue_ToDate))return void alert("Enter a To Date later than From Date!");t.fromUnix=moment(t.filterValue_FromDate),t.toUnix=moment(t.filterValue_ToDate),t.fromUnix.subtract(5,"hours"),t.toUnix.add(19,"hours"),t.fromUnix=t.fromUnix.unix(),t.toUnix=t.toUnix.unix(),t.filter_today=moment().unix(),t.filter_thisweek=moment().weekday(0).unix(),t.filter_lastweek=moment().weekday(-7).unix(),t.filter_thismonth=moment().date(1).unix(),t.filter_lastmonth=moment().add(-1,"months").date(1).unix(),t.filter_Months=[];for(var e=moment(t.filterValue_FromDate),n=moment(t.filterValue_ToDate).add(1,"months").date(-1).unix();e.unix()<n;)t.filter_Months.push({value:e.unix(),text:e.format("MMM YYYY")}),e=e.add(1,"months");t.InspectionCache={},t.Inspections=[],c.getByDealerIdStartEnd(u.getDealerID(),t.fromUnix,t.toUnix).then(function(e){var n=e.data.results;t.InspectionCache=n,t.UpdateDispatch()})}function b(){var e=new google.maps.LatLngBounds;for(var t in B){var n=parseFloat(B[t].position.k,10),r=parseFloat(B[t].position.B,10),a=new google.maps.LatLng(n,r);e.extend(a)}P.fitBounds(e)}function y(){var e=[];t.filter_Customers={},angular.forEach(t.Inspections,function(n){"undefined"!=typeof n.inspection_obj.customer&&null!==n.inspection_obj.customer&&-1===e.indexOf(n.inspection_obj.customer.id)&&(t.filter_Customers[n.inspection_obj.customer.id]=n.inspection_obj.customer,e.push(n.inspection_obj.customer.id))})}function w(){var e=38.582436,t=-30.386832,n=new google.maps.LatLng(e,t),r={zoom:2,mapTypeId:google.maps.MapTypeId.ROADMAP,center:n};P=new google.maps.Map(document.getElementById("dispatch-manager-map"),r)}function I(){x(),angular.forEach(t.Inspections,function(e){t.tblFilterCustomer(e)&&t.tblFilterModel(e)&&t.tblFilterFromRating(e)&&t.tblFilterMonth(e)&&t.tblFilterLastThis(e)&&t.tblFilterKeyword(e)&&D(e)});for(var e in B)B[e].setMap(P);b()}function D(e){var t="./images/tmp.png";if(0!==e.job_site_id&&"undefined"!=typeof e.inspection_obj.jobsite){var n=e.inspection_obj.machine.main_image_id;n!==!1&&n>0?(t=m.BASE_URL+"imgtmb/"+n+"/",U(t,e)):(t="images/tmp.png",U(t,e))}}function U(e,n){if(0!==n.inspection_obj.jobsite.lat&&0!==n.inspection_obj.jobsite.lon){var r=new google.maps.LatLng(n.inspection_obj.jobsite.lat,n.inspection_obj.jobsite.lon),a="Not Set";"undefined"!=typeof n.inspection_obj.customer&&(a=n.inspection_obj.customer.name);var i=new google.maps.InfoWindow({content:C(e,n,a)});t.InfoWindows.push(i);var s=new google.maps.Marker({position:r,title:"Inspection Location",icon:n.markerIcon});google.maps.event.addListener(s,"click",function(){for(var e=0;e<t.InfoWindows.length;e++)t.InfoWindows[e].close();i.open(P,s)}),B.push(s)}}function C(e,t,n){var r="";t.inspection_obj.hasOwnProperty("user")&&(r=t.inspection_obj.user.username);var a='<div class="map-data-container"><div class="map-image"><img alt="Inspection '+t.id+'" src="'+e+'"/></div><div class="map-data"><h3><a href="#/inspections/'+t.id+'">Inspection '+t.id+"</a></h3>Inspector: <strong>"+r+'</strong><br />Serial: <strong><a href="#/machines/'+t.machine_id+'">'+t.inspection_obj.machine.serial+"</a></strong><br />Customer: <strong>"+n+"</strong><br /></div></div>";return a}function M(e){for(var t=0;t<B.length;t++)B[t].setMap(e)}function S(){M(null)}function x(){S(),B=[]}function j(e){var t;return"undefined"!=typeof e&&null!==e&&"Hi"!==e&&"Lo"!==e&&"NA"!==e&&""!==e?parseFloat(e):void 0}function A(e){return"undefined"==typeof e||""===e||null===e?"red":e>69?"red":e>30&&70>e?"orange":31>e?"green":void 0}function k(e,t){return;var n,r,a=e.inspection_obj,i=[],s=[];t.data.hasOwnProperty("results")&&t.data.results.length>0&&(a.imgs=[],_.each(t.data.results,function(e,t,n){_.each(a.results,function(t,n,r){if("string"!=typeof t){var o=t.length;if(o>0)for(var c=0;o>c;c++)t[c].hasOwnProperty("left")&&t[c].left.hasOwnProperty("image_timestamp")&&e.timestamp===t[c].left.image_timestamp&&(a.results[n][c].left.image_url=m.BASE_URL+"imgtmb/"+e.id+"/",a.results[n][c].left.image_full_url=m.BASE_URL+"img/"+e.id+"/",i[c]=document.createElement("img"),i[c].src="",a.totalimages++,a.images.push({comp:n+" left",image:a.results[n][c].left.image_full_url})),t[c].hasOwnProperty("right")&&t[c].right.hasOwnProperty("image_timestamp")&&e.timestamp===t[c].right.image_timestamp&&(a.results[n][c].right.image_url=m.BASE_URL+"imgtmb/"+e.id+"/",a.results[n][c].right.image_full_url=m.BASE_URL+"img/"+e.id+"/",s[c]=document.createElement("img"),s[c].src="",a.totalimages++,a.images.push({comp:n+" right",image:a.results[n][c].right.image_full_url}))}})}));var o=["track_links left","track_links right","bushings left","bushings right","track_shoes left","track_shoes right","idlers_front left","idlers_front right","idlers_rear left","idlers_rear right","carrier_rollers left","carrier_rollers right","track_rollers left","track_rollers right","sprockets left","sprockets right"];a.images=_.sortBy(a.images,function(e){return _.indexOf(o,e.comp)})}t.InspectionCache={},t.FilterLock=!1,t.FilterMD=function(){t.FilterLock=!1},t.FilterMU=function(){t.FilterLock=!1},t.filterValue_FromDate=localStorage.getItem("filterValue_FromDate")?localStorage.getItem("filterValue_FromDate"):moment().subtract(1,"months").format("MM/DD/YYYY"),t.filterValue_ToDate=localStorage.getItem("filterValue_ToDate")?localStorage.getItem("filterValue_ToDate"):moment().format("MM/DD/YYYY"),t.$watch("filterValue_FromDate",function(e){localStorage.setItem("filterValue_FromDate",e)}),t.$watch("filterValue_ToDate",function(e){localStorage.setItem("filterValue_ToDate",e)}),t.filterValue_Customer=[],t.filterValue_Model=[],t.filterValue_Month=[],t.filterValue_LastThis=0,t.filterValue_FromRating=0,t.filterValue_ToRating=120,t.filterValue_NA=!1,t.filterValue_Keyword="",t.filterMenu={customer:!1,customer_filter:"",model:!1,model_filter:""};var E=$("#spinner");E.css("width","24px").css("height","24px"),E.show(),u.checkUserCreds(),t.UserSettings=u.getUserSettings();var L=moment();c.getInspectionCountByRange(moment("01-01-"+L.year(),"MM-DD-YYYY").unix(),L.unix()).then(function(e){e.data.results.length>0&&(t.Trend.ytd_inspections=e.data.results[0].dealer_inspections,t.readySalesWidget=!0)}),t.filter_Customers={},t.filter_Models={},t.filter_Months=[],o.queryModels().then(function(e){angular.forEach(e.data.results,function(e){t.filter_Models[e.id]=e})}),t.AllMachineActionDates=[],t.MachineActions=[],d.getAllScoreBoardData("actions",function(e){t.MachineActions=e.results}),d.getAllScoreBoardData("machineactiondates",function(e){t.AllMachineActionDates=e.results}),t.Trend={ytd_inspections:0,ytd_sales:0,revenue:0,missed_opportunities:0,monthly_teamgoals:0,user_engagement:0,customer_engagement:0},v();var P,B=[];t.InfoWindows=[],t.showTrends=1,t.showFilter=1,t.showMap=1,t.showhideTrends=function(e){t.showTrends=e},t.showhideFilter=function(e){t.showFilter=e},t.showhideMap=function(e){t.showMap=e},t.DispatchReady=!1,t.Inspections=[],t.ApplyFilters=function(){t.DispatchReady=!1,v()},t.ClearFilters=function(){t.filterValue_Customer=[],t.filterValue_Model=[],t.filterValue_Month=[],t.filterValue_LastThis=0,t.filterValue_FromRating=0,t.filterValue_ToRating=120,t.filterValue_NA=!1,t.filterValue_Keyword="",t.filterValue_FromDate=moment().subtract(1,"months").format("MM/DD/YYYY"),t.filterValue_ToDate=moment().format("MM/DD/YYYY")},t.Spin=E,t.Loaded=!1,t.$watch("Loaded",function(e,n){e!==n&&(E.hide(),t.DispatchReady=!0)}),t.UpdateDispatch=function(){x();var e=t.InspectionCache.length,n=0,r=[];angular.forEach(t.InspectionCache,function(a,i){var c=parseInt(a.timestamp,10),l=parseInt(t.fromUnix,10),u=parseInt(t.toUnix,10);if(c>l&&u>c){a.hasOwnProperty("datestring")||(a.datestring=p.getDatestring(a.timestamp)),a.inspection_obj.hasOwnProperty("customer")?a.customer_name=a.inspection_obj.customer.name:s.get(a.customer_id).then(function(e){a.customer_name=e.data.results.name});var d=[];a.components=[],angular.forEach(a.inspection_obj.results,function(e,t){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var n=0;n<e.length;n++){d.push(j(e[n].left.percentage)),d.push(j(e[n].right.percentage)),e[n].component_type=t,e[n].left.percent=j(e[n].left.percentage),e[n].left.color=A(e[n].left.percent),e[n].right.percent=j(e[n].right.percentage),e[n].right.color=A(e[n].right.percent);var r=e[n].left.measured,i=!1,s=e[n].right.measured,o=!1;e[n].left.hasOwnProperty("measured_metric")||(0!==r&&r!==!1&&(i=r/.03937),e[n].left.measured_metric=isNaN(i)?"":Math.round(i,2)),e[n].right.hasOwnProperty("measured_metric")||(0!==s&&(o=s/.03937),e[n].right.measured_metric=isNaN(o)?"":Math.round(o,2)),a.components.push(e[n])}});var m=d.sort(function(e,t){return t-e});"undefined"==typeof m[0]?(a.rating="N/A",a.rating_value=-1,a.color=""):(a.rating=m[0].toString()+"%",a.rating_value=m[0]),a.color=A(a.rating_value),a.markerIcon="http://maps.google.com/mapfiles/ms/icons/"+a.color+"-dot.png";try{""!=a.inspection_obj.machine.id&&""===a.inspection_obj.machine.serial&&o.get(a.inspection_obj.machine.id).then(function(e){console.log("Called get machine"),a.inspection_obj.machine.serial=e.data.results.serial})}catch(h){}a.opportunity="",angular.forEach(t.AllMachineActionDates,function(e,n){e.inspection_id==a.id&&(a.opportunity=a.opportunity+t.MachineActions[parseInt(e.action_id)-1].abr+" ")}),a.checked=!1,r.push(a);var g=a.inspection_obj,f=g.machine.serial+" ";f+=g.machine.model+" ",f+=g.machine.manufacturer_name+" ",g.hasOwnProperty("user")&&(f+=g.user.username+" ",f+=g.user.email+" "),g.hasOwnProperty("customer")&&(f+=g.customer.name),a.show_components=0,n++,n>=e&&(t.Loaded=!0),void 0==a.inspection_obj.inspector&&void 0!=a.inspection_obj.user&&void 0!=a.inspection_obj.user.username&&(a.inspection_obj.inspector=a.inspection_obj.user.username)}else n++}),t.Inspections=r,I(),t.DispatchReady=!0,y()},t.preventHide=function(e){void 0!=e&&(e.preventDefault(),e.stopPropagation())},t.filterByCustomerText=function(){var e=[];return angular.forEach(t.filterValue_Customer,function(n){e.push(t.filter_Customers[n].name)}),0==e.length?"-- Filter by Customer --":e.join(", ")},t.filterByModelText=function(){var e=[];return angular.forEach(t.filterValue_Model,function(n){e.push(t.filter_Models[n].model)}),0==e.length?"-- Filter by Model --":e.join(", ")},t.filterByCustomer=function(e,n){t.filterValue_Customer.indexOf(e)<0?t.filterValue_Customer.push(e):t.filterValue_Customer.splice(t.filterValue_Customer.indexOf(e),1),void 0!=n&&(n.preventDefault(),n.stopPropagation(),t.filterMenu.customer=!t.filterMenu.customer)},t.tblFilterCustomer=function(e){return 0==t.filterValue_Customer.length?!0:e.inspection_obj.hasOwnProperty("customer")&&-1!=t.filterValue_Customer.indexOf(e.inspection_obj.customer.id)?!0:!1},t.filterByModel=function(e,n){t.filterValue_Model.indexOf(e)<0?t.filterValue_Model.push(e):t.filterValue_Model.splice(t.filterValue_Model.indexOf(e),1),void 0!=n&&(n.preventDefault(),n.stopPropagation(),t.filterMenu.model=!t.filterMenu.model)},t.tblFilterModel=function(e){return 0==t.filterValue_Model.length?!0:e.inspection_obj.hasOwnProperty("machine")&&-1!=t.filterValue_Model.indexOf(e.inspection_obj.machine.model_id)?!0:!1},t.tblFilterFromRating=function(e){return e.rating_value>=t.filterValue_FromRating&&e.rating_value<=t.filterValue_ToRating||t.filterValue_NA&&-1==e.rating_value?!0:!1},t.filterByMonth=function(e){t.filterValue_LastThis=0,t.filterValue_Month.indexOf(e)<0?t.filterValue_Month.push(e):t.filterValue_Month.splice(t.filterValue_Month.indexOf(e),1)},t.tblFilterMonth=function(e){if(t.filterValue_Month.length>0){for(var n=!1,r=0;r<t.filterValue_Month.length;r++){var a=moment(t.filterValue_Month[r],"X"),i=moment(e.timestamp,"X");a.month()===i.month()&&a.year()===i.year()&&(n=!0)}return n}return!0},t.tblFilterKeyword=function(e){return""==t.filterValue_Keyword?!0:e.search_field.toLowerCase().indexOf(t.filterValue_Keyword.toLowerCase())>=0?!0:t.filterValue_Keyword.toLowerCase()==(e.inspection_obj.manufacturer.company+" "+e.inspection_obj.machine.model).toLowerCase()?!0:!1},t.filterByLastThis=function(e){t.filterValue_LastThis===e?t.filterValue_LastThis=0:(t.filterValue_LastThis=e,t.filterValue_Month=[]),t.filterValue_Month=[]},t.tblFilterLastThis=function(e){var n=moment(e.datestring,"MM/DD/YYYY"),r=moment();switch(t.filterValue_LastThis){case 1:if(n.add(1,"weeks"),n.week()===r.week()&&n.year()===r.year())return!0;break;case 2:if(n.add(1,"months"),n.month()===r.month()&&n.year()===r.year())return!0;break;case 3:if(n.year()===r.year()&&n.month()===r.month()&&n.date()===r.date())return!0;break;case 4:if(n.week()===r.week()&&n.year()===r.year())return!0;break;case 5:if(n.month()===r.month()&&n.year()===r.year())return!0;break;default:return!0}return!1},t.getFilterMonthsLabel=function(){var e=[];return angular.forEach(t.filter_Months,function(n){-1!=t.filterValue_Month.indexOf(n.value)&&e.push(n.text)}),0==e.length?"Select a Month":e.join(", ")},t.$watch("filterValue_Customer",function(e,t){angular.equals(e,t)||I()}),t.$watch("filterValue_Model",function(e,t){angular.equals(e,t)||I()}),t.$watch("filterValue_FromRating",function(e,n){e===n||t.FilterLock||I()}),t.$watch("filterValue_ToRating",function(e,n){e===n||t.FilterLock||I()}),t.$watch("filterValue_NA",function(e,n){e===n||t.FilterLock||I()}),t.$watch("filterValue_Month",function(e,t){angular.equals(e,t)||I()}),t.$watch("filterValue_LastThis",function(e,t){e!==t&&I()}),t.$watch("filterValue_Keyword",function(e,t){e!==t&&I()}),t.usv_component={track_links:{name:"Link",icon_cls:"links-btn"},bushings:{name:"Bushing",icon_cls:"bushings-btn"},track_shoes:{name:"Shoe",icon_cls:"shoes-btn"},idlers_front:{name:"Front Idler",icon_cls:"idlers-btn"},idlers_rear:{name:"Rear Idler",icon_cls:"idlers-btn"},carrier_rollers:{name:"Carrier Roller",icon_cls:"carrier-rollers-btn"},track_rollers:{name:"Track Roller",icon_cls:"track-rollers-btn"},sprockets:{name:"Sprocket",icon_cls:"sprockets-btn"}},w(),t.deleteInspections=function(){if(confirm("Are you sure you want to delete selected inspections?"))for(var e=0;e<t.Inspections.length;e++)t.Inspections[e].checked&&(c.del(t.Inspections[e].id).then(function(e){}),t.Inspections.splice(e,1),e--)},t.openCarousel=function(e){t.inspection=e;var n=a.open({templateUrl:"dashboard-carousel.html",controller:"DashboardCarouselCtrl",resolve:{inspection:function(){return t.inspection}},windowClass:"dashboard-carousel-modal"})}}]),Modustri.controller("DashboardCarouselCtrl",["$scope","$modalInstance","inspection","AppSettings",function(e,t,n,r){e.images=[];for(var a in n.inspection_obj.images){var i=n.inspection_obj.images[a];i.image=r.BASE_URL+"img/"+i.id+"/",e.images.push(i)}e.insid=n.id,e.carouselIndex=0,e.close=function(){t.dismiss("cancel")}}]),Modustri.controller("CustomersListCtrl",["$log","$scope","$routeParams","$location","CustomerServices","MachineServices","InsServices","AuthServices","UserServices","Utilities","AppSettings",function(e,t,n,r,a,i,s,o,c,l,u){"use strict";o.checkUserCreds(),t.UserSettings=o.getUserSettings();var d=[],p=[],m=n.page?n.page:1;a.getNumberOfCustomers().then(function(e){if("results"in e.data==!1)console.error("problem getting number of customers.");else if(parseInt(e.data.results[0].dealer_customers,10)<=200)t.big_list=!1,m=1>m?1:m,a.getByFirstLetters(r,m,200).then(function(e){t.Customers=e.data.results,_.each(t.Customers,function(e,t,n){e.image_id>0&&(e.img=u.BASE_URL+"imgtmb/"+e.image_id+"/",e.img_full=u.BASE_URL+"img/"+e.image_id+"/",p[t]=setTimeout(function(){d[t]=document.createElement("img"),d[t].src=e.img_full},0)),null!==e.primary_contact_id&&0!==e.primary_contact_id?c.getContactById(e.primary_contact_id).then(function(t){e.email=t.data.results.email}):e.email="",i.getByCustomerId(e.id,1,1).then(function(t){e.number_of_machines=t.data.pages}),s.getByCustomerId(e.id).then(function(t){e.number_of_inspections=t.data.results.length}),a.get(e.id).then(function(t){e.name=t.data.results.name}),e.last_inspected>0&&(e.last_inspected=l.getDatestring(e.last_inspected)),s.getNewestInspectionByCustomerId(e.id).then(function(t){t.data.results[0]&&t.data.results[0].inspection_obj.user&&(e.last_inspectorid=t.data.results[0].inspection_obj.user.id,e.last_inspector=t.data.results[0].inspection_obj.user.username)})})});else{t.big_list=!0;var r=n.index?n.index:"%";m=1>m?1:m,a.getByFirstLetters(r,m).then(function(e){t.pages=e.data.pages,_.each(e.data.results,function(e,t,n){e.image_id>0&&(e.img=u.BASE_URL+"imgtmb/"+e.image_id+"/",e.img_full=u.BASE_URL+"img/"+e.image_id+"/",p[t]=setTimeout(function(){d[t]=document.createElement("img"),d[t].src=e.img_full},0)),c.getContactById(e.primary_contact_id).then(function(t){e.email=t.data.results.email}),i.getByCustomerId(e.id,1,1).then(function(t){e.number_of_machines=t.data.pages}),s.getByCustomerId(e.id).then(function(t){e.number_of_inspections=t.data.results.length}),e.last_inspected>0&&(e.last_inspected=l.getDatestring(e.last_inspected)),s.getNewestInspectionByCustomerId(e.id).then(function(t){t.data.results[0]&&t.data.results[0].inspection_obj.user&&(e.last_inspectorid=t.data.results[0].inspection_obj.user.id,e.last_inspector=t.data.results[0].inspection_obj.user.username)})}),t.Customers=e.data.results,t.PageVars={},t.PageVars.pages="undefined"==typeof e.data.pages?"":_.range(1,e.data.pages),t.PageVars.page=parseInt(m,10),t.PageVars.index=r})}})}]),Modustri.controller("CustomerCtrl",["$log","$scope","$routeParams","$location","CustomerServices","MachineServices","UserServices","InsServices","AuthServices","Utilities","AppSettings","ScoreBoardServices","$position","$modal","$q",function(e,t,n,r,a,i,s,o,c,l,u,d,p,m,h){"use strict";function g(e){var t=[];if("number"==typeof e&&(e=""+e+"%"),"undefined"!=typeof e&&null!==e&&"Hi"!==e&&"Lo"!==e&&"NA"!==e&&""!==e){try{t=e.split("%")}catch(n){}return t[0]}}function f(e,n){if(null!==e){var r={};switch(r.customer=e.inspection_obj.customer.name,r.model=e.inspection_obj.machine.model,r.serial=e.inspection_obj.machine.serial,r.equipment_id=null!==e.inspection_obj.machine.equipment_id?e.inspection_obj.machine.equipment_id:"",r.last_inspected=0===e.inspection_obj.machine.last_inspected?"":e.inspection_obj.machine.last_inspected,r.next_inspection_date="",r.hour_meter_reading=e.inspection_obj.hour_meter_reading,r.hours_per_week=e.inspection_obj.hours_per_week,null!==e.inspection_obj.jobsite?void 0!==e.inspection_obj.jobsite&&(r.jobsite=e.inspection_obj.jobsite.address):r.jobsite="",r.bushing_turned="No",r.percent_worn={},e.inspection_obj.results&&(r.percent_worn.links=v(e.inspection_obj.results,"track_links"),r.percent_worn.bushings=v(e.inspection_obj.results,"bushings"),r.percent_worn.shoes=v(e.inspection_obj.results,"track_shoes"),r.percent_worn.idlers_front=v(e.inspection_obj.results,"idlers_front"),r.percent_worn.idlers_rear=v(e.inspection_obj.results,"idlers_rear"),r.percent_worn.carrier_rollers=v(e.inspection_obj.results,"carrier_rollers"),r.percent_worn.track_rollers=v(e.inspection_obj.results,"track_rollers"),r.percent_worn.sprockets=v(e.inspection_obj.results,"sprockets")),r.hours_on_wear_surface={},e.inspection_obj.results&&(r.hours_on_wear_surface.links=b(e.inspection_obj.results,"track_links"),r.hours_on_wear_surface.bushings=b(e.inspection_obj.results,"bushings"),r.hours_on_wear_surface.shoes=b(e.inspection_obj.results,"track_shoes"),r.hours_on_wear_surface.idlers_front=b(e.inspection_obj.results,"idlers_front"),r.hours_on_wear_surface.idlers_rear=b(e.inspection_obj.results,"idlers_rear"),r.hours_on_wear_surface.carrier_rollers=b(e.inspection_obj.results,"carrier_rollers"),r.hours_on_wear_surface.track_rollers=b(e.inspection_obj.results,"track_rollers"),r.hours_on_wear_surface.sprockets=b(e.inspection_obj.results,"sprockets")),n){case"fleet":break;case"report2":r.action_required="OK",r.note=e.note}null!==r&&(t.ReportSummary[t.ReportSummary.length]=r)}}function v(e,t){var n="";return e&&e[t]&&(e[t].length>0&&(e[t]=e[t][0]),"undefined"!=typeof e[t].left&&"undefined"!=typeof e[t].left.percentage&&(n+=e[t].left.percentage,isNaN(e[t].left.percentage)||(n+="%")),"undefined"!=typeof e[t].right&&"undefined"!=typeof e[t].right.percentage&&(""!==n&&(n+=" - "),n+=e[t].right.percentage,isNaN(e[t].right.percentage)||(n+="%"))),n}function b(e,t){var n="";return e&&e[t]&&(e[t].length>0&&(e[t]=e[t][0]),"undefined"!=typeof e[t].left&&"undefined"!=typeof e[t].left.measured&&(n+=e[t].left.measured),"undefined"!=typeof e[t].right&&"undefined"!=typeof e[t].right.measured&&(""!==n&&(n+=" - "),n+=e[t].right.measured)),n}function y(){var e=[];return angular.forEach(t.Customer.MachineData,function(t){var n=$("#mach_"+t.id);n.is(":checked")&&e.push(t.id)}),e}var w=$("#spinner");w.show(),c.checkUserCreds(),t.UserSettings=c.getUserSettings(),t.SelectedAll=!1,t.Months={},t.past=12,t.fut=12,t.Customer={},t.CustInsCache=[],t.PartManufCache=[],t.ReportSummary=[],t.new_customer=!1,t.machine_page="",t.num_pages="",t.image_upload="",t.badges={},t.MachineActions={},t.MachineWearDates={},t.MachinesByID={},t.machine_page=1,t.ReportTypeList=[{id:"fleet",label:"Fleet Summary"},{id:"fleet_2",label:"Fleet Summary 2"}],t.ReportSummary=[];var I,D,U=r.url(),C=U.match(/edit/);t.UUID=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)});return t},t.UpdateScoreboardRange=function(){w.show(),t.Months={},t.MachineActions={};var e=moment().startOf("month"),n=t.past,r=t.fut;for(r=-1^r;n>r;){var a=moment().subtract(n,"months").startOf("month"),i=a.format("MMM YY"),s=a.format("MMM_YYYY"),o=a.unix();t.Months[o]={},t.Months[o].timestamp=o,t.Months[o].label=i,t.Months[o].idp=s.toLowerCase(),t.Months[o].active=o===e.unix()?!0:!1,n--}w.hide()},t.FmtMonth=function(e){return e=e.replace("_"," "),e.charAt(0).toUpperCase()+e.slice(1)},t.DeleteAction=function(e){confirm("Are you sure you want to delete this action?")&&d.deleteAction(e).then(function(){t.RefreshScoreboard(),$("#action_"+e).remove()})};var M;t.MachineSummaryModal=function(e,n){var r=$("<div></div>");r.attr("id","hover_"+e+n);var a=t.MachinesByID[e],i=a.model+" "+a.serial+" - "+t.FmtMonth(n);r.attr("title",i);var s=t.MachineWearDates[e],o=t.MachineActions[e],c="n/a",l="n/a",d="n/a",p=!1;for(var m in s)(m>p||p===!1)&&(p=m);var h=s[p];if(void 0!==h&&h.hasOwnProperty("70")){var g="n/a";if(a.hasOwnProperty("rating")){c="Past",l="Past",d="Past",g=a.rating,i+=" - "+g,r.attr("title",i);var f=parseInt(a.rating_value,10),_="";f>69?_="bgred":70>f&&f>30?_="bgyellow":30>f&&(_="bggreen"),g='<span class="'+_+'">'+g+"</span>",69>f&&(c=new moment.unix(h.adate).add(h[70],"seconds").format("MMM YYYY")),99>f&&(l=new moment.unix(h.adate).add(h[100],"seconds").format("MMM YYYY")),119>f&&(d=new moment.unix(h.adate).add(h[120],"seconds").format("MMM YYYY"))}var v=$("<fieldset><legend>Wear Estimates</legend></fieldset>");v.addClass("wear_dates");var b=$("<div></div>").addClass("cal_modal_rating");b.append($('<span><img src="/images/formbuilder/green-arrow.svg" style="height: 10px;width: auto;"> 70% '+c+"</span><br>")),b.append($('<span><img src="/images/formbuilder/orange-arrow.svg" style="height: 10px;width: auto;"> 100% '+l+"</span><br>")),b.append($('<span><img src="/images/formbuilder/red-arrow.svg" style="height: 10px;width: auto;"> 120% '+d+"</span><br>"));var y=$("<div></div>").addClass("cal_modal_img"),w=!1,I="images/tmp.png";a.main_image_id>0&&(w=u.BASE_URL+"img/"+a.main_image_id+"/",I=u.BASE_URL+"imgtmb/"+a.main_image_id+"/"),y.append('<img src="'+I+'" width="100" height="100"/>'),v.append(y),v.append(b),r.append(v)}var D=0;M=$("<fieldset><legend>Actions</legend></fieldset>").css("clear","both");for(var U in o){console.dir(o);for(var C in o[U]){var S=o[U][C];if(n===S.month){var x=$('<button value="'+S.id+'">Delete</button>');x.click(function(e){t.DeleteAction($(this).val())});var j=$('<div class="action_modal" id="action_'+S.id+'"><p><span><b>'+t.FmtMonth(S.month)+"</b> "+S.description+"</span><br>"+S.notes+"</p></div>");j.append(x),j.append($("<br>")),M.append(j),D++}}}0===D&&M.append($('<div class="action_modal" id="action_item"><p><span>No actions for this machine this month</span></p><br></div>')),r.append(M);var A=e+n,k=$('<fieldset style="margin-top: 10px;"></fieldset>').css("clear","both");k.append($("<legend></legend>").append($("<button>Add Action</button>")).click(function(){$("#add_actions_"+A).toggle()}));var E=$('<div id="add_actions_'+A+'" style="display: none;"></div>');E.append('<label for="new_action_type_'+A+'">Action Type</label>');var L=$('<select id="new_action_type_'+A+'"></select>');L.append($('<option value="" selected>Please select Action type</option>'));for(var P in t.badges){var B=t.badges[P];L.append($('<option value="'+B.id+'">'+B.abr+" - "+B.description+"</option>"))}E.append(L);var R=$('<label for="new_action_note_'+A+'">Note</label>'),T=$("<textarea></textarea>");T.attr("id","new_action_note_"+A),T.attr("rows","3").attr("cols","30"),E.append(R),E.append(T);var Y=$('<label for="cvtd_'+A+'">Converted to Sale</label>'),F=$('<input type="checkbox" value="1"></input>');F.attr("id","cvtd_"+A),E.append(Y),E.append(F),E.append($("<br>"));var O=$('<label for="val_'+A+'">Value</label>'),H=$('<input type="number"></input>');H.attr("id","val_"+A),E.append(O),E.append(H),E.append('<input type="hidden" id="ac_mon_'+A+'" value="'+n+'">'),E.append($("<br>"));var N=$('<input type="submit" value="Submit"></input>');N.click(function(e){t.AddAction(A)}),N.attr("id","submit_"+A),E.append(N),k.append(E),r.append(k),r.dialog({position:{of:$("#mon_ac_"+e+"_"+n),my:"top left",at:"top left"}})},t.AddAction=function(e){if(0===$("#new_action_type_"+e).val())return void alert("Action Type was not selected.");var n=$("#cvtd_"+e).val(),r=$("#val_"+e).val(),a=$("#ac_mon_"+e).val(),i=a.split("_"),s=$("#new_action_type_"+e).val(),o=$("#new_action_type_"+e+"  option:selected").text(),c=$("#new_action_note_"+e).val(),l=e.replace(a,""),u=moment(a).unix(),p=t.UUID(),m={machine_id:l,action_id:s,notes:c,converted:n,value:r+"",date:u,id:t.UUID()};d.saveAction(m).then(function(n){t.RefreshScoreboard(),$("#cvtd_"+e).val(""),$("#val_"+e).val(""),$("#new_action_type_"+e).val(""),$("#new_action_note_"+e).val(""),alert("Action saved");var r=$("#action_item").text();r.contains("No actions for this machine")&&$("#action_item").remove();var a=$('<button value="'+p+'">Delete</button>');a.click(function(e){t.DeleteAction($(this).val())});var s=$('<div class="action_modal" id="action_'+p+'"><p><span><b>'+i[0]+" "+i[1]+"</b> "+o+"</span><br>"+c+"</p>");s.append(a),s.append($("<br>")),M.append(s)})},t.CheckAll=function(){t.SelectedAll=t.SelectedAll===!1?!0:!1,angular.forEach(t.Customer.MachineData,function(e){var n=$("#mach_"+e.id);n.prop("checked",t.SelectedAll)})},t.state=_.isArray(C)&&"edit"===C[0]?"edit":"view";var S=function(){i.getPartManufacturers().then(function(e){void 0!==e&&angular.forEach(e.data.results,function(e){t.PartManufCache[e.id]=e.name})})};t.RefreshScoreboard=function(){w.show(),j()},t.getScoreBoardActions=function(){d.getAllScoreBoardData("actions",function(e){angular.forEach(e.results,function(e){t.badges[e.id]=e})})},t.updateMachineActions=function(){d.getAllScoreBoardData("machineactiondates",function(e){angular.forEach(e.results,function(e){var n=t.badges[e.action_id],r=e;r.abr=n.abr,r.description=n.description,r.show=!0,r.month=moment.unix(e.date).format("MMM_YYYY").toLowerCase(),t.MachineActions.hasOwnProperty(r.machine_id)||(t.MachineActions[r.machine_id]={},t.MachineActions[r.machine_id][r.month]={}),t.MachineActions[r.machine_id].hasOwnProperty(r.month)||(t.MachineActions[r.machine_id][r.month]={}),t.MachineActions[r.machine_id][r.month][r.id]=r});for(var n in t.MachineActions)for(var r in t.MachineActions[n]){var a=$('<span class="scorbrd_act_badge" id="'+t.UUID()+'">'+Object.keys(t.MachineActions[n][r]).length+"</span>"),i="";for(var s in t.MachineActions[n][r]){var o=t.MachineActions[n][r][s];i+='<span class="scorbrd_act_badge">'+o.abr+"</span>"}var c=$("#mon_ac_"+n+"_"+r);void 0!==c.parent()&&c.append(a)}})},t.FailCalc=function(e,t,n){return o.FailCalc(e,t,n)};var x={};t.updateMachineFailDates=function(){for(var e in t.MachinesByID)i.getProjections(e).then(t.HandleProjection)},t.HandleProjection=function(e){var n=e.data.machine_id,r=t.MachinesByID[n];t.MachineWearDates.hasOwnProperty(n)||(t.MachineWearDates[n]={});var a=[];for(var i in e.data.results){var s=!1,o=e.data.results[i];for(var c in o){var l=o[c];
if(a.hasOwnProperty(l.adate)||(a[l.adate]=l.a_ins_id),a.hasOwnProperty(l.bdate)||(a[l.bdate]=l.b_ins_id),-1!==l.apct&&-1!==l.bpct)if(s===!1)s=l;else{var u=l.l_h[70],d=l.r_h[70],p=s.r_h[70],m=s.l_h[70];if(0!==u||0!==d)(m>u||p>d)&&(s=l);else{var h=l.l_date[70],g=l.r_date[70],f=s.l_date[70],_=s.r_date[70];(f>h||_>g)&&(s=l)}}}if(s!==!1){var v=s.l_date;s.l_date[70]===!1&&s.r_date[70]!==!1?v=s.r_date:s.l_date[70]>s.r_date[70]&&(v=s.r_date);var b=new moment.unix(s.adate),y=new moment.unix(s.adate).add(v[70],"seconds").format("MMM_YYYY").toLowerCase(),w=new moment.unix(s.adate).add(v[100],"seconds").format("MMM_YYYY").toLowerCase(),I=new moment.unix(s.adate).add(v[120],"seconds").format("MMM_YYYY").toLowerCase();if(v[70]>v[120]||v[70]===v[120]);else{var D=v;D.rating=s.apct>s.bpct?s.apct:s.bpct,D.adate=s.adate,t.MachineWearDates[n][s.a_ins_id]=D,$("#stat_"+n+"_"+y).html('<img src="/images/formbuilder/green-arrow.svg" style="height: 15px;width: auto;">').tooltip({content:"70% projected date"}),$("#stat_"+n+"_"+w).html('<img src="/images/formbuilder/orange-arrow.svg" style="height: 15px;width: auto;">').tooltip({content:"100% projected date"}),$("#stat_"+n+"_"+I).html('<img src="/images/formbuilder/red-arrow.svg" style="height: 15px;width: auto;">').tooltip({content:"120% projected date"})}}}if(a.length>0)for(var U in a){var C=moment.unix(U).format("MMM_YYYY").toLowerCase(),M=a[U];$("#stat_"+n+"_"+C+"_insp").html('<span class="scorbrd_ins"><img src="/images/formbuilder/ipad-tools.svg" style="height: 20px;width: auto;"></span>')}};var j=function(e){t.getScoreBoardActions(),t.UpdateScoreboardRange(),i.getByCustomerId(t.Customer.id,1,1).then(function(e){t.Customer.total_machines=e.data.pages}),i.getByCustomerId(t.Customer.id,e).then(function(e){var n=h.defer();t.num_pages=e.data.pages;var r=e.data.results;for(var a in r)for(var i in r[a])("(null)"===r[a][i]||"null"===r[a][i])&&(r[a][i]="N/A");t.Customer.MachineData=r;for(var a in e.data.results){var s=e.data.results[a];t.MachinesByID[s.id]=s}t.Customer.last_inspected=0!==t.Customer.last_inspected&&"number"==typeof t.Customer.last_inspected?l.getDatestring(t.Customer.last_inspected):0;var c=0;return t.Customer.MachineData.length>0&&(c=t.Customer.MachineData[t.Customer.MachineData.length-1].id),angular.forEach(t.Customer.MachineData,function(e){void 0!==e.manufacturer_id&&(e.part_manuf=t.PartManufCache[e.manufacturer_id]),e.last_inspected=0===e.last_inspected?"":l.getDatestring(e.last_inspected),o.getNewestInspectionByMachineId(e.id).then(function(r){if(void 0!==r.data.results&&void 0!==r.data.results[0]){e.last_ispected=r.data.results[0].inspection_obj.modified;var a=moment.unix(e.last_inspected).format("MMM_YYYY").toLowerCase();$("#stat_"+e.id+"_"+a+"_insp").html('<span class="scorbrd_ins"><img src="/images/formbuilder/ipad-tools.svg" style="height: 20px;width: auto;"></span>'),t.CustInsCache[e.id]={newest:r.data.results[0]},r.data.results.length>1&&(t.CustInsCache[e.id].previous=r.data.results[1])}e.id===c&&n.resolve({last_id:c})})}),o.getByCustomerId(t.Customer.id).then(function(e){t.Customer.total_inspections=e.data.results.length||0}),n.promise}).then(function(){var e=h.defer();return angular.forEach(t.Customer.MachineData,function(n){var r=[];if(void 0!==t.CustInsCache[n.id]&&t.CustInsCache[n.id].hasOwnProperty("newest")){var a=t.CustInsCache[n.id].newest.inspection_obj.results;angular.forEach(a,function(e){if(!(void 0===e[0]||void 0===e[0].left&&void 0===e[0].right||void 0===e[0].left.percentage&&void 0===e[0].right.percentage))for(var t=0;t<e.length;t++)r.push(g(e[t].left.percentage)),r.push(g(e[t].right.percentage))})}var i=r.sort(function(e,t){return t-e});void 0===i[0]?(n.rating="N/A",n.rating_value=-1,n.bgcolor=""):(i[0]=parseInt(i[0],10),n.rating=i[0].toString()+"%",n.rating_value=i[0],i[0]>69&&(n.bgcolor="bgred"),i[0]>30&&i[0]<70&&(n.bgcolor="bgyellow"),i[0]<31&&(n.bgcolor="bggreen")),e.resolve(!0)}),e.promise}).then(function(){t.updateMachineFailDates(),t.updateMachineActions(),w.hide()})};a.get(n.customerID).then(function(e){t.Customer=e.data.results,t.Customer.image_id>0&&(t.Customer.img=u.BASE_URL+"imgtmb/"+t.Customer.image_id+"/",t.Customer.img_full=u.BASE_URL+"img/"+t.Customer.image_id+"/",I=setTimeout(function(){D=document.createElement("img"),D.src=t.Customer.img_full},0)),null!==t.Customer.primary_contact_id&&0!==t.Customer.primary_contact_id?s.getContactById(t.Customer.primary_contact_id).then(function(e){t.Customer.email=e.data.results.email}):t.Customer.email="",S(),j(),t.Customer.hide_upload="edit"===t.state?!1:!0}),t.cancelCustomer=function(){r.path("/customers/"+t.Customer.id)},t.saveCustomer=function(){if(!l.validateForm(t.customer_form))return!1;var e=!0;a.getByName(t.Customer.name).then(function(n){if(n.data.results.length>0)for(var i=0;i<n.data.results.length;i++)if(n.data.results[i].id!=t.Customer.id&&t.Customer.name==n.data.results[i].name){e=!1;break}if(!e)return alert("Duplicate name exists."),!1;var o={};delete t.Customer.archived,s.saveContact(t.Customer.email).then(function(e){t.Customer.primary_contact_id=e!==!1?e.data.results.id:0,a.save(t.Customer).then(function(e){""!==t.image_upload?(o={customer_obj:e.data.results,file:t.image_upload,description:"Customer image",user_id:c.getUserID()},a.savePhoto(o).then(function(){t.$emit("obj_saved","Customer"),alert("Customer saved."),r.path("/customers/"+t.Customer.id)})):(t.$emit("obj_saved","Customer"),alert("Customer saved."),r.path("/customers/"+t.Customer.id))})})})},t.deleteCustomer=function(){confirm("Are you sure you want to delete this customer?")&&a.del(t.Customer.id).then(function(){r.path("/customers/list/")})},t.checkMonth=function(e,t){var n=moment.unix(e.timestamp).format("MM"),r=moment.unix(t).format("MM"),a=moment.unix(e.timestamp).format("YYYY"),i=moment.unix(t).format("YYYY");return n===r&&a===i},t.createReport=function(e){var n=y();if(0===n.length)return void alert("Please choose machines.");if(null===e)return void alert("Please select report type.");var r=0;angular.forEach(n,function(a){if(void 0!==t.CustInsCache[a]){var s=t.CustInsCache[a].newest;i.get(a).then(function(a){s.inspection_obj.machine.serial=a.data.results.serial,f(s,e),++r==n.length&&setTimeout(function(){t.printReport("report_cont_"+e)},400)})}})},t.printReport=function(e){var t=$("#"+e),n=t.html(),r=window.open("","_blank","width=1024,height=768,scrollbars=yes",!0);r.document.open(),r.document.write('<html><head> <link rel="stylesheet" href="styles/resets.css"><link rel="stylesheet" href="styles/formalize.css"><link rel="stylesheet" href="styles/animate.css"><link rel="stylesheet" href="styles/main.css"><link rel="stylesheet" href="styles/misc.css"><link rel="stylesheet" href="styles/print.css" media="print" /></head><body onload="window.print()">'+n+"</html>"),r.document.close()}}]),Modustri.controller("CustomerAddCtrl",["$log","$scope","$routeParams","$location","CustomerServices","AuthServices","UserServices","Utilities",function(e,t,n,r,a,i,s,o){"use strict";i.checkUserCreds(),t.UserSettings=i.getUserSettings(),t.new_customer=!0,t.image_upload="",t.Customer=a.getEmptyCustomer(),t.cancelCustomer=function(){r.path("/customers/list")},t.saveCustomer=function(){if(!o.validateForm(t.customer_form))return!1;var e=!0;a.getByName(t.Customer.name).then(function(n){if(n.data.results.length>0)for(var o=0;o<n.data.results.length;o++)if(n.data.results[o].id!=t.Customer.id&&t.Customer.name==n.data.results[o].name){e=!1;break}if(!e)return alert("Duplicate name exists."),!1;var c={};delete t.Customer.archived,s.saveContact(t.Customer.email).then(function(e){t.Customer.primary_contact_id=e.hasOwnProperty("data")?e.data.results.id:0,a.saveNew(t.Customer).then(function(e){""!==t.image_upload?(c={customer_obj:e.data.results,file:t.image_upload,description:"Customer photo",user_id:i.getUserID()},a.savePhoto(c).then(function(e){t.$emit("obj_saved","Customer"),alert("Customer saved."),r.path("/customers/list")})):(t.$emit("obj_saved","Customer"),alert("Customer saved."),r.path("/customers/list"))})})})},t.deleteCustomer=function(){alert("There is no customer to delete.")}}]),Modustri.controller("InspectionCtrl",["$log","$scope","$q","$routeParams","$location","$http","InsServices","CustomerServices","MachineServices","UserServices","Utilities","AuthServices","DealerServices","TemplateServices","AppSettings",function(e,t,n,r,a,i,s,o,c,l,u,d,p,m,h){"use strict";d.checkUserCreds(),t.UserSettings=d.getUserSettings();var g="uiinspections",f=d.getDealerID();t.uiShow=function(e){return d.uiToggle(d.getUserLevel(),g,e)},t.savebtn_locked=!1,t.state=null,t.is_latest_ins=!1,t.photouploaded=[],t.Components={},t.Measureable_parts=[],t.Tools=[],t.Summaries=[],t.Prev_ins={};var v=new Date;t.today_unix=moment.utc().format("X"),t.today_ds=u.getDatestring(t.today_unix),t.state="inspectionID"in r?"edit":"add";var b=function(){return"inspectionTypeUCI"in t.Ins.inspection_obj==!1?!0:t.Ins.inspection_obj.inspectionTypeUCI};t.condition_class=function(e,t){var n=e;return"left"===t&&(n+=" left-percentage"),"right"===t&&(n+=" right-percentage"),n};var y=function(){l.query().then(function(e){var n=e.results;t.Ins.inspection_obj.inspector="",void 0!=t.Ins.inspection_obj.user&&void 0!=t.Ins.inspection_obj.user.username&&(t.Ins.inspection_obj.inspector=t.Ins.inspection_obj.user.username),t.UserList=n,t.$emit("inspector_list_loaded")})},w=function(){t.$watch("Ins.inspection_obj.hour_meter_reading",function(e,n){e!==n&&(t.Ins.inspection_obj.machine.hour_meter_reading=e)}),t.$watch("Ins.inspection_obj.user.id",function(e,n){var r;e!==n&&(r=_.find(t.UserList,function(t){return t.id===e}),t.Ins.inspection_obj.user.username=r.username,t.Ins.inspection_obj.user.userlevel=r.userlevel,t.Ins.inspection_obj.user.archived=r.archived,t.Ins.inspection_obj.user.customer_id=r.customer_id,t.Ins.inspection_obj.user.dealer_id=r.dealer_id,t.Ins.inspection_obj.user.email=r.email)}),t.$watch("Ins.inspection_obj.machine.serial",function(e,n){if(""!=e){I();var r;c.getBySerial(t.Ins.inspection_obj.machine.serial).then(function(e){t.Ins.inspection_obj.hour_meter_reading=e.data.results[0].hour_meter_reading,""!==e.data.results[0].main_image_id&&"false"!=e.data.results[0].main_image_id&&"(null)"!=e.data.results[0].main_image_id?(t.Ins.inspection_obj.machine.main_image_id=e.data.results[0].main_image_id,t.Ins.inspection_obj.machine.img=h.BASE_URL+"imgtmb/"+e.data.results[0].main_image_id+"/",t.Ins.inspection_obj.machine.img_full=h.BASE_URL+"img/"+e.data.results[0].main_image_id+"/"):(t.Ins.inspection_obj.machine.main_image_id="",t.Ins.inspection_obj.machine.img="",t.Ins.inspection_obj.machine.img_full=""),e.data.results[0].manufacturer_id&&(t.Ins.inspection_obj.machine.manufacturer_id=e.data.results[0].manufacturer_id,c.getManufacturerById(t.Ins.inspection_obj.machine.manufacturer_id).then(function(e){t.Ins.inspection_obj.machine.manufacturer_name=e.data.results.company})),t.Ins.inspection_obj.machine.under_carriage_brand=e.data.results[0].under_carriage_brand})}})},I=function(){var e,n,r,a="";I.cache=I.cache||{init:!1},u.showLoading(),I.act_queue={started:!0,length:1},c.getComponentsByMachineModel(t.Ins.inspection_obj.machine.model_id,function(n){t.Components=[],e=n.results,e.length>0?(I.act_queue.started=!0,I.act_queue.length=e.length):u.hideLoading();for(var r=0;r<e.length;r++)e[r].hasOwnProperty("component_id")&&c.createComponentObj(t,e[r].component_id).then(function(e){e!==!1&&(a=u.snakeCase(e.type),"idlers"!==a&&(t.Components[a]||(t.Components[a]=[]),t.Components[a]||(t.Components[a]=[]),t.Components[a].push(e),"undefined"!=typeof t.Components[a]&&"add"==t.state&&I.cache.init!==!0&&"undefined"!=typeof t.Ins.inspection_obj.results[a]&&(t.Ins.inspection_obj.results[a].model_id=t.Components[a][0].component_id)),"idlers"===a&&(t.Components.idlers_front||(a="idlers_front",t.Components[a]=[]),t.Components.idlers_front.push(e),"undefined"!=typeof t.Components[a]&&"add"==t.state&&I.cache.init!==!0&&"undefined"!=typeof t.Ins.inspection_obj.results[a]&&(t.Ins.inspection_obj.results[a].model_id=t.Components[a][0].component_id),t.Components.idlers_rear||(a="idlers_rear",t.Components[a]=[]),t.Components[a]||(t.Components[a]=[]),t.Components[a].push(e),"undefined"!=typeof t.Components[a]&&"add"==t.state&&I.cache.init!==!0&&"undefined"!=typeof t.Ins.inspection_obj.results[a]&&(t.Ins.inspection_obj.results[a].model_id=t.Components[a][0].component_id))),I.act_queue.length--,0==I.act_queue.length&&(I.act_queue.started=!1,u.hideLoading())})})},D=function(){c.getPartManufacturers().then(function(e){t.UndercarriageBrands=e.data.results})};t.removePart=function(e,n){t.Ins.inspection_obj.results[e].splice(n,1)},t.updateAllComponentData=function(e){var n=t.Ins.inspection_obj.results,r={bushing_allowable_wear:n.bushing_allowable_wear,link_allowable_wear:n.link_allowable_wear};switch(r.impact=n.underfoot_conditions.impact,r.abrasive=n.underfoot_conditions.abrasive,r.packing=n.underfoot_conditions.packing,r.moisture=n.underfoot_conditions.moisture,n.underfoot_conditions=n.underfoot_conditions||{},e){case"Track Link":_.forEach(n.track_links,function(e,a){e.left.id=e.right.id=n.track_links.model_id,s.setPercentages("track_links",a,r,t,t.UserSettings.show_metric)});break;case"Track Rollers":_.forEach(n.track_rollers,function(e,a){e.left.id=e.right.id=n.track_rollers.model_id,s.setPercentages("track_rollers",a,r,t,t.UserSettings.show_metric)});break;case"Bushing":_.forEach(n.bushings,function(e,a){e.left.id=e.right.id=n.bushings.model_id,s.setPercentages("bushings",a,r,t,t.UserSettings.show_metric)});break;case"Carrier Roller":_.forEach(n.carrier_rollers,function(e,a){e.left.id=e.right.id=n.carrier_rollers.model_id,s.setPercentages("carrier_rollers",a,r,t,t.UserSettings.show_metric)});break;case"Idler":_.forEach(n.idlers,function(e,r){e.left.id=e.right.id=n.idlers.model_id,s.setPercentages("idlers",e,r,t,t.UserSettings.show_metric)});break;case"Idler Front":_.forEach(n.idlers_front,function(e,a){e.left.id=e.right.id=n.idlers_front.model_id,s.setPercentages("idlers_front",a,r,t,t.UserSettings.show_metric)});break;case"Idler Rear":_.forEach(n.idlers_rear,function(e,a){e.left.id=e.right.id=n.idlers_rear.model_id,s.setPercentages("idlers_rear",a,r,t,t.UserSettings.show_metric)});break;case"Pins and Bushings":_.forEach(n.pins_and_bushings,function(e,a){e.left.id=e.right.id=n.pins_and_bushings.model_id,s.setPercentages("pins_and_bushings",a,r,t,t.UserSettings.show_metric)});break;case"Sprocket":_.forEach(n.sprockets,function(e,a){e.left.id=e.right.id=n.sprockets.model_id,s.setPercentages("sprockets",a,r,t,t.UserSettings.show_metric)});break;case"Track Shoe":_.forEach(n.track_shoes,function(e,a){e.left.id=e.right.id=n.track_shoes.model_id,s.setPercentages("track_shoes",a,r,t,t.UserSettings.show_metric)})}},t.updateWearPercentages=function(e,n,r){var a=t.Ins.inspection_obj.results,i={bushing_allowable_wear:a.bushing_allowable_wear,link_allowable_wear:a.link_allowable_wear};switch(i.impact=a.underfoot_conditions.impact,i.abrasive=a.underfoot_conditions.abrasive,i.packing=a.underfoot_conditions.packing,i.moisture=a.underfoot_conditions.moisture,a.underfoot_conditions=a.underfoot_conditions||{},e){case"Track Link":s.setPercentages("track_links",n,i,t,r);break;case"Track Rollers":s.setPercentages("track_rollers",n,i,t,r);break;case"Bushing":s.setPercentages("bushings",n,i,t,r);break;case"Bushings":s.setPercentages("bushings",n,i,t,r);break;case"Carrier Roller":s.setPercentages("carrier_rollers",n,i,t,r);break;case"Idler":s.setPercentages("idlers",n,i,t,r);break;case"Idler Front":s.setPercentages("idlers_front",n,i,t,r);break;case"Idler Rear":s.setPercentages("idlers_rear",n,i,t,r);break;case"Pins and Bushings":s.setPercentages("pins_and_bushings",n,i,t,r);break;case"Sprocket":s.setPercentages("sprockets",n,i,t,r);break;case"Track Shoe":s.setPercentages("track_shoes",n,i,t,r)}},t.toggleCompleted=function(){t.Ins.completed=1===t.Ins.completed?0:1},t.addPart=function(e){var n={left:{measured:"",id:"",percent:"",tool:"",tool_type:"",notes:""},right:{measured:"",id:"",percent:"",tool:"",notes:""}};"results"in t.Ins.inspection_obj==!1&&(t.Ins.inspection_obj.results={}),"undefined"==typeof t.Ins.inspection_obj.results[e]&&(t.Ins.inspection_obj.results[e]=[],t.Ins.inspection_obj.results[e].model_id=""),n.left.id=n.right.id=t.Ins.inspection_obj.results[e].model_id,t.Ins.inspection_obj.results[e].unshift(n)},t.general_images=[],"edit"===t.state?(s.get(r.inspectionID).then(function(e){t.Ins=e.data.results,c.get(t.Ins.inspection_obj.machine.id,!1).then(function(e){var n=e.data.results;""!==n.main_image_id&&n.main_image_id>0&&(t.Ins.inspection_obj.machine.main_image_id=n.main_image_id,t.Ins.inspection_obj.machine.img=h.BASE_URL+"imgtmb/"+n.main_image_id+"/",t.Ins.inspection_obj.machine.img_full=h.BASE_URL+"img/"+n.main_image_id+"/"),n.manufacturer_id&&(t.Ins.inspection_obj.machine.manufacturer_id=n.manufacturer_id,c.getManufacturerById(t.Ins.inspection_obj.machine.manufacturer_id).then(function(e){t.Ins.inspection_obj.machine.manufacturer_name=e.data.results.company})),n.model&&(t.Ins.inspection_obj.machine.model=n.model)}),void 0!==t.Ins.inspection_obj.general&&_.each(t.Ins.inspection_obj.general.template_inspection_types,function(e,n,r){t.templatetype_showhide[n]=1,_.each(e.inspection_type_tasks,function(e,t,n){e.task_instructions_object=angular.fromJson(e.task_instructions),_.each(e.task_instructions_object.steps,function(e,t,n){if(e.photos&&(e.photos.url=[],e.photos.newimage=[],_.each(e.photos.value,function(t,n,r){e.photos.url.push(""==t?"":h.BASE_URL+"imgtmb/"+t),e.photos.newimage.push(!1)})),e.rating){e.rating.rating_increment||(e.rating.rating_min=1,e.rating.rating_max=10,e.rating.rating_increment=1),e.rating.values=[];for(var r=e.rating.rating_min;r<=e.rating.rating_max;r+=e.rating.rating_increment)e.rating.values.push(r);e.rating.width=20*((e.rating.value-e.rating.rating_min)/e.rating.rating_increment+1),e.rating.width_gray=(e.rating.rating_max-e.rating.value)/e.rating.rating_increment*20}e.boolean&&(e.boolean.boolean_type&&0!=e.boolean.boolean_type?1==e.boolean.boolean_type?e.boolean.values={0:"No",1:"Yes"}:2==e.boolean.boolean_type&&(e.boolean.values={0:"Off",1:"On"}):e.boolean.values={0:"Incomplete",1:"Complete"})})})}),t.Measureable_parts=[];var n={};t.Prev_ins=!1,"results"in t.Ins.inspection_obj==!1&&(t.Ins.inspection_obj.results={}),c.queryPhotos(t.Ins.inspection_obj.machine.id).then(function(e){angular.forEach(e.data.results,function(e,n){"General Image"==e.description&&e.inspection_id==r.inspectionID&&t.general_images.push({url:h.BASE_URL+"imgtmb/"+e.id,name:e.description})})}),"false"==t.Ins.inspection_obj.machine.main_image_id&&(t.Ins.inspection_obj.machine.main_image_id="",t.Ins.inspection_obj.machine.img="",t.Ins.inspection_obj.machine.img_full=""),c.get(t.Ins.machine_id).then(function(e){t.Ins.inspection_obj.machine.equipment_id=e.data.results.equipment_id,t.Ins.inspection_obj.machine.id<1&&(t.Ins.inspection_obj.machine.id=t.Ins.machine_id),t.Ins.inspection_obj.machine.serial=e.data.results.serial,0==t.Ins.inspection_obj.machine.main_image_id&&e.data.results.main_image_id>0&&(t.Ins.inspection_obj.machine.main_image_id=e.data.results.main_image_id,t.Ins.inspection_obj.machine.img=h.BASE_URL+"imgtmb/"+t.Ins.inspection_obj.machine.main_image_id+"/",t.Ins.inspection_obj.machine.img_full=h.BASE_URL+"/img/"+t.Ins.inspection_obj.machine.main_image_id+"/")}),o.get(t.Ins.customer_id).then(function(e){var n=e.data.results;t.Ins.inspection_obj.customer=t.Ins.inspection_obj.customer||{},t.Ins.inspection_obj.customer.name=n.name,t.Ins.customer_name=n.name,t.Ins.inspection_obj.customer.id=n.id,t.Ins.inspection_obj.customer.address=n.address,t.Ins.inspection_obj.customer.city=n.city,t.Ins.inspection_obj.customer.state=n.state,t.Ins.inspection_obj.customer.zip=n.zip,t.Ins.inspection_obj.customer.primary_contact_id=n.primary_contact_id,t.$emit("inspection_loaded",t.Ins)}),s.getByMachineId(t.Ins.machine_id).then(function(e){if(t.prev_ins_arr=e.data.results,t.prev_ins_arr.length>0)if(t.prev_ins_arr.sort(function(e,t){return parseInt(e.timestamp,10)<parseInt(t.timestamp,10)?1:parseInt(e.timestamp,10)>parseInt(t.timestamp,10)?-1:parseInt(e.timestamp,10)===parseInt(t.timestamp,10)?0:void 0}),t.Ins.timestamp==t.prev_ins_arr[0].timestamp)t.is_latest_ins=!0,t.Prev_ins=t.prev_ins_arr[1];else for(var n=1;n<=t.prev_ins_arr.length;n++)if(void 0!==t.prev_ins_arr[n]&&parseInt(t.prev_ins_arr[n].timestamp,10)<parseInt(t.Ins.timestamp,10)){t.Prev_ins=t.prev_ins_arr[n];break}t.Prev_ins&&s.getFailureDates(t),s.buildSummariesTable(t)}),s.cleanUpNulls(t),t.Ins.datestring=u.getDatestring(t.Ins.timestamp),t.Ins.dealer_id=d.getDealerID(),s.setMainPhoto(t),_.each(t.Ins.inspection_obj.results,function(e,t,n){if(!e.hasOwnProperty("model_id")||!e.model_id)for(var r in e)if("undefined"!=typeof e[r]&&e[r].hasOwnProperty("left")){e.model_id=e[r].left.id||e[r].right.id;var a=e[r].left.measured,i=!1,o=e[r].right.measured,l=!1;e[r].left.hasOwnProperty("measured_metric")||(0!==a&&a!==!1&&(i=a/.03937),e[r].left.measured_metric=isNaN(i)?"":Math.round(i,2)),e[r].right.hasOwnProperty("measured_metric")||(0!==o&&(l=o/.03937),e[r].right.measured_metric=isNaN(l)?"":Math.round(l,2))}_.each(e,function(e,r,a){s.setCondition(n,t,r),e.hasOwnProperty("left")&&e.left.hasOwnProperty("id")&&null!=e.left.id&&c.getComponentData(e.left.id).then(function(t){e.left.compdata=t.data.results}),e.hasOwnProperty("right")&&e.right.hasOwnProperty("id")&&null!=e.right.id&&c.getComponentData(e.right.id).then(function(t){e.right.compdata=t.data.results}),e.hasOwnProperty("left")&&e.left.hasOwnProperty("install_date")&&(e.left.install_datestring=u.getDatestring(e.left.install_date)),e.hasOwnProperty("right")&&e.right.hasOwnProperty("install_date")&&(e.right.install_datestring=u.getDatestring(e.right.install_date))})}),c.getInspectionPhotos(t.Ins.id).then(function(e){s.renderInspectionPhotos(t,e)}),I(),y(),D(),s.getToolTypes().then(function(e){t.Tools=e.data.results}),p.getDealerImg(f).then(function(e){t.Ins.dealer_img_url="image_id"in e.data.results&&null!==e.data.results.image_id?h.BASE_URL+"img/"+e.data.results.image_id+"/":!1}),n=t.Ins.inspection_obj.results,c.getComponentTypesMachineNames().then(function(e){t.Measureable_parts=e,angular.forEach(n,function(e,r){_.contains(t.Measureable_parts,r)&&angular.forEach(n[r],function(e,a){s.setMeasurementToolNames(t,n[r][a]),s.setComponentDescription(n[r][a])})}),w()})}),t.saveInspection=function(){t.savebtn_locked=!0;var e=angular.copy(t.Ins),n=e.id;return""===t.Ins.datestring?void alert("Inspection Date should not be empty"):(""===t.Ins.inspection_obj.maintenance_datestring&&(t.Ins.inspection_obj.maintenance_datestring=u.getDatestring(t.today_unix)),e.timestamp=u.getTimestamp(e.datestring),e.inspection_obj.maintenance_date=u.getTimestamp(t.Ins.inspection_obj.maintenance_datestring),t.Ins.inspection_obj.maintenance_date=u.getTimestamp(t.Ins.inspection_obj.maintenance_datestring),delete e.machine,delete e.customer,delete e.id,delete e.archived,delete e.modified,delete e.note,delete e.dealer_img_url,delete e.inspector,delete e.datestring,delete e.inspection_obj.maintenance_datestring,angular.forEach(e.results,function(t){angular.forEach(t,function(n){"description"in e.results[t][n]&&delete e.results[t][n].description,"tool_name"in e.results[t][n].left&&delete e.results[t][n].left.tool_name,"tool_name"in e.results[t][n].right&&delete e.results[t][n].right.tool_name})}),void(t.photouploaded&&t.photouploaded.length>0?(console.log("uploading general photos..."),_.each(t.photouploaded,function(r,a,i){var o={file:r.photo,description:"Inspection's General Photo",user_id:d.getUserID()};s.saveGeneralPhotos(o).then(function(i){if(0==i)console.log("inspection general photo has been failed");else{console.log("inspection general photo has been saved");var s=r.index.split("_"),o=t.Ins.inspection_obj.general.template_inspection_types[s[0]].inspection_type_tasks[s[1]].task_instructions_object.steps[s[2]].photos;o.value[s[3]]=i.id,o.url[s[3]]=h.BASE_URL+"imgtmb/"+i.id}r.processed=!0,a+1==t.photouploaded.length&&t.saveInspectionReally(e,n)})})):t.saveInspectionReally(e,n)))},t.saveInspectionReally=function(e,n){void 0!==t.Ins.inspection_obj.general&&_.each(t.Ins.inspection_obj.general.template_inspection_types,function(e,t,n){_.each(e.inspection_type_tasks,function(e,t,n){for(var r=0;r<e.task_instructions_object.steps.length;r++){var a=e.task_instructions_object.steps[r];a.boolean&&(a.boolean.value=a.boolean.value?1:0)}e.task_instructions=angular.toJson(e.task_instructions_object)})}),_.each(t.Ins.inspection_obj.results,function(e,t,n){_.each(e,function(e,t,n){e.hasOwnProperty("left")&&e.left.hasOwnProperty("install_datestring")&&(e.left.install_date=u.getTimestamp(e.left.install_datestring),delete e.left.install_datestring),e.hasOwnProperty("right")&&e.right.hasOwnProperty("install_datestring")&&(e.right.install_date=u.getTimestamp(e.right.install_datestring),delete e.left.install_datestring)})}),e.inspection_obj=JSON.stringify(t.Ins.inspection_obj),s.save(e,n).then(function(r){alert("Inspection saved."),t.is_latest_ins&&(e=t.Ins.inspection_obj.machine,delete e.img_full,delete e.img,delete e.archived,c.save(e).then(function(e){console.log("Machine updated.")})),t.$emit("inspection_saved",r),a.path("/inspections/"+n)})},t.addPhoto=function(e){e.newimage.push(!1),e.url.push(""),e.value.push("")},t.deletePhoto=function(e,n,r,a,i){if(confirm("Really Delete?")){var s=_.find(t.photouploaded,function(e){return e.index==n+"_"+r+"_"+a+"_"+i});void 0!=s&&t.photouploaded.splice(s.order,1);for(var o=0;o<t.photouploaded.length;o++)t.photouploaded[o].order=o;$("#photo-upload-"+n+"-"+r+"-"+a+"-"+i+" .upload-image-wrapper img").remove(),e.newimage.splice(i,1),e.url.splice(i,1),e.value.splice(i,1)}},t.$watch("photouploaded",function(e,t){}),t.deleteInspection=function(){confirm("Are you sure you want to delete this inspection?")&&s.del(t.Ins.id).then(function(e){t.$emit("inspection_deleted",e),a.path("/inspections/list/")})}):(t.Ins=s.getEmptyInspection(),t.Ins.dealer_id=d.getDealerID(),t.Ins.datestring=t.today_ds,t.Ins.inspection_obj.maintenance_datestring=t.today_ds,t.Ins.inspection_obj.user.id=d.getUserID(),t.Ins.user_id=d.getUserID(),t.machine_img="images/tmp.png",t.Ins.inspection_obj.machine.manufacturer_name="",I(),y(),D(),s.getToolTypes().then(function(e){t.Tools=e.data.results}),"undefined"!=typeof r.machineID&&(t.Ins.inspection_obj.machine.serial=r.machineID,c.getBySerial(t.Ins.inspection_obj.machine.serial).then(function(e){t.Ins.inspection_obj.hour_meter_reading=e.data.results[0].hour_meter_reading})),p.getDealerImg(f).then(function(e){t.Ins.dealer_img_url="image_id"in e.data.results&&null!==e.data.results.image_id?h.BASE_URL+"img/"+e.data.results.image_id+"/":!1}),w(),t.saveInspection=function(){if(""===t.Ins.machine_id)return void alert("Please pick a machine to associate with this inspection.");if(""===t.Ins.datestring)return void alert("Inspection Date should not be empty");t.savebtn_locked=!0;var e=angular.copy(t.Ins);e.timestamp=u.getTimestamp(e.datestring),e.inspection_obj.maintenance_date="undefined"==typeof e.inspection_obj.maintenance_datestring||""===e.inspection_obj.maintenance_datestring?e.timestamp:u.getTimestamp(e.inspection_obj.maintenance_datestring),delete e.machine,delete e.customer,delete e.id,delete e.archived,delete e.inspector,delete e.dealer_img_url,delete e.datestring,delete e.inspection_obj.maintenance_datestring,""==e.customer_id&&(e.customer_id=0),e.inspection_obj.customer.id=e.customer_id,_.each(t.Ins.inspection_obj.results,function(e,t,n){_.each(e,function(e,t,n){e.hasOwnProperty("left")&&e.left.hasOwnProperty("install_datestring")&&(e.left.install_date=u.getTimestamp(e.left.install_datestring),delete e.left.install_datestring),e.hasOwnProperty("right")&&e.right.hasOwnProperty("install_datestring")&&(e.right.install_date=u.getTimestamp(e.right.install_datestring),delete e.left.install_datestring)})}),e.inspection_obj=JSON.stringify(e.inspection_obj),s.saveNew(e).then(function(n){alert("Inspection saved."),t.$emit("inspection_saved",n),e=t.Ins.inspection_obj.machine,delete e.img_full,delete e.img,c.save(e).then(function(e){}),a.path("/inspections/"+n.data.results.id)})}),t.toggleGeneralImages=function(){$("#imagesSection").slideToggle("normal")},t.generalimages_showhide=1,t.comppanels_showhide=1,t.templatetype_showhide=[],t.comp_showhide={sprocket:1,bushing:1,frontidler:1,carrierroller:1,link:1,shoe:1,rearidler:1,trackroller:1},t.comppanels_left={sprocket:{id:"sprocket",dtarray:"sprockets",showhide:1,title:"Sprockets",icon:"svg/sprockets.svg"},bushing:{id:"bushing",dtarray:"bushings",showhide:1,title:"Bushings",icon:"svg/bushings.svg"},frontidler:{id:"frontidler",dtarray:"idlers_front",showhide:1,title:"Front Idlers",icon:"svg/idler.svg"},carrierroller:{id:"carrierroller",dtarray:"carrier_rollers",showhide:1,title:"Carrier Rollers",icon:"svg/carrier_rollers.svg"}},t.comppanels_right={link:{id:"link",dtarray:"track_links",showhide:1,title:"Links",icon:"svg/links.svg"},shoe:{id:"shoe",dtarray:"track_shoes",showhide:1,title:"Shoes",icon:"svg/shoes.svg"},rearidler:{id:"rearidler",dtarray:"idlers_rear",showhide:1,title:"Rear Idlers",icon:"svg/idler.svg"},trackroller:{id:"trackroller",dtarray:"track_rollers",showhide:1,title:"Track Rollers",icon:"svg/track_rollers.svg"}},t.edit_comps={0:{id:"link",icon_cls:"links-btn",dtarray:"track_links",title:"Track Link",label:"Track Links",icon:"svg/links.svg",showhide:1},1:{id:"bushing",icon_cls:"bushings-btn",dtarray:"bushings",title:"Bushing",label:"Bushings",icon:"svg/bushings.svg",showhide:1},2:{id:"shoe",icon_cls:"shoes-btn",dtarray:"track_shoes",title:"Track Shoe",label:"Track Shoes",icon:"svg/shoes.svg",showhide:1},3:{id:"frontidler",icon_cls:"idlers-btn",dtarray:"idlers_front",title:"Idler Front",label:"Front Idlers",icon:"svg/idler.svg",showhide:1},4:{id:"rearidler",icon_cls:"idlers-btn",dtarray:"idlers_rear",title:"Idler Rear",label:"Rear Idlers",icon:"svg/idler.svg",showhide:1},5:{id:"carrierroller",icon_cls:"carrier-rollers-btn",dtarray:"carrier_rollers",title:"Carrier Roller",label:"Carrier Rollers",icon:"svg/carrier_rollers.svg",showhide:1},6:{id:"trackroller",icon_cls:"track-rollers-btn",dtarray:"track_rollers",title:"Track Rollers",label:"Track Rollers",icon:"svg/track_rollers.svg",showhide:1},7:{id:"sprocket",icon_cls:"sprockets-btn",dtarray:"sprockets",title:"Sprocket",label:"Sprockets",icon:"svg/sprockets.svg",showhide:1}}}]),Modustri.controller("InspectionPermalinkCtrl",["$scope","$q","$http","InsServices","Utilities","AppSettings","MachineServices","CustomerServices","AuthServices","UserServices","DealerServices","$routeParams",function(e,t,n,r,a,i,s,o,c,l,u,d){"use strict";e.UserSettings=c.getUserSettings();var p="uiinspections",m=c.getDealerID();u.getDealerImg(m).then(function(e){if("image_id"in e.data.results&&null!==e.data.results.obj&&null!==e.data.results.image_id){var t=i.BASE_URL+"img/"+e.data.results.image_id+"/";$("#logo").css("background-image","url("+t+")").css("width","250px"),$(".logo-wrapper").css("width","250px")}}),e.uiShow=function(e){return c.uiToggle(c.getUserLevel(),p,e)},e.state=null,e.is_latest_ins=!1,e.Components={},e.Measureable_parts=[],e.Tools=[],e.Summaries=[],e.Prev_ins={},e.condition_class=function(e,t){var n=e;return"left"===t&&(n+=" left-percentage"),"right"===t&&(n+=" right-percentage"),n};var h=function(){l.query().then(function(t){var n=t.results,r=_.where(n,{id:e.Ins.user_id});r[0]&&(e.Ins.inspection_obj.inspector=r[0].username),e.UserList=n})},g=function(){var t,n="";s.getComponentsByMachineModel(e.Ins.inspection_obj.machine.model_id,function(r){e.Components=[],t=r.results;for(var i=0;i<t.length;i++)t[i].hasOwnProperty("component_id")&&s.createComponentObj(e,t[i].component_id).then(function(t){n=a.snakeCase(t.type),"idlers"===n&&(e.Components.idlers_front||(e.Components.idlers_front=[]),e.Components.idlers_front.push(t),e.Components.idlers_rear||(e.Components.idlers_rear=[]),e.Components.idlers_rear.push(t)),"idlers"!==n&&(e.Components[n]||(e.Components[n]=[]),e.Components[n].push(t))
})})};r.getForPermalink(d.hash).then(function(t){e.Ins=t.data.results,e.Measureable_parts=[];var n={};"results"in e.Ins.inspection_obj==!1&&(e.Ins.inspection_obj.results={}),r.getByMachineId(e.Ins.machine_id).then(function(t){e.Prev_ins=t.data.results,e.Prev_ins.length>0?(e.Prev_ins.sort(function(e,t){return parseInt(e.timestamp,10)<parseInt(t.timestamp,10)?1:parseInt(e.timestamp,10)>parseInt(t.timestamp,10)?-1:parseInt(e.timestamp,10)===parseInt(t.timestamp,10)?0:void 0}),e.Ins.timestamp===e.Prev_ins[0].timestamp&&(e.is_latest_ins=!0),e.Prev_ins=e.Prev_ins[1]):e.Prev_ins=!1,r.getFailureDates(e),r.buildSummariesTable(e)}),r.cleanUpNulls(e),e.Ins.datestring=a.getDatestring(e.Ins.timestamp),e.Ins.MaintenanceDate=a.getDatestring(e.Ins.inspection_obj.maintenance_date),e.Ins.dealer_id=c.getDealerID(),r.setMainPhoto(e),u.getDealerImg(m).then(function(t){e.Ins.dealer_img_url="image_id"in t.data.results&&null!==t.data.results.obj?i.BASE_URL+"img/"+t.data.results.image_id+"/":!1}),_.each(e.Ins.inspection_obj.results,function(e,t,n){e.hasOwnProperty("model_id")&&e.model_id||"undefined"!=typeof e[0]&&e[0].hasOwnProperty("left")&&(e.model_id=e[0].left.id||e[0].right.id),_.each(e,function(e,a,i){r.setCondition(n,t,a)})}),s.getInspectionPhotos(e.Ins.id).then(function(t){r.renderInspectionPhotos(e,t)}),g(),h(),n=e.Ins.inspection_obj.results,s.getComponentTypesMachineNames().then(function(t){e.Measureable_parts=t,angular.forEach(n,function(t,a){_.contains(e.Measureable_parts,a)&&angular.forEach(n[a],function(t,i){r.setMeasurementToolNames(e,n[a][i]),r.setComponentDescription(n[a][i])})})}),o.get(e.Ins.customer_id).then(function(t){var n=t.data.results;e.Ins.inspection_obj.customer.name=n.name,e.Ins.inspection_obj.customer.address=n.address,e.Ins.inspection_obj.customer.city=n.city,e.Ins.inspection_obj.customer.state=n.state,e.Ins.inspection_obj.customer.zip=n.zip,e.Ins.inspection_obj.customer.primary_contact_id=n.primary_contact_id}),s.get(e.Ins.inspection_obj.machine.id).then(function(t){(!e.Ins.inspection_obj.machine.hasOwnProperty("img")||e.Ins.inspection_obj.machine.main_image_id<1&&t.data.results.main_image_id>0)&&(e.Ins.inspection_obj.machine.main_image_id=t.data.results.main_image_id,e.Ins.inspection_obj.machine.img=i.BASE_URL+"imgtmb/"+e.Ins.inspection_obj.machine.main_image_id+"/",e.Ins.inspection_obj.machine.img_full=i.BASE_URL+"/img/"+e.Ins.inspection_obj.machine.main_image_id+"/")})})}]),Modustri.controller("InspectionsListCtrl",["$log","$scope","$routeParams","$location","$modal","InsServices","UserServices","Utilities","MachineServices","CustomerServices","AuthServices","AppSettings",function(e,t,n,r,a,i,s,o,c,l,u,d){"use strict";function p(){var e=moment(t.sortFromDate).unix(),n=moment(t.sortToDate).unix();return e>n?(alert("From date cannot be later than To date"),!1):!0}u.checkUserCreds(),t.UserSettings=u.getUserSettings();var m="uiinspections",h=[],g;t.sortFromDate=localStorage.getItem("sortFromDate")||"",t.sortToDate=localStorage.getItem("sortToDate")||"";var f=n.page?n.page:1,v=function(){i.query(f).then(function(e){t.Inspections=e.data.results,t.pages=e.data.pages,t.paginationShow=t.pages>0?!0:!1;var n=Math.round((new Date).getTime()/1e3);_.each(t.Inspections,function(e,t,r){n-e.timestamp>2678400&&l.get(e.customer_id).then(function(t){var n=t.data.results;e.inspection_obj.customer=e.inspection_obj.customer||{},e.inspection_obj.customer.name=n.name,e.inspection_obj.customer.address=n.address,e.inspection_obj.customer.city=n.city,e.inspection_obj.customer.state=n.state,e.inspection_obj.customer.zip=n.zip,e.inspection_obj.customer.primary_contact_id=n.primary_contact_id}),e.datestring=o.getDatestring(e.timestamp),"machine"in e.inspection_obj&&(e.inspection_obj.machine.main_image_id!==!1&&0!==e.inspection_obj.machine.main_image_id&&"0"!==e.inspection_obj.machine.main_image_id?(e.inspection_obj.machine.img=d.BASE_URL+"imgtmb/"+e.inspection_obj.machine.main_image_id+"/",e.inspection_obj.machine.img_full=d.BASE_URL+"img/"+e.inspection_obj.machine.main_image_id+"/",g=setTimeout(function(){h[t]=document.createElement("img"),h[t].src=e.inspection_obj.machine.img_full},0)):c.get(e.machine_id).then(function(n){var r=n.data.results.main_image_id;""!==r&&r>0&&0!==r&&"0"!==r&&c.getPhoto(n.data.results.main_image_id).then(function(n){e.inspection_obj.machine.img=d.BASE_URL+"imgtmb/"+n.data.results.id+"/",e.inspection_obj.machine.img_full=d.BASE_URL+"img/"+n.data.results.id+"/",g=setTimeout(function(){h[t]=document.createElement("img"),h[t].src=e.inspection_obj.machine.img_full},0)})}),("(null)"===e.inspection_obj.machine.equipment_id||null===e.inspection_obj.machine.equipment_id)&&(e.inspection_obj.machine.equipment_id="N/A")),""!=e.inspection_obj.manufacturer.company&&e.inspection_obj.manufacturer.company||c.get(e.machine_id).then(function(t){c.getManufacturerById(t.data.results.manufacturer_id).then(function(t){e.inspection_obj.manufacturer.company=t.data.results.company})})})})},b=function(e){var n=o.getTimestamp(t.sortFromDate),r=o.getTimestamp(t.sortToDate);n-=21600,r+=64800,i.getByDateRange(e,n,r).then(function(e){t.Inspections=e.data.results,t.pages=e.data.pages,t.paginationShow=t.pages>0?!0:!1,_.each(t.Inspections,function(e,t,n){e.datestring=o.getDatestring(e.timestamp),"machine"in e.inspection_obj&&("(null)"===e.inspection_obj.machine.equipment_id&&(e.inspection_obj.machine.equipment_id="N/A"),e.inspection_obj.machine.main_image_id!==!1&&e.inspection_obj.machine.main_image_id>0&&"0"!=e.inspection_obj.machine.main_image_id&&(e.inspection_obj.machine.img=d.BASE_URL+"imgtmb/"+e.inspection_obj.machine.main_image_id+"/",e.inspection_obj.machine.img_full=d.BASE_URL+"/img/"+e.inspection_obj.machine.main_image_id+"/",h[t]=document.createElement("img"),h[t].src=e.inspection_obj.machine.img_full))})}),angular.element(".pagination-range").remove(),angular.element(".pagination").html("")};t.uiShow=function(e){return u.uiToggle(u.getUserLevel(),m,e)},t.clearDatePickers=function(){t.paginationShow=!0,localStorage.setItem("sortFromDate",""),localStorage.setItem("sortToDate",""),t.sortFromDate="",t.sortToDate="",r.path("/inspections/list/")},t.deleteInspection=function(e,n){confirm("Are you sure you want to delete this inspection?")&&i.del(e).then(function(e){t.Inspections.splice(n.$index,1),t.$emit("inspection_deleted",e)})},localStorage.getItem("sortFromDate")?b(f):v(),t.$watch("sortToDate",function(e,n){p()&&(localStorage.setItem("sortToDate",e),e!==n&&""!==t.sortFromDate&&(b(1),r.path("/inspections/list/")))}),t.$watch("sortFromDate",function(e,n){p()&&(localStorage.sortFromDate=e,e!==n&&""!==t.sortToDate&&(b(1),r.path("/inspections/list/")))}),t.img=null,t.open=function(e){t.img=e;var n=a.open({template:t.modal_html_template,controller:ModalInstanceCtrl,resolve:{img:function(){return t.img}}})}}]);var ModalInstanceCtrl=function(e,t,n){e.img=n,e.close=function(){t.dismiss("cancel")}};Modustri.controller("MachinesListCtrl",["$log","$scope","$routeParams","$location","MachineServices","CustomerServices","InsServices","AuthServices","Utilities","AppSettings",function(e,t,n,r,a,i,s,o,c,l){"use strict";function u(e){var t;return"undefined"!=typeof e&&null!==e&&"Hi"!==e&&"Lo"!==e&&"NA"!==e&&""!==e?parseFloat(e):void 0}o.checkUserCreds(),t.UserSettings=o.getUserSettings();var d=n.page?n.page:1,p,m,h;t.uiToggle=function(){return o.uiToggle()},t.deleteMachine=function(e,n){confirm("Are you sure you want to delete this machine?")&&a.del(e).then(function(e){t.Machines.splice(n.$index,1),t.$emit("obj_deleted","Machine")})},"undefined"!=typeof n.customerID&&(h=n.customerID),a.query(d,h).then(function(e){t.pages=e.data.pages,t.Machines=e.data.results,_.each(t.Machines,function(e,n,r){a.queryManufacturers().then(function(r){var a=r.data.results,i=_.where(a,{id:e.manufacturer_id});t.Machines[n].manufacturer_name=i[0].company}),""!=e.main_image_id&&"0"!==e.main_image_id&&0!==e.main_image_id&&"(null)"!=e.main_image_id&&(t.Machines[n].img=l.BASE_URL+"imgtmb/"+e.main_image_id+"/",t.Machines[n].img_full=l.BASE_URL+"img/"+e.main_image_id+"/",m=setTimeout(function(){p=document.createElement("img"),p.src=t.Machines[n].img_full},0)),i.get(e.customer_id).then(function(t){e.CustomerData=t.data.results}),e.latest_inspection=0===e.last_inspected?"n/a":c.getDatestring(e.last_inspected),s.getNewestInspectionByMachineId(e.id).then(function(t){if(t.data.results[0]){t.data.results[0].inspection_obj.user&&(e.last_inspectorid=t.data.results[0].inspection_obj.user.id,e.last_inspector=t.data.results[0].inspection_obj.user.username);var n=[];angular.forEach(t.data.results[0].inspection_obj.results,function(e,t){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var r=0;r<e.length;r++)n.push(u(e[r].left.percentage)),n.push(u(e[r].right.percentage))});var r=n.sort(function(e,t){return t-e});"undefined"==typeof r[0]?(e.rating="N/A",e.color="red"):(e.rating=r[0].toString()+"%",r[0]>69?e.color="red":r[0]>30&&r[0]<70?e.color="orange":r[0]<31&&(e.color="green"))}else e.rating="N/A",e.color="red"})})})}]),Modustri.controller("MachineAddCtrl",["$log","$scope","$routeParams","$location","MachineServices","CustomerServices","AuthServices","Utilities",function(e,t,n,r,a,i,s,o){"use strict";s.checkUserCreds(),t.UserSettings=s.getUserSettings(),t.Machine=a.getEmptyMachine(),t.image_upload="",t.Machine.main_image_id=!1,t.Machine.dealer_id=s.getDealerID(),a.queryManufacturers().then(function(e){t.ManufacturerList=e.data.results,a.queryModels(t.Machine.manufacturer_id).then(function(e){t.ModelList=e.data.results})}),t.updateMachineModels=function(e){a.queryModels(t.Machine.manufacturer_id).then(function(e){t.ModelList=e.data.results,console.log(JSON.stringify(e.data.results))})},t.$watch("Machine.model_id",function(e,n){if(e!==n){var r=_.where(t.ModelList,{id:e});t.Machine.model=r[0].model}}),t.$watch("image_upload",function(e,t){}),t.saveMachine=function(){var e={},n=!0;"undefined"==typeof t.Machine.manufacturer_id||""==t.Machine.manufacturer_id?(alert("Please select manufacturer"),n=!1):"undefined"==typeof t.Machine.serial||""==t.Machine.serial?(alert("Please input serial number"),n=!1):t.Machine.serial.length<3?(alert("Serial number should be more than 3 chars"),n=!1):"undefined"==typeof t.Machine.equipment_id||""==t.Machine.equipment_id?(alert("Please input unit number"),n=!1):"undefined"==typeof t.Machine.model||""==t.Machine.model?(alert("Please select model"),n=!1):("undefined"==typeof t.Machine.customer_name||""==t.Machine.customer_name.trim())&&(alert("Please input customer"),n=!1),0!=n&&i.getByName(t.Machine.customer_name).then(function(n){var i=!1;return angular.forEach(n.data.results,function(e){i||t.Machine.customer_name==e.name&&(t.Machine.customer_name=e.name,t.Machine.customer_id=e.id,i=!0)}),i?void a.getBySerial(t.Machine.serial).then(function(n){return 0!=n.data.results.length?void alert("The same serial number already exists"):void a.saveNew(t.Machine).then(function(n){n.data.errors.length>0?alert("There was a problem saving the machine: "+n.data.errors[0]):(t.$emit("machine_saved",n),t.image_upload&&(console.log("uploading image"),e={machine_obj:n.data.results,machine_id:n.data.results.id,file:t.image_upload,customer_id:n.data.results.customer_id,description:"",user_id:s.getUserID()},a.savePhoto(e).then(function(e){console.log("saved image"),console.dir(e)})),alert("New machine saved."),t.$emit("obj_saved","New "),r.path("/machines/list/"))})}):void alert("Customer doesn't exist")})},t.deleteMachine=function(){alert("There is no machine to delete.")}}]),Modustri.controller("MachineCtrl",["$log","$scope","$routeParams","$location","MachineServices","InsServices","CustomerServices","ScoreBoardServices","Utilities","AuthServices","UserServices","AppSettings",function(e,t,n,r,a,i,s,o,c,l,u,d){"use strict";function p(e){var t;return"undefined"!=typeof e&&null!==e&&"Hi"!==e&&"Lo"!==e&&"NA"!==e&&""!==e?parseFloat(e):void 0}function m(e){return"undefined"==typeof e||""===e||null===e?"red":e>69?"red":e>30&&70>e?"orange":31>e?"green":void 0}l.checkUserCreds(),t.UserSettings=l.getUserSettings();var h=r.url(),g=h.match(/edit/),f,v,b=l.getDealerID();t.image_upload="",t.customer_changed=!1,t.state=_.isArray(g)&&"edit"===g[0]?"edit":"view",t.AllMachineActionDates=[],t.MachineActions=[],a.get(n.machineID,!1).then(function(e){t.Machine=e.data.results,t.Machine.serial=t.Machine.serial.trim().length>0?t.Machine.serial:"N/A",t.Machine.equipment_id=t.Machine.equipment_id.trim().length>0?t.Machine.equipment_id:"N/A",t.Machine.hide_upload="edit"===t.state?!1:!0,t.Inspections=[],""!==t.Machine.main_image_id&&"false"!=t.Machine.main_image_id&&0!=t.Machine.main_image_id&&"(null)"!=t.Machine.main_image_id&&(t.Machine.img=d.BASE_URL+"imgtmb/"+t.Machine.main_image_id+"/",t.Machine.img_full=d.BASE_URL+"img/"+t.Machine.main_image_id+"/",f=setTimeout(function(){v=document.createElement("img"),v.src=t.Machine.img_full},0)),0!=e.data.results.customer_id&&s.get(e.data.results.customer_id).then(function(e){t.Customer=e.data.results,t.Machine.customer_name=e.data.results.name,t.Customer.url="#/customers/"+e.data.results.id+"/",null!==t.Customer.primary_contact_id&&0!==t.Customer.primary_contact_id?u.getContactById(t.Customer.primary_contact_id).then(function(e){t.Customer.email=e.data.results.email,console.log(e.data.results)}):t.Customer.email=""}),i.getByMachineId(t.Machine.id).then(function(e){t.Inspections=e.data.results.sort(function(e,t){return t.timestamp-e.timestamp}),_.each(t.Inspections,function(e,t,n){e.datestring=c.getDatestring(e.timestamp),e.update_datestamp=c.getDatestring(e.modified),e.inspector=e.inspection_obj.hasOwnProperty("user")&&void 0!==e.inspection_obj.user.username?e.inspection_obj.user.username:"NA",e.imagescount=0;var r=[];e.components=[],angular.forEach(e.inspection_obj.results,function(t,n){if(!("undefined"==typeof t[0]||"undefined"==typeof t[0].left&&"undefined"==typeof t[0].right||"undefined"==typeof t[0].left.percentage&&"undefined"==typeof t[0].right.percentage))for(var a=0;a<t.length;a++)r.push(p(t[a].left.percentage)),r.push(p(t[a].right.percentage)),t[a].component_type=n,t[a].left.percent=p(t[a].left.percentage),t[a].left.color=m(t[a].left.percent),t[a].right.percent=p(t[a].right.percentage),t[a].right.color=m(t[a].right.percent),e.components.push(t[a]),t[a].left.hasOwnProperty("image_timestamp")&&e.imagescount++,t[a].right.hasOwnProperty("image_timestamp")&&e.imagescount++});var a=r.sort(function(e,t){return t-e});"undefined"==typeof a[0]?(e.rating="N/A",e.color="red"):(e.rating=a[0].toString()+"%",e.color=m(a[0])),e.show_components=0})}),a.queryManufacturers().then(function(e){t.ManufacturerList=e.data.results;var n=_.where(e.data.results,{id:t.Machine.manufacturer_id}),r=n[0].company.trim();r=r.length>0?r:"N/A",t.Machine.manufacturer_name=r,a.queryModels(t.Machine.manufacturer_id).then(function(e){t.ModelList=e.data.results})}),t.updateMachineModels=function(e){a.queryModels(t.Machine.manufacturer_id).then(function(e){t.ModelList=e.data.results})},t.$watch("Machine.model_id",function(e,n){if(e!==n){var r=_.where(t.ModelList,{id:e});t.Machine.model=r[0].model}}),o.getAllScoreBoardData("actions",function(e){t.MachineActions=e.results,o.getAllScoreBoardData("machineactiondates",function(e){t.AllMachineActionDates=e.results,t.Machine.opportunity="",angular.forEach(t.AllMachineActionDates,function(e,r){e.machine_id==n.machineID&&(t.Machine.opportunity=t.Machine.opportunity+t.MachineActions[parseInt(e.action_id)-1].abr+" ")})})})}),t.$watch("image_upload",function(e,t){}),t.saveMachine=function(){var e={},n=function(){a.save(t.Machine).then(function(n){alert("Machine saved."),t.$emit("machine_saved",n),""!==t.image_upload?(console.log("uploading image"),e={machine_obj:n.data.results,machine_id:n.data.results.id,file:t.image_upload,customer_id:n.data.results.customer_id,description:"",user_id:l.getUserID()},a.savePhoto(e).then(function(e){console.log("saved image"),console.dir(e),r.path("/machines/"+t.Machine.id)})):r.path("/machines/"+t.Machine.id)})};if(delete t.Machine.archived,t.customer_changed){var s;i.getByMachineId(t.Machine.id).then(function(e){e.data.results.length>0&&angular.forEach(e.data.results,function(e){e.customer_id=t.Machine.customer_id,s=e.id,delete e.id,delete e.archived,delete e.modified,e.inspection_obj=JSON.stringify(e.inspection_obj),i.save(e,s)}),n()})}else n()},t.deleteMachine=function(){confirm("Are you sure you want to delete this machine?")&&a.del(t.Machine.id).then(function(e){r.path("/machines/list/")})},t.usv_component={track_links:{name:"Link",icon_cls:"links-btn"},bushings:{name:"Bushing",icon_cls:"bushings-btn"},track_shoes:{name:"Shoe",icon_cls:"shoes-btn"},idlers_front:{name:"Front Idler",icon_cls:"idlers-btn"},idlers_rear:{name:"Rear Idler",icon_cls:"idlers-btn"},carrier_rollers:{name:"Carrier Roller",icon_cls:"carrier-rollers-btn"},track_rollers:{name:"Track Roller",icon_cls:"track-rollers-btn"},sprockets:{name:"Sprocket",icon_cls:"sprockets-btn"}}}]),Modustri.controller("UserCtrl",["$scope","UserServices","AuthServices","$filter","DealerServices","CustomerServices","Utilities",function(e,t,n,r,a,i,s){"use strict";function o(){t.getUserList().then(function(t){e.users=t.data.results})}var c="uiusers";e.users={},e.ids={},e.dealers={},n.checkUserCreds(),e.UserSettings=n.getUserSettings(),a.getDealerList(function(t){e.dealers=t.results,e.userlevels=[{value:0,text:"Modustri Administrator"},{value:1,text:"Modustri Manager"},{value:2,text:"Dealer Administrator"},{value:3,text:"Dealer Manager"},{value:4,text:"Dealer User"},{value:5,text:"Customer Manager"}],0===n.getUserLevel()&&(e.isAdmin=1),e.uiShow=function(e){return n.uiToggle(n.getUserLevel(),c,e)},e.showUserLevel=function(t){var n=[];return null!==t&&(n=r("filter")(e.userlevels,{value:t})),n.length?n[0].text:"Not set"},e.showDealer=function(t){console.log(t);var n=[];if(null!==t)for(var r in e.dealers)e.dealers[r].id===t&&n.push(e.dealers[r]);return n.length?n[0].name:"Not set"},e.editableName=function(e,t){(void 0===t||null===t)&&$("#username").prop("readonly","")},o(),e.getCustomers=function(e){var t=[];return e.length>=3?i.getByName(e).then(function(e){return angular.forEach(e.data.results,function(e){t.push(e.name)}),t}):void 0}}),e.addUser=function(){e.inserted={username:"",id:null,email:null,dealer_id:n.getDealerID(),customer_id:null,userlevel:null},e.users.unshift(e.inserted)},e.userEditableValidation=function(e,t){switch(e){case"email":var n=/^[A-Za-z0-9_.-]{2}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-].{1}[A-Za-z0-9_.-]+$/;if(void 0==t||""==t)return"Email is required.";if(!n.test(t))return"Email is invalid.";if(t.length>200)return"Email cannot be longer than 200 characters.";break;case"username":var n=/^[A-Za-z0-9_]+[a-zA-Z0-9\s_.\-]*[A-Za-z0-9_]+$/;if(void 0==t||""==t)return"Name is required.";if(t.length<3)return"Name is required to be at least 3 characters.";if(!n.test(t))return"Name is invalid.";if(t.length>200)return"Name cannot be longer than 200 characters."}},e.saveUser=function(e,n,r){null!==n?t.updateUser(n,e.username,e.email,e.userlevel,e.dealer_id,e.customer_id,function(e){void 0!==e&&o()}):t.addUser(e.username,e.email,e.userlevel,e.dealer_id,e.customer_id,function(e){void 0!==e&&o()})},e.removeUser=function(e){e&&t.removeUser(e,function(){o()})},e.cancelUser=function(t,n){null==e.users[t].id?e.users.splice(t,1):n.$cancel()},e.removeChecked=function(){angular.forEach(e.ids,function(n,r){n&&t.removeUser(r,function(){angular.forEach(e.users,function(t,n){t.id==r&&(e.users.splice(n,1),delete e.ids[r])})})})},e.toggleCheckUser=function(t){-1===e.selectedUsers.indexOf(t)?e.selectedUsers.push(t):e.selectedUsers.splice(e.selectedUsers.indexOf(t),1)}}]),Modustri.controller("SettingsCtrl",["$log","$scope","$routeParams","$location","AuthServices","DealerServices","AppSettings",function(e,t,n,r,a,i,s){"use strict";a.checkUserCreds(),t.image_upload="",i.getDealerImg(a.getDealerID()).then(function(e){t.Dealer=e.data.results,"image_id"in t.Dealer&&null!==t.Dealer.obj&&null!==t.Dealer.image_id&&(t.Dealer.img=s.BASE_URL+"imgtmb/"+t.Dealer.image_id+"/",t.Dealer.img_full=s.BASE_URL+"img/"+t.Dealer.image_id+"/")}),t.saveSettings=function(){if(""!=t.image_upload){var e={};e={dealer_obj:t.Dealer,file:t.image_upload,user_id:a.getUserID()},i.saveDealerImg(e).then(function(e){t.$emit("settings_saved"),alert("Settings saved.")})}}}]),Modustri.controller("LoginCtrl",["$log","$scope","$location","AuthServices",function(e,t,n,r){"use strict";localStorage.getItem("username")&&localStorage.getItem("pass")&&r.validate(localStorage.getItem("username"),localStorage.getItem("pass")).then(function(){n.path("/dashboard")},function(){}),t.login=function(){r.validate(t.user,t.pass).then(function(e){t.$emit("user_logged_in",e),localStorage.setItem("username",t.user),n.path("/dashboard")},function(){alert("Incorrect username or password.")})}}]),Modustri.controller("PasswordCtrl",["$log","$scope","$location","PasswordServices",function(e,t,n,r){"use strict";console.log("password::PasswordCtrl");var a=!1,i=n.search().userid,s=n.search().e;(null===i||void 0===i)&&(a=!0),(null===s||void 0===s)&&(a=!0),t.checkUrlParams=function(){return a},t.changePassword=function(){a||r.changePassword(i,s,function(e){})}}]),Modustri.controller("ReportCtrl",["$log","$scope","$routeParams","$location","$http","CustomerServices","MachineServices","InsServices","UserServices","AuthServices","Utilities","AppSettings","$filter",function(e,t,n,r,a,i,s,o,c,l,u,d,p){"use strict";function m(e){e=new Date(e);var t=e.getDay(),n=e.getDate()-t+(0==t?-6:1);return new Date(e.setDate(n))}function h(e){return e=new Date(e),new Date(e.getFullYear(),e.getMonth(),1)}function g(e){return e=new Date(e),new Date(e.getFullYear(),e.getMonth()+1,1)}function f(e){return e=new Date(e),new Date(e.getFullYear(),0,1)}function v(){for(var e=[],n=0;n<=y();n++){var r=moment(t.fromChartDate).add("days",n).format("MM/DD/YYYY hh:mm a");e.push(r)}return e}function b(){for(var e=[],t=0;t<=y();t++)e.push(0);return e}function y(){var e=864e5,n=(new Date(t.toChartDate)-new Date(t.fromChartDate))/e;return n+1}function w(){var e=moment(t.fromChartDate).unix(),n=moment(t.toChartDate).unix();return e>n?(alert("From date cannot be later than To date"),!1):!0}function I(){var e=[];return angular.forEach(t.Chart.inspectors_list,function(t){e.push({name:t.name,y:0})}),e}function D(){var e=[];return angular.forEach(t.chartCustomers,function(t){e.push({name:t,y:0})}),e}function U(){var e=[];return angular.forEach(t.chartMachineTypes,function(t){""!=t&&e.push({name:t,y:0,cnt:0,rating:0})}),e}function C(){var e=[];return angular.forEach(t.chartMachines,function(t){e.push({name:t,type:"",y:0,cnt:0,rating:0,n:[],inspections:[],regInspections:[]})}),e}function M(){var e=[];return angular.forEach(t.chartDealers,function(n){var r=[];angular.forEach(t.chartWeekly,function(e){r.push({start:e.start,end:e.end,name:e.name,y:0})}),e.push({name:n,weeks:r,unix:[],y:0})}),e}function S(){var e=[];return angular.forEach(t.chartManufacturers,function(t){e.push({name:t,machines:[],y:0})}),e}function x(e,n){for(var r=0;r<t.machines.length;r++){var a=t.machines[r];if(a.manufacturer_id==e&&a.model==n){var i=a.type;return i}}}function j(e,t,n,r){var a="",i="";a=n>70?"_red":n>30?"_yellow":"_green";var s=x(e,t);return i="Excavator"==s?"Excavator"+a:"Bulldozer"+a,i+="_"+r,"url(images/icons/machines/"+i+".png)"}function A(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.type&&void 0!==e.type&&-1==t.indexOf(e.type)&&t.push(e.type)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function k(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.customer&&void 0!==e.inspection_obj.customer&&-1==t.indexOf(e.inspection_obj.customer.name)&&t.push(e.inspection_obj.customer.name)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function E(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.machine&&void 0!==e.inspection_obj.machine&&-1==t.indexOf(e.inspection_obj.machine.model)&&t.push(e.inspection_obj.machine.model)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function L(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.dealer&&e.completed&&void 0!==e.inspection_obj.dealer&&-1==t.indexOf(e.inspection_obj.dealer.name)&&""!=e.inspection_obj.dealer.name&&t.push(e.inspection_obj.dealer.name)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function P(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.user&&void 0!==e.inspection_obj.user&&-1==t.indexOf(e.inspection_obj.user.username)&&""!=e.inspection_obj.user.username&&t.push(e.inspection_obj.user.username)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function B(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.manufacturer&&void 0!==e.inspection_obj.manufacturer&&-1==t.indexOf(e.inspection_obj.manufacturer.company)&&t.push(e.inspection_obj.manufacturer.company)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function R(e){var t;return"undefined"!=typeof e&&null!==e&&"Hi"!==e&&"Lo"!==e&&"NA"!==e?parseFloat(e):void 0}l.checkUserCreds(),t.UserSettings=l.getUserSettings(),t.InspectionCache=!1,t.ulevel=l.getUserLevel(),t.Chart={date:"",timestamp:"",filter:"",from:0,to:99999999999,customer_name:"",customer_id:"",inspectors_list:[],inspections:{}},$("#spinner").show(),c.getUsersByDealer(function(e){angular.forEach(e.results,function(e,n){t.Chart.inspectors_list.push({name:e.username,id:e.id})})}),t.Chart.inspections={},t.dashboardCustomers=[],t.chartType="column",t.fromChartDate=moment().subtract("months",6).format("MM/DD/YYYY hh:mm a"),t.toChartDate=moment().format("MM/DD/YYYY hh:mm a"),t.UpdateDateRangeData=function(){w()&&($("#spinner").show(),t.showSpinner=!0,t.InspectionCache=!1,t.GetInspectionData())},t.UpdateDispatch=function(e){var n=e.data.results;_.each(e.data.results,function(e,t,r){n[t].datestring=moment.unix(e.timestamp).format("MM/DD/YYYY hh:mm a")}),t.Chart.inspections=n};var T=$("#total-inspections-chart"),Y=$("#total-customers-chart"),F=$("#total-machines-chart"),O=$("#machine-population-wear-chart"),H=$("#realtime-inspection-chart"),N=$("#wear-analysis-chart"),V=$("#inspection-gauge-monthly-chart"),q=$("#inspection-gauge-annual-chart"),W=$("#machine-population-chart"),G=$("#opportunities-converstions-chart"),z=$("#machine-cph-chart"),J=$("#dealer-total-chart"),K=$("#dealer-performance-chart"),X=$("#average-wear-chart"),Z=$("#undercarriage-brands-chart"),Q=$("#machines-percentage-chart");t.chartDealers=[],t.chartCustomers=[],t.chartInspectors=[],t.chartMachines=[],t.chartMachineTypes=[],t.chartManufacturers=[],t.chartWeekly=[],t.chartMonthly=[],t.chartAnnual=[],t.machines=[],s.queryModels().then(function(e){t.machines=e.data.results,t.chartMachineTypes=A(e.data.results)}),t.GetInspectionData=function(){if($("#spinner").show(),t.fromUnix=moment(t.fromChartDate).unix(),t.toUnix=moment(t.toChartDate).unix(),t.fromUnix=t.fromUnix-21600,t.toUnix=t.toUnix+64800,t.InspectionCache){var e=t.InspectionCache;t.initializeChart(e),t.UpdateDispatch(e),t.UpdateInspectorChart(e),t.UpdateCustomerChart(e),t.UpdateMachineChart(e),t.UpdateMachinePopulationWearChart(e),t.UpdateRealtimeInspectionChart(e),t.UpdateWearAnalysisChart(e),t.UpdateInspectionGaugeChart(e),t.UpdateMachinePopulationChart(e),t.UpdateOpportunitiesConverstionsChart(e),t.UpdateMachineCphChart(e),t.UpdateDealerTotalChart(e),t.UpdateDealerPerformanceChart(e),t.UpdateAverageWearChart(e),t.UndercarriageBrandsChart(e),t.MachinesPercentageChart(e)}else o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(e){t.InspectionCache=e,t.initializeChart(e),t.UpdateDispatch(e),t.UpdateInspectorChart(e),t.UpdateCustomerChart(e),t.UpdateMachineChart(e),t.UpdateMachinePopulationWearChart(e),t.UpdateRealtimeInspectionChart(e),t.UpdateWearAnalysisChart(e),t.UpdateInspectionGaugeChart(e),t.UpdateMachinePopulationChart(e),t.UpdateOpportunitiesConverstionsChart(e),t.UpdateMachineCphChart(e),t.UpdateDealerTotalChart(e),t.UpdateDealerPerformanceChart(e),t.UpdateAverageWearChart(e),t.UndercarriageBrandsChart(e),t.MachinesPercentageChart(e)})},t.initializeChart=function(e){t.chartCustomers=k(e.data.results),t.chartMachines=E(e.data.results),t.chartDealers=L(e.data.results),t.chartInspectors=P(e.data.results),t.chartManufacturers=B(e.data.results);for(var n=moment(t.fromUnix,"X").format("YYYY-MM-DD"),r=moment(t.toUnix,"X").format("YYYY-MM-DD"),a=moment.twix(m(new Date(n)),new Date(r)).iterate("weeks"),i=null,s=null;a.hasNext();)s=a.next(),null!=i&&t.chartWeekly.push({start:i.unix(),end:s.unix()-1,name:i.format("Wo YYYY")}),i=s;t.chartWeekly.push({start:i,end:t.toUnix,name:i.format("Wo YYYY")});for(var a=moment.twix(h(new Date(n)),g(new Date(r))).iterate("months"),i=null,s=null;a.hasNext();)s=a.next(),null!=i&&t.chartMonthly.push({start:i.unix(),end:s.unix()-1,name:i.format("YYYY-M"),value:0,total:0}),i=s;for(var o=new Date(n),c=new Date(r),l=o.getFullYear();l<=c.getFullYear();l++)t.chartAnnual.push({name:l,value:0,total:0})},t.UpdateInspectorChart=function(e){var n=v(),r=I(),a=e.data.results;a=void 0===t.inspectorChartSearchFilter||null===t.inspectorChartSearchFilter?p("filter")(e.data.results,{}):p("filter")(e.data.results,{inspection_obj:{user:{username:t.inspectorChartSearchFilter}}}),angular.forEach(a,function(e){if(void 0!==e.inspection_obj.user){var t=e.inspection_obj.user.username;angular.forEach(r,function(e){e.name===t&&e.y++})}});var i=[],s=[];angular.forEach(r,function(e){e.y>0&&(i.push(e.name),s.push(e.y))});var o=1,c=25;s.length>c&&(o=Math.round(s.length/c)),T.highcharts({chart:{type:t.chartType},title:{text:"Inspections by PSSR"},xAxis:{categories:i,labels:{rotation:90,step:o,align:"left"}},yAxis:{min:0,title:{text:"Number of Inspections"}},tooltip:{headerFormat:"<table>",pointFormat:'<tr><td style="color:{point.color};padding:0">{point.category}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Inspectors",data:s}]})},t.UpdateCustomerChart=function(e){var n=v(),r=D(),a=e.data.results;a=void 0===t.customerChartSearchFilter||null===t.customerChartSearchFilter?p("filter")(a,{}):p("filter")(a,{inspection_obj:{customer:{name:t.customerChartSearchFilter}}}),angular.forEach(a,function(e){if(void 0!==e.inspection_obj.customer&&e.completed){var t=e.inspection_obj.customer.name,n=e.inspection_obj.customer.id,a=n;angular.forEach(r,function(e){e.url=void 0!==n&&null!==n?a:"WTF",e.name===t&&e.y++})}});var i=[],s=[];angular.forEach(r,function(e){e.y>=1&&(i.push(e.name),s.push(e.y))});var o=1,c=25;s.length>c&&(o=Math.round(s.length/c)),Y.highcharts({chart:{type:t.chartType},title:{text:"Inspections by Customer"},xAxis:{categories:i,labels:{rotation:90,step:o,align:"left"}},yAxis:{min:0,title:{text:"Number of Inspections"}},tooltip:{headerFormat:"<table>",pointFormat:'<tr><td style="color:{point.color};padding:0">{point.category}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})
},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Customers",data:s}]})},t.UpdateMachineChart=function(e){var n=v(),r=C(),a=e.data.results;a=void 0===t.machineChartSearchFilter||null===t.machineChartSearchFilter?p("filter")(a,{}):p("filter")(a,{inspection_obj:{machine:{model:t.machineChartSearchFilter}}}),angular.forEach(a,function(e){if(void 0!==e.inspection_obj.machine){var t=[];angular.forEach(e.inspection_obj.results,function(e){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var n=0;n<e.length;n++)t.push(R(e[n].left.percentage)),t.push(R(e[n].right.percentage))});var n=t.sort(function(e,t){return t-e});if("undefined"!=typeof n[0]&&n[0]>69){var a=e.inspection_obj.machine.model;angular.forEach(r,function(e){e.name===a&&e.y++})}}});var i=[],s=[];angular.forEach(r,function(e){e.y>=1&&(i.push(e.name),s.push(e.y))});var o=1,c=25;s.length>c&&(o=Math.round(s.length/c)),F.highcharts({chart:{type:t.chartType},title:{text:"Machines above 70% By Model"},xAxis:{categories:i,labels:{rotation:90,step:o,align:"left"}},yAxis:{min:0,title:{text:"Number of Inspections"}},tooltip:{headerFormat:"<table>",pointFormat:'<tr><td style="color:{series.color};padding:0">{point.category}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Machines",data:s}]}),$("#spinner").hide()},t.UpdateDealerTotalChart=function(e){var n=v(),r=M(),a=e.data.results;angular.forEach(a,function(e){if(void 0!==e.inspection_obj.dealer){var t=e.inspection_obj.dealer.name,n=e.inspection_obj.dealer.id,a=e.modified;angular.forEach(r,function(e){e.name===t&&e.y++})}});var i=[],s=[];angular.forEach(r,function(e){if(e.y>0){switch(e.name){case"AgentX":e.name="NDUSTRIALIZADORA DANAMEX S.A";break;case"Altorfer":e.name="KOKUKA SHOKAI CO.,LTD";break;case"MacAllister":e.name="VOIGT WERKZEUGMASCHINEN";break;case"Ziegler":e.name="PERFECBORE LTD.";break;case"H.O.Penn":e.name="MENDHAM MACHINERY PTY. LTD.";break;case"Patten Cat":e.name="SUBRA DO BRASIL";break;case"Warren Cat":e.name="A.R.A. SRL";break;case"Empire Cat":e.name="";break;case"Thompson Machinery Cat":e.name=""}""!==e.name&&(i.push(e.name),s.push(e.y))}});var o=1,c=25;s.length>c&&(o=Math.round(s.length/c)),J.highcharts({chart:{type:t.chartType},title:{text:"Total Inspections per Dealer"},xAxis:{categories:i,labels:{rotation:90,step:o,align:"left"}},yAxis:{min:0,title:{text:"Number of Inspections"}},tooltip:{headerFormat:"<table>",pointFormat:'<tr><td style="color:{point.color};padding:0">{point.category}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Dealers",data:s}]})},t.UpdateMachinePopulationWearChart=function(e){var n=v(),r=C(),a=e.data.results;angular.forEach(a,function(e){if(void 0!==e.inspection_obj.machine){var t=[];angular.forEach(e.inspection_obj.results,function(e){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var n=0;n<e.length;n++)t.push(R(e[n].left.percentage)),t.push(R(e[n].right.percentage))});var n=t.sort(function(e,t){return t-e});if("undefined"!=typeof n[0]&&!isNaN(n[0])){var a=e.inspection_obj.machine.model;angular.forEach(r,function(t){t.name===a&&(t.y++,t.rating+=n[0],t.cnt++,t.type=x(e.inspection_obj.machine.manufacturer_id,e.inspection_obj.machine.model))})}}});var i=[],s=[],o=[],c=[];angular.forEach(r,function(e){var n=0;e.cnt>2&&(n=parseFloat((e.rating/e.cnt).toFixed(2))),e.rating=n,e.y>0&&n>0&&(e.index=t.chartMachineTypes.indexOf(e.type),c.push(e))}),c.sort(function(e,t){return e.index-t.index||e.y-t.y}),angular.forEach(c,function(e){i.push(e.name),s.push(e.y),o.push(e.rating)});var l=1,u=25;s.length>u&&(l=Math.round(s.length/u)),O.highcharts({title:{text:"Machine population vs Wear"},xAxis:{categories:i,labels:{rotation:90,align:"left"}},yAxis:[{labels:{style:{color:"black"}},title:{text:"Average % wear",style:{color:"black"}}},{title:{text:"Machine size",style:{color:"black"}},labels:{style:{color:"black"}},opposite:!0}],tooltip:{shared:!0},legend:{enabled:!0},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"% Wear",type:"column",yAxis:1,data:o},{name:"# Machines",type:"spline",data:s}]})},t.UpdateRealtimeInspectionChart=function(e){var t=0,n=[],r=moment().add("months",-1).unix(),a=moment().unix(),i=3600;r-=r%i,a-=a%i;var s=[];o.getByDealerIdStartEnd(l.getDealerID(),r,a).then(function(e){var i=e.data.results,c=10;for(i.length<10&&(c=i.length),t=0;c>t;t++){var u=i[t],d=[];angular.forEach(u.inspection_obj.results,function(e){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var t=0;t<e.length;t++)d.push(R(e[t].left.percentage)),d.push(R(e[t].right.percentage))});var p=d.sort(function(e,t){return t-e}),m="",h="",g=0;void 0!==u.inspection_obj.machine&&(m=u.inspection_obj.machine.model),void 0!==u.inspection_obj.dealer&&(h=u.inspection_obj.dealer.name),"undefined"==typeof p[0]||isNaN(p[0])||(g=p[0]),n.push({y:g,machine:m,dealer:h,marker:{symbol:j(u.inspection_obj.machine.manufacturer_id,u.inspection_obj.machine.model,g,"n")}}),s.push(Highcharts.dateFormat("%Y-%m-%d %H:%M %p",1e3*u.timestamp))}n.reverse(),s.reverse(),Highcharts.setOptions({global:{useUTC:!1}}),H.highcharts({chart:{type:"spline",events:{load:function(){var e=this.series[0],n=this.axes[0];setInterval(function(){r=a+60,a=r+60;var i=0;o.getByDealerIdStartEnd(l.getDealerID(),r,a).then(function(r){var a=r.data.results;for(a.reverse(),t=0;t<a.length;t++){var i=a[t],o=[];angular.forEach(i.inspection_obj.results,function(e){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var t=0;t<e.length;t++)o.push(R(e[t].left.percentage)),o.push(R(e[t].right.percentage))});var c=o.sort(function(e,t){return t-e}),l="",u="",d=0;void 0!==i.inspection_obj.machine&&(l=i.inspection_obj.machine.model),void 0!==i.inspection_obj.dealer&&(u=i.inspection_obj.dealer.name),"undefined"==typeof c[0]||isNaN(c[0])||(d=c[0]),s.push(Highcharts.dateFormat("%Y-%m-%d %H:%M %p",1e3*i.timestamp)),n.setCategories(s,!1);var p={y:d,machine:l,dealer:u,marker:{symbol:j(i.inspection_obj.machine.manufacturer_id,i.inspection_obj.machine.model,d,"n")}};e.addPoint(p,!0,!0)}})},6e4)}}},title:{text:"Real Time Inspection Tracker"},xAxis:{categories:s},yAxis:{title:{text:"% worn"},min:0,max:120,plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{formatter:function(){return""!=this.point.options.dealer?this.point.options.dealer+"<br/>"+this.point.options.machine+"<br/>"+this.y+"% worn<br/>"+this.x:this.point.options.machine+"<br/>"+this.y+"% worn<br/>"+this.x}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Inspection",data:n}]})})},t.UpdateWearAnalysisChart=function(e){var t=v(),n=C(),r=[],a=e.data.results;angular.forEach(a,function(e){if(void 0!==e.inspection_obj.machine){var t=[];angular.forEach(e.inspection_obj.results,function(e){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var n=0;n<e.length;n++)t.push(R(e[n].left.percentage)),t.push(R(e[n].right.percentage))});var r=t.sort(function(e,t){return t-e});if("undefined"!=typeof r[0]&&!isNaN(r[0])){var a=e.inspection_obj.machine.model;angular.forEach(n,function(t){if(t.name===a){var n=e.inspection_obj.hour_meter_reading;n>0&&r[0]>0&&15e3>n&&(500>n&&r[0]<30||n>500&&1e3>n&&r[0]<50||n>1e3&&2e3>n&&r[0]<80||n>2e3&&3e3>n||n>3e3&&7e3>n&&r[0]<=80||n>7e3&&8e3>n&&r[0]<=120)&&t.regInspections.push({x:n,y:r[0],marker:{symbol:j(e.inspection_obj.machine.manufacturer_id,e.inspection_obj.machine.model,r[0],"s")}})}})}}});var i=[];angular.forEach(n,function(e){e.regInspections.length>0&&(i=i.concat(e.regInspections))}),N.highcharts({chart:{type:"scatter"},title:{text:"Life-cycle wear analysis"},xAxis:{title:{enabled:!0,text:"Hours on machine"},startOnTick:!0,endOnTick:!0,showLastLabel:!0,min:0},yAxis:{min:0,max:120,title:{text:"% worn"}},legend:{enabled:!1},plotOptions:{scatter:{marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}},tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"hours: {point.x}, % worn: {point.y}"}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{regression:!0,regressionSettings:{type:"linear"},name:"Inspection",data:i}]})},t.UpdateInspectionGaugeChart=function(e){angular.forEach(t.chartMonthly,function(e){e.value=0,e.total=0}),angular.forEach(t.chartAnnual,function(e){e.value=0,e.total=0});var n=e.data.results;angular.forEach(n,function(e){var n=e.modified;angular.forEach(t.chartMonthly,function(t){t.start<=n&&n<=t.end&&(t.total++,e.completed&&t.value++)}),angular.forEach(t.chartAnnual,function(t){var r=new Date(1e3*n);r.getFullYear()==t.name&&(t.total++,e.completed&&t.value++)})});var r=0,a=0,i=0,s=0;angular.forEach(t.chartMonthly,function(e){r+=e.value,a+=e.total}),r=parseInt(r/t.chartMonthly.length),a=parseInt(a/t.chartMonthly.length),angular.forEach(t.chartAnnual,function(e){i+=e.value,s+=e.total}),i=parseInt(i/t.chartAnnual.length),s=parseInt(s/t.chartAnnual.length);var o={chart:{type:"solidgauge"},title:null,pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:!1},yAxis:{stops:[[.1,"#55BF3B"],[.5,"#DDDF0D"],[.9,"#DF5353"]],lineWidth:0,minorTickInterval:"auto",tickPixelInterval:400,tickWidth:0,title:{y:-70},labels:{y:16,style:{fontSize:"18px"}}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}}};V.highcharts(Highcharts.merge(o,{yAxis:{min:0,max:a,tickInterval:a/2,title:{text:""}},credits:{enabled:!1},series:[{name:"Monthly Inspection",data:[r],dataLabels:{format:'<div style="text-align:center;margin-top:20px;"><span style="font-size:24px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y}</span><br/><span style="font-size:12px;color:silver">MTD Inspections</span></div>'},tooltip:{valueSuffix:" Monthly"}}]})),q.highcharts(Highcharts.merge(o,{yAxis:{min:0,max:s,tickInterval:s/2,title:{text:""}},series:[{name:"Annual Inspection",data:[i],dataLabels:{format:'<div style="text-align:center;margin-top:20px;"><span style="font-size:24px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y}</span><br/><span style="font-size:12px;color:silver">YTD Inspections</span></div>'},tooltip:{valueSuffix:" Annual"}}]}))},t.UpdateMachinePopulationChart=function(e){console.log("called update machine population chart"),console.dir(e);var n=Highcharts.getOptions().colors,r=[];console.dir(t.chartManufacturers),angular.forEach(t.chartManufacturers,function(e,a){r.push({name:e,y:0,color:n[a],drilldown:{name:e,machineTypes:[],data:[]}}),angular.forEach(t.chartMachineTypes,function(e){""!==e&&(r[a].drilldown.machineTypes.push(e),r[a].drilldown.data.push(0))})});var a=e.data.results,i=0;angular.forEach(a,function(e){if(console.dir(e),void 0!==e.inspection_obj.manufacturer&&void 0!==e.inspection_obj.machine){var t=e.inspection_obj.manufacturer,n=e.inspection_obj.machine;angular.forEach(r,function(e){e.name===t.company&&angular.forEach(e.drilldown.machineTypes,function(r,a){x(t.id,n.model)==r&&(i++,e.y++,e.drilldown.data[a]++,0||(i+=30,e.y=e.y+30,e.drilldown.data[a]=e.drilldown.data[a]+30))})})}});var s,o,c=[],l=[],u,d;o=r.length;for(var p=0;o>p;p+=1)if(r[p].y>0){c.push({name:r[p].name,y:r[p].y,percent:0,color:r[p].color}),c[c.length-1].percent=Math.round(r[p].y/i*100*100)/100,u=r[p].drilldown.data.length;for(var m=0;u>m;m+=1)d=.2-m/u/5,r[p].drilldown.data[m]>0&&(l.push({name:r[p].drilldown.machineTypes[m],y:r[p].drilldown.data[m],percent:0,color:Highcharts.Color(r[p].color).brighten(d).get()}),l[l.length-1].percent=Math.round(r[p].drilldown.data[m]/r[p].y*100*100)/100)}W.highcharts({chart:{type:"pie"},title:{text:"Machine Population"},yAxis:{title:{text:"Total percent machine population"}},plotOptions:{pie:{shadow:!1,center:["50%","50%"]}},tooltip:{formatter:function(){var e=this.point.percent;return"<b>"+this.point.name+"</b>: "+e+"%"}},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Manufacturers",data:c,size:"80%",dataLabels:{formatter:function(){var e=this.point.percent;return e>5?"<b>"+this.point.name+"</b><br/>("+e+"%)":null},color:"white",align:"center",distance:-50}},{name:"MachineTypes",data:l,size:"100%",innerSize:"80%",dataLabels:{formatter:function(){var e=this.point.percent;return e>1?"<b>"+this.point.name+":</b> "+e+"%":null}}}]})},t.UpdateOpportunitiesConverstionsChart=function(e){var n=[];angular.forEach(t.chartInspectors,function(e,t){n.push({name:e,total:0,opportunities:0,quotes:0,parts:0,services:0})});var r=e.data.results,a=0;angular.forEach(r,function(e){if(void 0!==e.inspection_obj.user&&null!=e.inspection_obj.user){var t=e.inspection_obj.user;angular.forEach(n,function(e){if(e.name===t.username){var n=0,r=0,a=0,i=0;n=Math.round(Math.random()),1==n&&(r=Math.round(Math.random()),1==r&&(a=Math.round(Math.random()),i=Math.round(Math.random()))),e.total++,e.opportunities=e.opportunities+n,e.quotes=e.quotes+r,e.parts=e.parts+a,e.services=e.services+i}})}}),n.sort(function(e,t){return t.total-e.total});var i=[],s=[];s.push({name:"Opportunities",data:[],color:"#178BA2",stack:"bar1"}),s.push({name:"Quotes",data:[],color:"#F38435",stack:"bar1"}),s.push({name:"Parts Tickets",data:[],color:"#7DC44E",stack:"bar2"}),s.push({name:"Service Tickets",data:[],color:"#6059A5",stack:"bar3"}),angular.forEach(n,function(e){if(e.opportunities>0&&e.total>5){if(e.name.indexOf("@")>0&&(e.name=e.name.substring(0,e.name.indexOf("@"))),e.name.indexOf(" ")>0){var t=e.name.match(/\b(\w)/g),n=t.join("").toUpperCase();i.push(n)}else i.push(e.name);var r=0,a=0,o=0,c=0;r=Math.round(e.opportunities/e.total*100*100)/100,a=Math.round(e.quotes/e.total*100*100)/100,o=Math.round(e.parts/e.total*100*100)/100,c=Math.round(e.services/e.total*100*100)/100,s[0].data.push({y:r-a,insp_total:e.total}),s[1].data.push({y:a,insp_total:e.total}),s[2].data.push({y:o,insp_total:e.total}),s[3].data.push({y:c,insp_total:e.total})}});var o=1,c=25;i.length>c&&(o=Math.round(i.length/c)),G.highcharts({chart:{type:"column"},title:{text:"OPPORTUNITIES & CONVERSTIONS"},xAxis:{categories:i,labels:{rotation:90,step:o,align:"left"}},yAxis:{allowDecimals:!1,min:0,max:100,title:{text:"% of Inspections"},labels:{format:"{value}%"}},tooltip:{formatter:function(){return"Opportunities"==this.series.name?"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.point.stackTotal+"%<br/>Total Inspections: "+this.point.insp_total:"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"%<br/>Total Inspections: "+this.point.insp_total}},plotOptions:{column:{stacking:"normal"}},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:s})},t.UpdateMachineCphChart=function(e){var n=[];angular.forEach(t.chartMachines,function(e){"(null)"!=e&&n.push({name:e,m_cph:0,c_cph:0,total:0})});var r=e.data.results;angular.forEach(r,function(e){if(void 0!==e.inspection_obj.machine){var t=e.inspection_obj.machine.model;angular.forEach(n,function(e){e.name===t&&e.total++})}}),angular.forEach(n,function(e){e.m_cph=parseFloat((10*Math.random()).toFixed(2)),e.c_cph=parseFloat((10*Math.random()).toFixed(2))});var a=[],i=[{name:"Regional Machine CPH",color:"#56C6D2",data:[]},{name:"Customer XYZ Machine CPH",color:"#2E3192",data:[]}];angular.forEach(n,function(e){if(e.total>1&&e.m_cph>1&&e.c_cph>1&&e.m_cph<5&&e.c_cph<5){a.push(e.name);var t=0,n=0,r=Math.round(100*Math.random());if(t=parseInt(e.total*r/100),0==t&&(t=1),n=e.total-t,n>t){var s=t;t=n,n=s}1==t&&(t=parseInt(t*Math.random()*20)),i[0].data.push({y:-1*e.m_cph,insp_total:t}),i[1].data.push({y:e.c_cph,insp_total:n})}});var s=1,o=20;a.length>o&&(s=Math.round(a.length/o)),z.highcharts({chart:{type:"bar"},title:{text:"AVERAGE CPH PER MACHINE VS CUSTOMER XYZ CPH"},xAxis:[{categories:a,reversed:!1,labels:{step:s}},{opposite:!0,reversed:!1,categories:a,linkedTo:0,labels:{step:s}}],yAxis:{title:{text:null},labels:{formatter:function(){return"$"+Math.abs(this.value)}},min:-5,max:5},plotOptions:{series:{stacking:"normal",dataLabels:{enabled:!0,inside:!1,formatter:function(){return this.point.insp_total}}}},tooltip:{formatter:function(){return"<b>"+this.key+"</b>: $"+Highcharts.numberFormat(Math.abs(this.point.y),2)}},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:i})},t.UpdateDealerPerformanceChart=function(e){var n=v(),r=M(),a=e.data.results;angular.forEach(a,function(e){if(void 0!==e.inspection_obj.dealer&&e.completed){var t=e.inspection_obj.dealer.name,n=e.inspection_obj.dealer.id,a=e.modified;angular.forEach(r,function(e){e.name===t&&angular.forEach(e.weeks,function(e){e.start<=a&&a<=e.end&&e.y++})})}});var i=[];angular.forEach(t.chartWeekly,function(e){i.push(e.name)});var s=[];angular.forEach(r,function(e){switch(e.name){case"AgentX":e.name="NDUSTRIALIZADORA DANAMEX S.A";break;case"Altorfer":e.name="KOKUKA SHOKAI CO.,LTD";break;case"MacAllister":e.name="VOIGT WERKZEUGMASCHINEN";break;case"Ziegler":e.name="PERFECBORE LTD.";break;case"H.O.Penn":e.name="MENDHAM MACHINERY PTY. LTD.";break;case"Patten Cat":e.name="SUBRA DO BRASIL";break;case"Warren Cat":e.name="A.R.A. SRL";break;case"Empire Cat":e.name="";break;case"Thompson Machinery Cat":e.name=""}if(""!==e.name){var t={name:e.name,data:[]};angular.forEach(e.weeks,function(e){t.data.push(e.y)}),s.push(t)}});var o=1,c=25;s.length>c&&(o=Math.round(s.length/c)),K.highcharts({chart:{type:"spline"},title:{text:"Dealer Performance"},xAxis:{categories:i,labels:{rotation:90,step:o,align:"left"}},yAxis:{min:0,title:{text:"Number of Inspections"}},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:s})},t.UpdateAverageWearChart=function(e){var t=v(),n=C(),r=e.data.results;r=p("orderBy")(r,"-timestamp"),angular.forEach(r,function(e){if(void 0!==e.inspection_obj.machine&&e.completed){var t=[];angular.forEach(e.inspection_obj.results,function(e){if(!("undefined"==typeof e[0]||"undefined"==typeof e[0].left&&"undefined"==typeof e[0].right||"undefined"==typeof e[0].left.percentage&&"undefined"==typeof e[0].right.percentage))for(var n=0;n<e.length;n++)t.push(R(e[n].left.percentage)),t.push(R(e[n].right.percentage))});var r=t.sort(function(e,t){return t-e});if("undefined"!=typeof r[0]&&!isNaN(r[0])){var a=e.inspection_obj.machine.model;angular.forEach(n,function(t){t.name===a&&t.inspections.length<2&&t.inspections.push({hour_meter_reading:e.inspection_obj.hour_meter_reading,rating:r[0]})})}}});var a=[],i=[];angular.forEach(n,function(e){if(2==e.inspections.length){a.push(e.name);var t=parseFloat(((e.inspections[0].hour_meter_reading-e.inspections[1].hour_meter_reading)*((e.inspections[0].rating-e.inspections[1].rating)/100)).toFixed(2));t>4e3&&(e.y=t,i.push(e.y))}});var s=1,o=25;i.length>o&&(s=Math.round(i.length/o)),X.highcharts({chart:{type:"column"},title:{text:"Average Hours of Machine Undercarriage"},xAxis:{categories:a,labels:{rotation:90,align:"left"}},yAxis:{title:{text:"Average Hours"}},tooltip:{headerFormat:"<table>",pointFormat:'<tr><td style="color:{series.color};padding:0">{point.category}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0},series:{borderWidth:0,dataLabels:{enabled:!1,format:"{point.y}"}}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Machines",data:i}]}),$("#spinner").hide()},t.UndercarriageBrandsChart=function(e){var t=v(),n=S(),r=e.data.results;angular.forEach(r,function(e){if(void 0!==e.inspection_obj.manufacturer&&void 0!==e.inspection_obj.machine){var t=e.inspection_obj.machine,r=e.inspection_obj.manufacturer;angular.forEach(n,function(e){e.name===r.company&&-1==e.machines.indexOf(t.model)&&(e.machines.push(t.model),e.y++)})}});var a=[];angular.forEach(n,function(e){e.y>0&&a.push({name:e.name,y:e.y})}),Z.highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:1,plotShadow:!1},title:{text:"Undercarriage Brands"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{type:"pie",name:"Undercarriage Brands",data:a}]})},t.MachinesPercentageChart=function(e){var t=v(),n=C(),r=e.data.results;angular.forEach(r,function(e){if(void 0!==e.inspection_obj.machine){var t=e.inspection_obj.machine.model;angular.forEach(n,function(n){n.name===t&&(e.completed?n.y++:n.n++)})}});var a=[],i=[],s=[];angular.forEach(n,function(e){(e.y>0||e.n>0)&&e.y>=1&&(a.push(e.name),i.push(e.y),s.push(e.n))});var o=1,c=25;i.length>c&&(o=Math.round(i.length/c)),Q.highcharts({chart:{type:"column"},title:{text:"Percentage of Machines Inspected"},xAxis:{categories:a,labels:{rotation:90,step:o,align:"left"}},yAxis:{min:0,title:{text:"Number of Inspections"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"gray"}}},tooltip:{formatter:function(){return"<b>"+this.x+"</b>: "+this.y}},plotOptions:{column:{stacking:"normal",pointPadding:.2,borderWidth:0}},legend:{enabled:!1},exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/jpeg"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}},series:[{name:"Total",data:s},{name:"Completed",data:i}]})},t.GetInspectionData(),t.selectedChartByInspector=function(){t.filterChartByInspector=null===t.inspectorChartSearchFilter?{}:{inspection_obj:{user:{username:t.inspectorChartSearchFilter}}}},t.selectedChartByCustomer=function(){t.filterChartByCustomer=null===t.customerChartSearchFilter?{}:{inspection_obj:{customer:{name:t.customerChartSearchFilter}}}}}]),Modustri.controller("LongRangeCtrl",["$log","$scope","$routeParams","$location","$http","CustomerServices","MachineServices","InsServices","UserServices","AuthServices","Utilities","$filter",function(e,t,n,r,a,i,s,o,c,l,u,d){"use strict";function p(){for(var e=[],n=0;n<=g();n++){var r=moment(new Date(t.fromChartDate)).add(n,"days").format("MM/DD/YYYY");e.push([new Date(r).getTime(),0])}return e}function m(){for(var e=[],n=0;n<=g();n++){var r=moment(new Date(t.fromChartDate)).add(n,"days").format("MM/DD/YYYY");e.push([new Date(r).getTime(),0,0])}return e}function h(e){var t=[];return $.each(e,function(e,n){-1===$.inArray(n,t)&&t.push(n)}),t}function g(){var e=864e5,n=(new Date(t.toChartDate)-new Date(t.fromChartDate))/e;return n+1}function f(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.machine&&void 0!==e.inspection_obj.machine&&-1==t.indexOf(e.inspection_obj.machine.model)&&t.push(e.inspection_obj.machine.model)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function _(e){var t=[];return void 0===e||"Hi"===e||"Lo"===e||"NA%"===e||null===e||""===e||"NA"===e?-1:(t=e.split("%"),parseInt(t[0]))}l.checkUserCreds(),t.UserSettings=l.getUserSettings(),t.Chart={date:"",timestamp:"",filter:"",from:0,to:99999999999,customer_name:"",customer_id:"",inspectors_list:[],inspections:{}},t.Chart.inspections={},t.fromChartDate=moment().subtract(120,"days").format("MM/DD/YYYY"),t.toChartDate=moment().format("MM/DD/YYYY"),t.fromUnix=moment(new Date(t.fromChartDate)).unix(),t.toUnix=moment(new Date(t.toChartDate)).unix();var v=$("#stock-chart");t.UpdateChart=function(){var e=[];o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(t){var n=t.data.results;e=p(),angular.forEach(n,function(t){for(var n=moment.unix(t.timestamp).format("MM/DD/YYYY"),r=0;r<e.length;r++){var a=e[r];a[0]!==new Date(n).getTime()||(a[1]=a[1]+1)}}),v.highcharts("StockChart",{rangeSelector:{selected:1,inputEnabled:$("#stock-chart").width()>480},title:{text:"Total Inspections vs. Days"},series:[{name:"Inspection(s)",data:e,tooltip:{valueDecimals:2}}],exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/JPEG"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}}})})},t.UpdateChart();var b=$("#detail-stock-chart"),y=[];c.getUsersByDealer(function(e){angular.forEach(e.results,function(e){y.push(e.username)})}),t.UpdateDetailChart=function(){function e(){$("#detail-stock-chart").highcharts("StockChart",{chart:{},title:{text:"Inspector Breakdowns vs. Days"},rangeSelector:{inputEnabled:$("#detail-stock-chart").width()>480,selected:3},yAxis:{labels:{formatter:function(){return this.value}},plotLines:[{value:0,width:2,color:"silver"}],exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/JPEG"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})},separator:!1}]}}}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b>',valueDecimals:2},series:n})}var n=[],r=[],a=0,i=Highcharts.getOptions().colors;o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(t){var r=t.data.results;$.each(y,function(t,i){var s=p();angular.forEach(r,function(e){if(void 0!==e.inspection_obj.user){var t=e.inspection_obj.user.username;if(i===t)for(var n=moment.unix(e.timestamp).format("MM/DD/YYYY"),r=0;r<s.length;r++){var a=s[r];a[0]!==new Date(n).getTime()||(a[1]=a[1]+1)}}}),n[t]={name:i,data:s},a++,a==y.length&&e()})})},t.UpdateDetailChart();var w=$("#machine-stock-chart");t.UpdateMachineChart=function(){var e=[],n=[],r=0,a=Highcharts.getOptions().colors;o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(e){var n=m();t.chartMachines=f(e.data.results);var r=e.data.results;r=void 0===t.machineChartSearchFilter||null===t.machineChartSearchFilter?d("filter")(r,{}):d("filter")(r,{inspection_obj:{machine:{model:t.machineChartSearchFilter}}});var a=0,i=[];angular.forEach(r,function(e){var t=moment.unix(e.timestamp).format("MM/DD/YYYY"),r=[];angular.forEach(e.inspection_obj.results,function(e){if(!(void 0===e[0]||void 0===e[0].left&&void 0===e[0].right||void 0===e[0].left.percentage&&void 0===e[0].right.percentage))for(var t=0;t<e.length;t++)r.push(_(e[t].left.percentage)),r.push(_(e[t].right.percentage))});var s=r.sort(function(e,t){return e-t});a!==t?(s.length>1&&s[0]!==s[s.length-1]&&angular.forEach(n,function(e){e[0]==new Date(t).getTime()&&(e[1]=s[0],e[2]=s[s.length-1])}),a=t,i=r):angular.forEach(i,function(e){r.push(e)})}),w.highcharts("StockChart",{chart:{type:"arearange"},rangeSelector:{inputEnabled:$("#machine-stock-chart").width()>480,selected:1},title:{text:"Machine wear MAX-MIN variation "},tooltip:{valueSuffix:""},series:[{name:"%",data:n}],exporting:{buttons:{contextButton:{menuItems:[{text:"Download PDF",onclick:function(){this.exportChart({type:"application/pdf"})},separator:!1},{text:"Download JPG",onclick:function(){this.exportChart({type:"image/JPEG"})},separator:!1},{text:"Download SVG",onclick:function(){this.exportChart({type:"image/svg+xml"})
},separator:!1}]}}}})})},t.UpdateMachineChart()}]),Modustri.controller("DrilldownCtrl",["$log","$scope","$routeParams","$location","$http","CustomerServices","MachineServices","InsServices","UserServices","AuthServices","Utilities","AppSettings","$filter",function(e,t,n,r,a,i,s,o,c,l,u,d,p){"use strict";function m(){for(var e=[],n=0;n<=g();n++){var r=moment(new Date(t.fromChartDate)).add(n,"days").format("MM/DD/YYYY");e.push(r)}return e}function h(){for(var e=[],t=0;t<=g();t++)e.push(0);return e}function g(){var e=864e5,n=(new Date(t.toChartDate)-new Date(t.fromChartDate))/e;return n+1}function f(){var e=[];return angular.forEach(t.Chart.inspectors_list,function(t){e.push({name:t.name,data:h()})}),e}function v(){var e=[];return angular.forEach(t.chartCustomers,function(t){e.push({name:t,data:h()})}),e}function b(){var e=[];return angular.forEach(t.chartMachines,function(t){e.push({name:t,data:h()})}),e}function y(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.customer&&void 0!==e.inspection_obj.customer&&-1==t.indexOf(e.inspection_obj.customer.name)&&t.push(e.inspection_obj.customer.name)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}function w(e){var t=[],n=[];return angular.forEach(e,function(e){null!==e.inspection_obj.machine&&void 0!==e.inspection_obj.machine&&-1==t.indexOf(e.inspection_obj.machine.model)&&t.push(e.inspection_obj.machine.model)}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n}l.checkUserCreds(),t.UserSettings=l.getUserSettings(),t.Chart={date:"",timestamp:"",filter:"",from:0,to:99999999999,customer_name:"",customer_id:"",inspectors_list:[],inspections:{}},$("#spinner").hide(),c.getUsersByDealer(function(e){angular.forEach(e.results,function(e,n){t.Chart.inspectors_list.push({name:e.username,id:e.id})})}),t.Chart.inspections={},t.dashboardCustomers=[],t.chartType="column",t.fromChartDate=moment().subtract(7,"days").format("MM/DD/YYYY"),t.toChartDate=moment().format("MM/DD/YYYY"),t.UpdateDateRangeData=function(){$("#spinner").show(),t.showSpinner=!0,t.UpdateDispatch(),t.UpdateInspectorChart(),t.UpdateCustomerChart(),t.UpdateMachineChart()},t.UpdateDispatch=function(){t.fromUnix=moment(new Date(t.fromChartDate)).unix(),t.toUnix=moment(new Date(t.toChartDate)).unix(),o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(e){var n=e.data.results;_.each(e.data.results,function(e,t,r){n[t].datestring=u.getDatestring(e.timestamp)}),t.Chart.inspections=n})},t.UpdateDispatch();var I=$("#total-inspections-chart"),D=$("#total-customers-chart"),U=$("#total-machines-chart"),C=$("#drilldown-chart");t.chartCustomers=[],t.chartMachines=[],t.UpdateInspectorChart=function(){t.fromUnix=moment(new Date(t.fromChartDate)).unix(),t.toUnix=moment(new Date(t.toChartDate)).unix(),o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(e){var n=m(),r=f(),a=e.data.results;a=void 0===t.inspectorChartSearchFilter||null===t.inspectorChartSearchFilter?p("filter")(e.data.results,{}):p("filter")(e.data.results,{inspection_obj:{user:{username:t.inspectorChartSearchFilter}}}),angular.forEach(a,function(e){if(void 0!==e.inspection_obj.user){var t=e.inspection_obj.user.username;angular.forEach(r,function(r){if(r.name===t)for(var a=u.formatDatestring(e.timestamp),i=0;i<n.length;i++)moment(new Date(n[i])).format("MM/DD/YYYY")===moment(new Date(a)).format("MM/DD/YYYY")&&(r.data[i]=r.data[i]+1)})}}),I.highcharts({chart:{type:t.chartType},title:{text:"Inspections"},subtitle:{text:"Daily Inspection Breakdown"},xAxis:{categories:n,title:{text:"Days"}},yAxis:{min:0,title:{text:"Number of Inspections"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:r})}),C.highcharts({chart:{type:"column",events:{drilldown:function(e){if(!e.seriesOptions){var t=this,n={Animals:{name:"Animals",data:[["Cows",2],["Sheep",3]]},Fruits:{name:"Fruits",data:[["Apples",5],["Oranges",7],["Bananas",2]]},Cars:{name:"Cars",data:[["Toyota",1],["Volkswagen",2],["Opel",5]]}},r=n[e.point.name];t.showLoading("Simulating Ajax ..."),setTimeout(function(){t.hideLoading(),t.addSeriesAsDrilldown(e.point,r)},1e3)}}}},title:{text:"Drilldown"},xAxis:{type:"category"},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0}}},series:[{name:"Things",colorByPoint:!0,data:[{name:"Animals",y:5,drilldown:!0},{name:"Fruits",y:2,drilldown:!0},{name:"Cars",y:4,drilldown:!0}]}],drilldown:{series:[]}})},t.UpdateCustomerChart=function(){t.fromUnix=moment(new Date(t.fromChartDate)).unix(),t.toUnix=moment(new Date(t.toChartDate)).unix(),o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(e){var n=m();t.chartCustomers=y(e.data.results);var r=v(),a=e.data.results;a=void 0===t.customerChartSearchFilter||null===t.customerChartSearchFilter?p("filter")(a,{}):p("filter")(a,{inspection_obj:{customer:{name:t.customerChartSearchFilter}}}),angular.forEach(a,function(e){if(void 0!==e.inspection_obj.customer){var t=e.inspection_obj.customer.name;angular.forEach(r,function(r){if(r.name===t)for(var a=moment.unix(e.timestamp).format("MM/DD/YYYY"),i=0;i<n.length;i++)moment(new Date(n[i])).format("MM/DD/YYYY")===moment(new Date(a)).format("MM/DD/YYYY")&&(r.data[i]=r.data[i]+1)})}}),D.highcharts({chart:{type:t.chartType},title:{text:"Customers"},subtitle:{text:"Customer Frequency Breakdown"},xAxis:{categories:n,title:{text:"Days"}},yAxis:{min:0,title:{text:"Number of Customers"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:r})})},t.UpdateMachineChart=function(){t.fromUnix=moment(new Date(t.fromChartDate)).unix(),t.toUnix=moment(new Date(t.toChartDate)).unix(),o.getByDealerIdStartEnd(l.getDealerID(),t.fromUnix,t.toUnix).then(function(e){var n=m();t.chartMachines=w(e.data.results);var r=b(),a=e.data.results;a=void 0===t.machineChartSearchFilter||null===t.machineChartSearchFilter?p("filter")(a,{}):p("filter")(a,{inspection_obj:{machine:{model:t.machineChartSearchFilter}}}),angular.forEach(a,function(e){if(void 0!==e.inspection_obj.machine){var t=e.inspection_obj.machine.model;angular.forEach(r,function(r){if(r.name===t)for(var a=moment.unix(e.timestamp).format("MM/DD/YYYY"),i=0;i<n.length;i++)moment(new Date(n[i])).format("MM/DD/YYYY")===moment(new Date(a)).format("MM/DD/YYYY")&&(r.data[i]=r.data[i]+1)})}}),U.highcharts({chart:{type:t.chartType},title:{text:"Machines"},subtitle:{text:"Machine Types Breakdown"},xAxis:{categories:n,title:{text:"Days"}},yAxis:{min:0,title:{text:"Number of Inspections"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:r}),$("#spinner").hide()})},t.UpdateInspectorChart(),t.UpdateCustomerChart(),t.UpdateMachineChart(),t.selectedChartByInspector=function(){t.filterChartByInspector=null===t.inspectorChartSearchFilter?{}:{inspection_obj:{user:{username:t.inspectorChartSearchFilter}}}},t.selectedChartByCustomer=function(){t.filterChartByCustomer=null===t.customerChartSearchFilter?{}:{inspection_obj:{customer:{name:t.customerChartSearchFilter}}}}}]);
//# sourceMappingURL=./app-min.js.map
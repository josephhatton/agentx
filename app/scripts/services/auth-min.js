ModustriServices.factory("AuthServices",["$log","$http","$q","$location","AppSettings",function(e,t,i,l,a){function r(){var e={uilevel:0,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function s(){var e={uilevel:1,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function c(){var e={uilevel:2,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!0,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function d(){var e={uilevel:3,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function o(){var e={uilevel:4,uiusers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uidealers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiimages:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}function u(){var e={uilevel:5,uiusers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uicontacts:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uiinspections:{all:!0,create:!1,edit:!1,"delete":!1,view:!0},uidealers:{all:!1,create:!1,edit:!1,"delete":!1,view:!1},uisites:{all:!0,create:!0,edit:!0,"delete":!1,view:!0},uiimages:{all:!0,create:!0,edit:!1,"delete":!1,view:!0},uimachines:{all:!0,create:!0,edit:!0,"delete":!0,view:!0},uicustomers:{all:!1,create:!1,edit:!1,"delete":!1,view:!0},uireports:{all:!0,create:!0,edit:!0,"delete":!0,view:!0}};return e}var n={};return n.validate=function(e,l){var r=i.defer();return e=e.toLowerCase(),t.post(a.BASE_URL+"validate/",{username:e,password:l}).then(function(t){if(0!==t.data.errors.length)console.error("bad login"),r.reject("Incorrect username or password.");else{n.authorized=!0;var i=t.data.results[0].id,a=t.data.results[0].dealer_id,s=t.data.results[0].salt,c=n.generateUserHash(e,l,s),d=t.data.results[0].userlevel;n.setUserCreds(e,l,s,c,i,a,d);var o={show_metric:!1};n.setUserSettings(o),r.resolve(n.authorized)}},function(){alert("Incorrect user name or password.")}),r.promise},n.queryUserSettings=function(e){var i;try{i=t.get(a.BASE_URL+"userprefs/"+n.getUserHash()+"/"+n.getUserID()+"/?user_id="+e)}catch(l){console.dir(l)}},n.generateUserHash=function(e,t,i){var l=new Date,a=l.getUTCHours().toString()+moment().utc().dayOfYear().toString()+(l.getUTCMonth()+1).toString()+l.getUTCFullYear().toString(),r=e+a+t+i,s=CryptoJS.SHA224(r);return s.toString(CryptoJS.enc.Hex)},n.checkUserCreds=function(){var e=n.getUserCreds(),t;"undefined"==typeof e.pass||"undefined"==typeof e.digest||"pass"in e==0||"digest"in e==0?l.path("/login/"):t=n.generateUserHash(e.user,e.pass,e.salt),n.saveUserHash(t)},n.setUserCreds=function(e,t,i,l,a,r,s){localStorage.setItem("pass",t),localStorage.setItem("salt",i),localStorage.setItem("digest",l),localStorage.setItem("user",e),localStorage.setItem("user_id",a),localStorage.setItem("dealer_id",r),localStorage.setItem("level",s)},n.getUserCreds=function(){return{user:localStorage.getItem("user"),pass:localStorage.getItem("pass"),salt:localStorage.getItem("salt"),digest:localStorage.getItem("digest"),user_id:localStorage.getItem("user_id"),dealer_id:localStorage.getItem("dealer_id"),level:localStorage.getItem("level")}},n.getUserID=function(){return localStorage.getItem("user_id")},n.getDealerID=function(){return localStorage.getItem("dealer_id")},n.getUserHash=function(){return localStorage.getItem("digest")},n.saveUserHash=function(e){localStorage.setItem("digest",e)},n.getUserSettings=function(){var e={show_metric:"false"===localStorage.getItem("show_metric")?!1:"true"};return e},n.setUserSettings=function(e){localStorage.setItem("show_metric",e.show_metric)},n.saveUserSettings=function(e){n.setUserSettings(e)},n.getMetricSetting=function(){return"false"===localStorage.getItem("show_metric")?!1:!0},n.setMetricSetting=function(e){console.log("saving settings to localStorage"),localStorage.setItem("show_metric",e)},n.getUserLevel=function(){return localStorage.getItem("level")},n.setUserLevel=function(e){return localStorage.setItem("level",e)},n.logout=function(){localStorage.clear(),$("#logo").css("background-image","url(../images/logo-beta.png)").css("width","140px"),$(".logo-wrapper").css("width","140px"),l.path(a.BASE_URL)},n.uiToggle=function(e,t,i){var l=[r(),s(),c(),d(),o(),u()],a=!1;return l.forEach(function(l){var r=l;if(r.uilevel==e){var s=r[t];a=s[i]}}),a},n}]);
//# sourceMappingURL=./auth-min.js.map
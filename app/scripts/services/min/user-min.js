Modustri.factory("UserServices",["$log","$http","$location","$q","AuthServices","AppSettings",function(e,r,s,t,n,u){"use strict";function a(e,r,t,n){var u=n.url,a=u.indexOf("?");if(-1!==a&&(u=u.substring(0,a)),403===r)s.path("/404");else{var o=404===r?"No service found at "+u+".":500===r?"Error in service at "+u+".":e;console.log(o)}}var o={};return o.getUserList=function(){var e=n.getUserLevel(),s=u.BASE_URL+"users/"+n.getUserHash()+"/"+n.getUserID()+"/?dealer_id="+n.getDealerID();return 2>e&&(s=u.BASE_URL+"users/"+n.getUserHash()+"/"+n.getUserID()+"/"),r.get(s).success(function(e){return e})},o.addUser=function(e,s,t,o,i,c){var U={username:e,email:s,userlevel:t,dealer_id:o,customer_id:i};r.post(u.BASE_URL+"user/"+n.getUserHash()+"/"+n.getUserID()+"/",U).success(c).error(a)},o.updateUser=function(e,s,t,o,i,c,U){var g={username:s,email:t,userlevel:o,dealer_id:i,customer_id:"0"};r.post(u.BASE_URL+"user/"+n.getUserHash()+"/"+n.getUserID()+"/"+e+"/",g).success(U).error(a)},o.removeUser=function(e,s){r.delete(u.BASE_URL+"user/"+n.getUserHash()+"/"+n.getUserID()+"/"+e+"/").success(s).error(a)},o.getContactById=function(e){if(0===e||null===e||"0"===e){var s=t.defer();return s.resolve({data:{results:!1}}),s.promise}return r.get(u.BASE_URL+"contact/"+n.getUserHash()+"/"+n.getUserID()+"/"+e+"/").success(function(e){return e}).error(a)},o.saveContact=function(e){var s=[],o=!1,i=t.defer();return void 0===e||""===e.trim()?(i.resolve({data:{results:{id:0}}}),i.promise):r.get(u.BASE_URL+"js/contacts/"+n.getUserHash()+"/"+n.getUserID()+"/?term="+e).then(function(s){return o=_.find(s.data,function(r){return r.value===e}),void 0!==o?(i.resolve(s),i.promise):r.post(u.BASE_URL+"contact/"+n.getUserHash()+"/"+n.getUserID()+"/",{email:e,first:" ",last:" "}).success(function(e){return e}).error(a)})},o.query=function(){return r.get(u.BASE_URL+"users/"+n.getUserHash()+"/"+n.getUserID()+"/").then(function(e){return e.data})},o.getUsersByDealer=function(e){var s=n.getUserLevel(),t={};s>=2&&(t={dealer_id:n.getDealerID()}),r.post(u.BASE_URL+"users/"+n.getUserHash()+"/"+n.getUserID()+"/",t).success(e).error(a)},o.saveSettings=function(){return r.post(u.BASE_URL+"users/"+n.getUserHash()+"/"+n.getUserID()+"/",{}).then(function(e){return e.data})},o}]);